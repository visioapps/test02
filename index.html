<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4A90D9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Amblyup">
<link rel="manifest" href="manifest.json">
<title>Amblyup â€” Jules</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --blue:#4A90D9; --blue-l:#EAF4FF; --blue-mid:#C8E4FA; --blue-d:#2E6DB4;
  --green:#5BBF8E; --green-l:#E8F7F1; --green-d:#3A8F68;
  --orange:#F9A825; --orange-l:#FFF8E1; --orange-d:#E65100;
  --red:#E74C3C; --red-l:#FDEDEC;
  --teal:#3ABFBF; --teal-l:#E0F5F5;
  --text:#2C3E50; --text-m:#7F8C8D; --text-l:#BDC3C7;
  --white:#FFFFFF; --bg:#F4F9FF; --border:#C8E4FA;
  --shadow:0 2px 12px rgba(74,144,217,.10);
  --shadow-md:0 4px 20px rgba(74,144,217,.14);
  --shadow-lg:0 8px 30px rgba(74,144,217,.20);
  --r:18px; --r-sm:12px; --r-xs:8px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{scroll-behavior:smooth;}
body{font-family:'Quicksand',sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;overflow-x:hidden;padding-bottom:84px;}

/* â”€â”€ PAGES â”€â”€ */
.page{display:none;}
.page.active{display:block;animation:fadeUp .3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes popIn{0%{transform:scale(0)}80%{transform:scale(1.15)}100%{transform:scale(1)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-header{
  padding:14px 16px 0;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:50;
  background:rgba(244,249,255,.92);
  backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
}
.header-logo{height:46px;object-fit:contain;}
.notif-btn{width:36px;height:36px;border-radius:11px;background:var(--white);border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1rem;cursor:pointer;position:relative;box-shadow:var(--shadow);}
.notif-dot{position:absolute;top:5px;right:5px;width:7px;height:7px;background:var(--red);border-radius:50%;border:2px solid var(--white);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE TITLE â€” section header clair
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-title{
  display:flex;align-items:center;gap:10px;
  padding:14px 16px 6px;
}
.page-title-icon{
  width:36px;height:36px;border-radius:11px;
  display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;
}
.page-title-text{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.2rem;color:var(--text);line-height:1;}
.page-title-sub{font-size:.68rem;color:var(--text-m);font-weight:600;margin-top:2px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION TITLE â€” plus visible
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-title{
  display:flex;align-items:center;gap:8px;
  padding:18px 16px 8px;
  font-family:'Nunito',sans-serif;font-size:.82rem;font-weight:900;
  text-transform:uppercase;letter-spacing:.08em;color:var(--text);
}
.section-title-icon{
  width:26px;height:26px;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:.85rem;flex-shrink:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD â€” base
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{
  background:var(--white);border-radius:var(--r);
  padding:16px;margin:0 16px;
  box-shadow:var(--shadow);
  border:1px solid rgba(200,228,250,.5);
}
.card+.card{margin-top:10px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO â€” simplifiÃ©, focalisÃ©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{
  margin:10px 16px 0;
  background:var(--blue);border-radius:var(--r);
  padding:18px 18px 16px;color:white;
  position:relative;overflow:hidden;
  box-shadow:0 6px 24px rgba(74,144,217,.30);
}
.hero::before{content:'';position:absolute;top:-35px;right:-35px;width:130px;height:130px;background:rgba(255,255,255,.10);border-radius:50%;}
.hero::after{content:'';position:absolute;bottom:-25px;left:15px;width:90px;height:90px;background:rgba(255,255,255,.06);border-radius:50%;}

/* Ligne 1 : salutation + mascotte */
.hero-row1{
  display:flex;align-items:flex-start;justify-content:space-between;
  margin-bottom:12px;position:relative;z-index:1;
}
.hero-greeting{font-size:.68rem;font-weight:700;opacity:.8;text-transform:uppercase;letter-spacing:.5px;}
.hero-name{font-family:'Nunito',sans-serif;font-size:1.4rem;font-weight:900;margin-top:1px;line-height:1.1;}
.hero-mascot{font-size:2.4rem;animation:bounce 2.8s ease-in-out infinite;filter:drop-shadow(0 3px 6px rgba(0,0,0,.18));flex-shrink:0;}

/* Ligne 2 : instruction du jour â€” encart blanc discret */
.hero-instruction{
  background:rgba(255,255,255,.18);border-radius:13px;
  padding:12px 14px;margin-bottom:12px;
  position:relative;z-index:1;
  border:1px solid rgba(255,255,255,.15);
}
.hero-instr-label{font-size:.62rem;font-weight:700;opacity:.78;text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px;}
.hero-instr-oeil{
  font-family:'Nunito',sans-serif;font-size:1.15rem;font-weight:900;
  display:flex;align-items:center;gap:8px;line-height:1;
}
.hero-instr-oeil-badge{
  font-size:.72rem;font-weight:800;padding:3px 9px;border-radius:20px;
  background:rgba(255,255,255,.25);letter-spacing:.04em;
}
.hero-instr-horaire{font-size:.8rem;font-weight:600;opacity:.88;margin-top:4px;}

/* Barre de progression journÃ©e */
.hero-day-progress{position:relative;z-index:1;margin-bottom:12px;}
.hero-day-times{display:flex;justify-content:space-between;font-size:.62rem;font-weight:700;opacity:.78;margin-bottom:4px;}
.hero-day-bar-bg{height:8px;background:rgba(255,255,255,.22);border-radius:20px;overflow:hidden;}
.hero-day-bar{height:100%;background:linear-gradient(90deg,rgba(255,255,255,.95),rgba(255,255,255,.6));border-radius:20px;transition:width 1s ease;}

/* Ligne 3 : stats compactes */
.hero-stats{
  display:grid;grid-template-columns:1fr 1fr 1fr;
  gap:7px;position:relative;z-index:1;
}
.hstat{
  background:rgba(255,255,255,.17);border-radius:11px;
  padding:8px 6px;text-align:center;
  border:1px solid rgba(255,255,255,.12);
}
.hstat-val{font-family:'Nunito',sans-serif;font-size:1.05rem;font-weight:900;line-height:1;}
.hstat-label{font-size:.57rem;font-weight:600;opacity:.78;margin-top:2px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARTE ACTION DU JOUR â€” proÃ©minente
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.action-card{
  margin:10px 16px 0;
  background:var(--white);border-radius:var(--r);
  box-shadow:var(--shadow-md);
  border:2px solid var(--blue-mid);
  overflow:hidden;
}
.action-card-header{
  background:linear-gradient(135deg,var(--blue-l),#dceffe);
  padding:13px 16px;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:1px solid var(--border);
}
.action-card-title{
  font-family:'Nunito',sans-serif;font-weight:900;font-size:.92rem;color:var(--blue-d);
  display:flex;align-items:center;gap:7px;
}
.action-card-date{font-size:.7rem;color:var(--text-m);font-weight:600;}
.action-card-body{padding:16px;}

/* Locked state */
.locked-msg{
  display:flex;align-items:center;justify-content:center;gap:8px;
  background:var(--bg);border:1.5px dashed var(--border);
  border-radius:12px;padding:16px;
  font-size:.82rem;color:var(--text-m);font-weight:600;
  margin-bottom:12px;
}

/* Slider double */
.slider-wrap{margin-bottom:14px;}
.slider-labels-top{display:flex;justify-content:space-between;margin-bottom:8px;}
.slider-val-label{font-family:'Nunito',sans-serif;font-size:.85rem;font-weight:800;}
.dual-slider-container{position:relative;height:52px;margin-bottom:6px;}
.slider-track-bg{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;height:10px;background:var(--bg);border-radius:20px;border:1.5px solid var(--border);}
.slider-track-obj{position:absolute;top:50%;transform:translateY(-50%);left:0;height:10px;background:var(--orange);border-radius:20px;transition:width .1s;opacity:.5;}
.slider-track-real{position:absolute;top:50%;transform:translateY(-50%);left:0;height:10px;background:var(--blue);border-radius:20px;transition:width .1s;}
.slider-hour-marks{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;height:10px;display:flex;align-items:center;pointer-events:none;}
.slider-mark{position:absolute;top:14px;font-size:.54rem;font-weight:700;color:var(--text-l);transform:translateX(-50%);font-family:'Nunito',sans-serif;}
.slider-input{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;width:100%;-webkit-appearance:none;appearance:none;height:10px;background:transparent;pointer-events:none;margin:0;}
.slider-input::-webkit-slider-thumb{-webkit-appearance:none;width:28px;height:28px;border-radius:50%;cursor:pointer;pointer-events:all;box-shadow:0 2px 8px rgba(0,0,0,.15);border:3px solid white;transition:transform .15s;}
.slider-input::-webkit-slider-thumb:active{transform:scale(1.2);}
.slider-obj::-webkit-slider-thumb{background:var(--orange);box-shadow:0 2px 10px rgba(249,168,37,.4);}
.slider-real::-webkit-slider-thumb{background:var(--blue);box-shadow:0 2px 10px rgba(74,144,217,.4);z-index:2;}
.slider-obj{z-index:1;}.slider-real{z-index:2;}
.slider-legend{display:flex;gap:12px;}
.sleg{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--text-m);font-weight:600;}
.sleg-dot{width:9px;height:9px;border-radius:50%;}

.valider-btn{
  width:100%;padding:14px;border-radius:13px;border:none;
  background:var(--blue);color:white;
  font-family:'Nunito',sans-serif;font-weight:800;font-size:.95rem;
  cursor:pointer;transition:all .15s;
  box-shadow:0 4px 14px rgba(74,144,217,.32);
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.valider-btn:disabled{background:var(--border);color:var(--text-l);box-shadow:none;cursor:not-allowed;}
.valider-btn:not(:disabled):active{transform:scale(.97);}

.congrats-box{
  border-radius:var(--r-sm);padding:18px;text-align:center;
  background:linear-gradient(135deg,var(--green-l),#d4f0e5);
  display:none;
}
.congrats-box .c-emoji{font-size:2.4rem;display:block;margin-bottom:6px;animation:popIn .4s cubic-bezier(.34,1.56,.64,1);}
.congrats-box h3{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.1rem;color:var(--green);margin-bottom:3px;}
.congrats-box p{color:var(--text-m);font-size:.82rem;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JOURS EN ATTENTE â€” section dÃ©diÃ©e
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pending-section{margin:0 16px;}
.pending-item{
  background:var(--white);border-radius:var(--r-sm);
  border:1.5px solid var(--orange);
  padding:13px 14px;margin-bottom:8px;
  box-shadow:var(--shadow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDRIER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.cal-nav{display:flex;align-items:center;gap:7px;}
.cal-nav-btn{width:28px;height:28px;border-radius:9px;background:var(--blue-l);border:1.5px solid var(--border);color:var(--blue);font-size:.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:800;transition:all .15s;}
.cal-nav-btn:active{background:var(--blue);color:white;transform:scale(.93);}
.cal-month-label{font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:var(--text);min-width:96px;text-align:center;}
.cal-score-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.3rem;color:var(--blue);line-height:1;text-align:right;}
.cal-score-label{font-size:.6rem;color:var(--text-m);}
.cal-day-labels{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:3px;}
.cdl{text-align:center;font-family:'Nunito',sans-serif;font-size:.58rem;font-weight:700;color:var(--text-l);text-transform:uppercase;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cday{aspect-ratio:1;border-radius:9px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:'Nunito',sans-serif;font-size:.62rem;font-weight:700;transition:transform .15s;position:relative;cursor:default;}
.cday.empty{background:none;}
.cday.future{background:#F0F7FF;color:var(--text-l);}
.cday.cal-normal,.cday.today{background:#C8E4FA;color:#1A3A5C;}
.cday.today{background:#4A90D9;color:white;box-shadow:0 2px 8px rgba(74,144,217,.4);}
.cday.cal-normal:hover,.cday.today:hover{transform:scale(1.08);}
.cday-eye-badge{font-size:.42rem;font-weight:900;line-height:1.4;padding:1px 3px;border-radius:3px;margin-top:2px;}
.eye-badge-od{background:#4A90D9;color:white;}
.eye-badge-og{background:#2EAFAF;color:white;}
.eye-badge-none{background:#94A3B8;color:white;}
.eye-badge-pause{background:transparent;color:#94A3B8;font-size:.7rem !important;line-height:1;}
.cday-obs-dot{position:absolute;top:3px;right:3px;width:7px;height:7px;border-radius:50%;border:1.5px solid rgba(255,255,255,.7);display:flex;align-items:center;justify-content:center;font-size:.32rem;font-weight:900;}
.dot-ok{background:#27AE60;}
.dot-partial{background:#F39C12;}
.dot-miss{background:#E74C3C;}
.dot-unknown{background:rgba(100,116,139,.35);border-color:rgba(100,116,139,.6);color:#64748B;}
.dot-none{display:none;}
.cday-num{font-size:.6rem;line-height:1;font-weight:800;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RDV â€” carte unifiÃ©e
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rdv-unified{margin:0 16px;display:flex;flex-direction:column;gap:8px;}
.rdv-item-card{
  background:white;border-radius:var(--r-sm);
  border:2px solid var(--border);
  padding:13px 15px;display:flex;align-items:center;gap:12px;
  cursor:pointer;transition:transform .15s;
  box-shadow:var(--shadow);
}
.rdv-item-card:active{transform:scale(.99);}
.rdv-item-card.next{border-color:#4A90D9;box-shadow:0 3px 14px rgba(74,144,217,.16);}
.rdv-item-card.teal{border-color:#2EAFAF;box-shadow:0 3px 14px rgba(46,175,175,.12);}
.rdv-item-card.warn{border-color:#F9A825;border-style:dashed;}
.rdv-date-pill{
  width:44px;height:48px;border-radius:12px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;
}
.rdv-item-card.next .rdv-date-pill{background:#4A90D9;box-shadow:0 3px 10px rgba(74,144,217,.3);}
.rdv-item-card.teal .rdv-date-pill{background:#2EAFAF;box-shadow:0 3px 10px rgba(46,175,175,.25);}
.rdv-item-card.warn .rdv-date-pill{background:#FEF3C7;border:2px dashed #F9A825;}
.rdv-day{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.05rem;line-height:1;color:white;}
.rdv-item-card.warn .rdv-day{color:var(--orange-d);font-size:1.3rem;}
.rdv-mois{font-family:'Nunito',sans-serif;font-weight:700;font-size:.57rem;color:rgba(255,255,255,.85);text-transform:uppercase;}
.rdv-info{flex:1;}
.rdv-who{font-family:'Nunito',sans-serif;font-weight:900;font-size:.88rem;color:var(--text);}
.rdv-detail{font-size:.7rem;color:var(--text-m);margin-top:2px;}
.rdv-badge-row{margin-top:5px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.rdv-tag{font-size:.62rem;font-weight:700;padding:2px 8px;border-radius:20px;}
.rdv-tag.next{background:var(--blue-l);color:var(--blue-d);}
.rdv-tag.ok{background:var(--green-l);color:var(--green-d);}
.rdv-tag.warn{background:var(--orange-l);color:var(--orange-d);}
.rdv-cta{background:transparent;border:none;padding:0;cursor:pointer;}
.rdv-arrow{color:var(--text-l);font-size:.95rem;}

/* Actions RDV */
.rdv-toggle-btn{background:none;border:1.5px solid var(--border);border-radius:9px;width:32px;height:32px;font-size:1.1rem;cursor:pointer;color:var(--text-m);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s;font-weight:900;line-height:1;}
.rdv-toggle-btn:active{background:var(--bg);}
.rdv-actions{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;}
.rdv-act-btn{padding:5px 10px;border-radius:8px;border:none;font-family:'Nunito',sans-serif;font-weight:800;font-size:.72rem;cursor:pointer;transition:all .15s;}
.rdv-act-btn:active{transform:scale(.96);}
.rdv-act-btn.call{background:var(--green-l);color:var(--green-d);border:1.5px solid var(--green);}
.rdv-act-btn.edit{background:var(--blue-l);color:var(--blue-d);border:1.5px solid var(--blue-mid);}
.rdv-act-btn.del{background:var(--red-l);color:var(--red);border:1.5px solid #FECACA;}

/* Contacts */
.contact-card{background:white;border-radius:var(--r-sm);border:1.5px solid var(--border);padding:13px 14px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow);}
.contact-avatar{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.3rem;color:white;font-family:'Nunito',sans-serif;font-weight:900;flex-shrink:0;}
.contact-info{flex:1;min-width:0;}
.contact-name{font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:var(--text);}
.contact-role{font-size:.7rem;color:var(--text-m);font-weight:600;margin-top:1px;}
.contact-addr{font-size:.66rem;color:var(--text-l);margin-top:2px;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.contact-actions{display:flex;flex-direction:column;gap:5px;flex-shrink:0;}
.contact-btn{width:34px;height:34px;border-radius:10px;border:1.5px solid var(--border);background:var(--bg);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.contact-btn:active{transform:scale(.93);}
.contact-btn.phone{background:var(--green-l);border-color:var(--green);}
.contact-btn.mail{background:var(--blue-l);border-color:var(--blue-mid);}
.contact-btn.rdv{background:#E8F4FF;border-color:#0596DE;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRÃˆS â€” KPI compact
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kpi-strip{
  margin:0 16px;
  background:var(--green);border-radius:var(--r);
  padding:16px 18px;color:white;
  box-shadow:0 5px 18px rgba(91,191,142,.28);
  position:relative;overflow:hidden;
}
.kpi-strip::before{content:'';position:absolute;top:-30px;right:-30px;width:110px;height:110px;background:rgba(255,255,255,.10);border-radius:50%;}
.kpi-strip-top{
  display:flex;align-items:center;gap:12px;
  margin-bottom:14px;position:relative;z-index:1;
}
.kpi-badge-icon{font-size:2.2rem;flex-shrink:0;filter:drop-shadow(0 2px 6px rgba(0,0,0,.15));}
.kpi-badge-label{font-family:'Nunito',sans-serif;font-size:.58rem;font-weight:800;text-transform:uppercase;letter-spacing:.08em;opacity:.8;margin-bottom:1px;}
.kpi-badge-name{font-family:'Nunito',sans-serif;font-size:1.25rem;font-weight:900;line-height:1;}
.kpi-badge-sub{font-size:.72rem;opacity:.85;margin-top:1px;}
.kpi-cols{
  display:grid;grid-template-columns:1fr 1fr 1fr;
  gap:7px;position:relative;z-index:1;
}
.kpi-col{
  background:rgba(255,255,255,.18);border-radius:11px;
  padding:9px 6px;text-align:center;
  border:1px solid rgba(255,255,255,.14);
}
.kpi-col-phrase{font-size:.52rem;font-weight:700;opacity:.82;line-height:1.3;margin-bottom:4px;}
.kpi-col-val{font-family:'Nunito',sans-serif;font-size:1.35rem;font-weight:900;line-height:1;}
.kpi-col-label{font-size:.55rem;font-weight:700;opacity:.82;margin-top:3px;line-height:1.3;}

/* Prochain objectif */
.next-obj-card{
  margin:8px 16px 0;
  background:var(--white);border-radius:var(--r-sm);
  border:1.5px solid var(--border);padding:14px 16px;
  box-shadow:var(--shadow);
}
.next-obj-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.next-obj-label{font-family:'Nunito',sans-serif;font-size:.7rem;font-weight:800;text-transform:uppercase;letter-spacing:.06em;color:var(--text-m);}
.next-obj-name{font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:var(--text);display:flex;align-items:center;gap:6px;}
.next-obj-stars{font-size:.72rem;color:var(--blue);font-weight:700;background:var(--blue-l);padding:2px 8px;border-radius:20px;}
.next-obj-bar-bg{height:9px;background:var(--bg);border-radius:20px;overflow:hidden;margin-bottom:6px;border:1px solid var(--border);}
.next-obj-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--teal));border-radius:20px;transition:width 1s ease;}
.next-obj-pct{font-size:.68rem;color:var(--text-m);font-weight:600;text-align:right;}

/* Badges timeline */
.badges-timeline{
  display:flex;gap:5px;overflow-x:auto;padding:4px 2px;
  scrollbar-width:none;-ms-overflow-style:none;
}
.badges-timeline::-webkit-scrollbar{display:none;}
.btl-item{
  flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:4px;
  min-width:52px;padding:8px 6px;border-radius:12px;
}
.btl-item.done{background:linear-gradient(135deg,var(--blue-l),var(--green-l));border:1.5px solid var(--border);}
.btl-item.next{background:var(--orange-l);border:2px solid var(--orange);}
.btl-item.locked{background:var(--bg);border:1.5px dashed var(--border);opacity:.5;}
.btl-icon{font-size:1.4rem;line-height:1;}
.btl-item.locked .btl-icon{filter:grayscale(80%);}
.btl-name{font-family:'Nunito',sans-serif;font-size:.52rem;font-weight:800;color:var(--text-m);text-align:center;line-height:1.2;}
.btl-item.done .btl-name{color:var(--blue-d);}
.btl-item.next .btl-name{color:var(--orange-d);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COURBE VISION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.vision-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.vision-tabs{display:flex;gap:4px;}
.vtab{padding:4px 9px;border-radius:7px;font-family:'Nunito',sans-serif;font-size:.68rem;font-weight:700;border:1.5px solid var(--border);background:var(--bg);color:var(--text-m);cursor:pointer;transition:all .15s;}
.vtab.active{background:var(--blue);border-color:var(--blue);color:white;}
.vision-eyes{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:12px;}
.eye-stat{border-radius:13px;padding:11px;text-align:center;border:2px solid var(--border);}
.eye-od{border-color:var(--blue);background:var(--blue-l);}
.eye-og{border-color:var(--green);background:var(--green-l);}
.eye-label{font-size:.6rem;font-weight:700;color:var(--text-m);text-transform:uppercase;letter-spacing:.4px;margin-bottom:3px;}
.eye-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.5rem;line-height:1;}
.eye-od .eye-val{color:var(--blue);}
.eye-og .eye-val{color:var(--green-d);}
.eye-prog{font-size:.68rem;font-weight:700;margin-top:2px;color:var(--green-d);}
.chart-wrap{position:relative;height:140px;}
.chart-labels-y{position:absolute;left:0;top:0;bottom:20px;width:24px;display:flex;flex-direction:column;justify-content:space-between;align-items:flex-end;padding-right:4px;}
.chart-labels-y span{font-size:.54rem;color:var(--text-l);font-family:'Nunito',sans-serif;font-weight:700;}
.chart-svg{position:absolute;left:24px;right:0;top:0;bottom:0;}
.vision-legend{display:flex;gap:14px;margin-top:8px;}
.vleg{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--text-m);font-weight:600;}
.vleg-line{width:16px;height:3px;border-radius:2px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OBSERVANCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.obs-big{text-align:center;padding:8px 0 4px;}
.obs-pct{font-family:'Nunito',sans-serif;font-weight:900;font-size:2.8rem;color:var(--blue);line-height:1;}
.obs-label{font-size:.78rem;color:var(--text-m);margin-top:3px;}
.obs-bar-wrap{height:14px;background:var(--bg);border-radius:20px;overflow:hidden;margin:12px 0;border:1px solid var(--border);}
.obs-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--green));border-radius:20px;transition:width 1s ease;}
.obs-months{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px;}
.obs-month{background:var(--bg);border-radius:11px;padding:9px 7px;text-align:center;border:1.5px solid var(--border);}
.obs-month-val{font-family:'Nunito',sans-serif;font-weight:800;font-size:.92rem;color:var(--blue);}
.obs-month-label{font-size:.62rem;color:var(--text-m);margin-top:1px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES LISTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge-row-card{
  display:flex;align-items:center;gap:12px;
  padding:11px 13px;border-radius:13px;
  background:linear-gradient(135deg,var(--blue-l),var(--green-l));
  border:1.5px solid var(--border);margin-bottom:7px;
}
.badge-row-card.locked{background:var(--bg);border-style:dashed;opacity:.7;}
.badge-row-icon{font-size:1.7rem;flex-shrink:0;}
.badge-row-card.locked .badge-row-icon{filter:grayscale(80%);}
.badge-row-info{flex:1;}
.badge-row-name{font-family:'Nunito',sans-serif;font-weight:900;font-size:.88rem;color:var(--blue-d);}
.badge-row-card.locked .badge-row-name{color:var(--text-m);}
.badge-row-desc{font-size:.7rem;color:var(--text-m);margin-top:1px;}
.badge-row-check{font-size:.95rem;color:var(--green-d);font-weight:900;}
.badge-row-lock{font-size:.85rem;color:var(--text-l);}
.reward-tag{font-size:.68rem;color:var(--green-d);font-weight:700;margin-top:4px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.doc-section-hd{font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:900;text-transform:uppercase;letter-spacing:.1em;padding:14px 16px 6px;color:var(--text-m);display:flex;align-items:center;gap:6px;}
.doc-list{margin:0 16px 4px;display:flex;flex-direction:column;gap:6px;}
.doc-item{background:var(--white);border-radius:15px;border:1.5px solid var(--border);box-shadow:var(--shadow);cursor:pointer;transition:all .15s;overflow:hidden;}
.doc-item:active{transform:scale(.98);}
.doc-item-hd{padding:12px 15px;display:flex;align-items:center;gap:11px;}
.doc-item-icon{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.doc-item-icon.blue{background:var(--blue-l);}
.doc-item-icon.green{background:var(--green-l);}
.doc-item-icon.orange{background:var(--orange-l);}
.doc-item-icon.teal{background:var(--teal-l);}
.doc-item-info{flex:1;}
.doc-item-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.86rem;color:var(--text);}
.doc-item-sub{font-size:.7rem;color:var(--text-m);margin-top:1px;}
.doc-item-arrow{color:var(--text-l);font-size:.92rem;transition:transform .2s;}
.doc-item.open .doc-item-arrow{transform:rotate(90deg);}
.doc-item-body{padding:0 15px;max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease;}
.doc-item.open .doc-item-body{max-height:500px;padding:0 15px 12px;}
.doc-sub-list{display:flex;flex-direction:column;gap:5px;}
.doc-sub-item{display:flex;align-items:center;gap:9px;padding:8px 11px;border-radius:11px;background:var(--bg);cursor:pointer;transition:background .1s;border:1px solid var(--border);}
.doc-sub-item:active{background:var(--blue-l);}
.doc-sub-icon{font-size:.95rem;flex-shrink:0;}
.doc-sub-text{font-size:.8rem;font-weight:600;color:var(--text);flex:1;}
.doc-sub-badge{font-size:.6rem;font-weight:700;padding:2px 7px;border-radius:10px;}
.doc-sub-badge.new{background:var(--blue-l);color:var(--blue);}
.doc-sub-badge.pdf{background:var(--red-l);color:var(--red);}
.doc-sub-badge.video{background:var(--orange-l);color:var(--orange-d);}

/* Comptes rendus */
.cr-add-btn{width:100%;margin-top:10px;padding:11px;border-radius:11px;border:2px dashed var(--blue-mid);background:var(--blue-l);color:var(--blue-d);font-family:'Nunito',sans-serif;font-weight:800;font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:all .15s;}
.cr-add-btn:active{transform:scale(.97);}
.cr-entry{display:flex;align-items:center;gap:10px;padding:9px 11px;border-radius:11px;background:var(--bg);border:1px solid var(--border);cursor:pointer;transition:background .1s;margin-bottom:5px;}
.cr-entry:active{background:var(--blue-l);}
.cr-entry-thumb{width:44px;height:44px;border-radius:9px;object-fit:cover;flex-shrink:0;background:var(--border);}
.cr-entry-thumb-placeholder{width:44px;height:44px;border-radius:9px;background:var(--blue-l);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
.cr-entry-info{flex:1;}
.cr-entry-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.84rem;color:var(--text);}
.cr-entry-date{font-size:.68rem;color:var(--text-m);margin-top:2px;}
.cr-entry-del{background:none;border:none;font-size:.9rem;color:var(--text-l);cursor:pointer;padding:4px;border-radius:7px;transition:all .15s;}
.cr-entry-del:active{background:var(--red-l);color:var(--red);}

/* ORDONNANCES */
.ordo-item{background:var(--white);border-radius:15px;border:2px solid var(--blue);padding:13px 15px;display:flex;align-items:center;gap:12px;margin-bottom:8px;box-shadow:var(--shadow);}
.ordo-icon{width:42px;height:42px;border-radius:11px;background:var(--blue-l);display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;}
.ordo-info{flex:1;}
.ordo-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.86rem;}
.ordo-date{font-size:.7rem;color:var(--text-m);margin-top:2px;}
.ordo-btn{background:var(--blue);color:white;border:none;border-radius:9px;padding:7px 11px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.73rem;cursor:pointer;}

/* KITS */
.kit-card{background:var(--white);border-radius:15px;border:1.5px solid var(--border);margin-bottom:8px;box-shadow:var(--shadow);overflow:hidden;}
.kit-hd{padding:13px 15px;display:flex;align-items:center;gap:11px;cursor:pointer;}
.kit-icon{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.15rem;flex-shrink:0;}
.kit-info{flex:1;}
.kit-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.86rem;}
.kit-sub{font-size:.7rem;color:var(--text-m);margin-top:1px;}
.kit-body{padding:0 15px;max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease;}
.kit-card.open .kit-body{max-height:300px;padding:0 15px 13px;}
.kit-dl-btn{width:100%;padding:10px;border-radius:11px;border:none;font-family:'Nunito',sans-serif;font-weight:700;font-size:.8rem;cursor:pointer;margin-bottom:5px;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .15s;}
.kit-dl-btn:active{transform:scale(.97);}
.kit-dl-btn.blue{background:var(--blue);color:white;box-shadow:0 3px 10px rgba(74,144,217,.28);}
.kit-dl-btn.orange{background:var(--orange);color:white;}
.kit-dl-btn.green{background:var(--green);color:white;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RÃ‰GLAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-section{margin:0 16px 4px;}
.settings-item{background:var(--white);border-radius:14px;border:1.5px solid var(--border);padding:13px 15px;display:flex;align-items:center;gap:11px;margin-bottom:7px;box-shadow:var(--shadow);cursor:pointer;transition:background .1s;}
.settings-item:active{background:var(--bg);}
.settings-icon{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.05rem;flex-shrink:0;}
.settings-info{flex:1;}
.settings-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.86rem;}
.settings-sub{font-size:.7rem;color:var(--text-m);margin-top:1px;}
.settings-arrow{color:var(--text-l);font-size:.88rem;}
.toggle-row{background:var(--white);border-radius:14px;border:1.5px solid var(--border);padding:13px 15px;display:flex;align-items:center;gap:11px;margin-bottom:7px;box-shadow:var(--shadow);}
.toggle-info{flex:1;}
.toggle-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.86rem;}
.toggle-sub{font-size:.7rem;color:var(--text-m);margin-top:1px;}
.toggle{position:relative;width:40px;height:23px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--border);border-radius:20px;cursor:pointer;transition:.2s;}
.toggle-slider::before{content:'';position:absolute;width:17px;height:17px;left:3px;top:3px;background:white;border-radius:50%;transition:.2s;box-shadow:0 1px 4px rgba(0,0,0,.14);}
.toggle input:checked+.toggle-slider{background:var(--blue);}
.toggle input:checked+.toggle-slider::before{transform:translateX(17px);}
.perm-banner{background:var(--orange-l);border:2px solid var(--orange);border-radius:13px;padding:13px 15px;margin:10px 16px 0;display:none;animation:fadeUp .4s ease;}
.perm-banner p{font-size:.82rem;color:var(--text);font-weight:600;}
.perm-banner button{margin-top:7px;background:var(--orange);color:white;border:none;border-radius:9px;padding:7px 14px;font-family:'Nunito',sans-serif;font-weight:700;cursor:pointer;font-size:.82rem;display:flex;align-items:center;gap:5px;}
.notif-status{display:inline-flex;align-items:center;gap:6px;background:var(--blue-l);color:var(--blue);border-radius:30px;padding:5px 13px;font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:700;margin-top:9px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;
  background:rgba(255,255,255,.95);
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  border-top:1px solid rgba(200,228,250,.7);
  display:grid;grid-template-columns:repeat(4,1fr);
  padding:7px 0 env(safe-area-inset-bottom, 14px);
  z-index:100;
}
.bnav{display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;padding:4px 6px;border:none;background:none;font-family:'Quicksand',sans-serif;transition:all .15s;border-radius:11px;position:relative;}
.bnav::after{content:'';position:absolute;top:-1px;left:50%;transform:translateX(-50%);width:0;height:3px;background:var(--blue);border-radius:0 0 3px 3px;transition:width .2s;}
.bnav.active::after{width:22px;}
.bnav-img{width:26px;height:26px;object-fit:contain;transition:transform .2s cubic-bezier(.34,1.56,.64,1);}
.bnav-label{font-size:.58rem;font-weight:700;color:var(--text-m);transition:color .15s;}
.bnav.active .bnav-img{transform:scale(1.12);}
.bnav.active .bnav-label{color:var(--blue);font-weight:900;}
.bnav-badge{position:absolute;top:0;right:50%;margin-right:-17px;background:var(--red);color:white;font-size:.48rem;font-weight:800;padding:2px 5px;border-radius:10px;font-family:'Nunito',sans-serif;min-width:15px;text-align:center;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.confetti-wrap{position:fixed;inset:0;pointer-events:none;z-index:999;display:none;}
.confetti-wrap.show{display:block;}
.confetti{position:absolute;border-radius:2px;animation:confettiFall var(--dur) ease-in forwards;animation-delay:var(--delay);}
@keyframes confettiFall{0%{transform:translateY(-20px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* add-event */
.add-event-btn{width:100%;padding:12px;border-radius:13px;border:2px dashed var(--border);background:var(--bg);color:var(--text-m);font-family:'Nunito',sans-serif;font-weight:700;font-size:.85rem;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:7px;}
.add-event-btn:active{transform:scale(.97);}

/* section-divider */
.sdiv{height:1px;background:var(--border);margin:6px 16px;}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : MON AGENDA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-agenda">

  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" class="header-logo">
    <button class="notif-btn" onclick="goPage('page-reglages')">
      ğŸ””<div class="notif-dot"></div>
    </button>
  </div>

  <!-- HERO â€” focalisÃ© sur l'essentiel -->
  <div class="hero">
    <div class="hero-row1">
      <div>
        <div class="hero-greeting">ğŸ‘‹ Bonjour</div>
        <div class="hero-name" id="hero-name">Jules !</div>
      </div>
      <div id="mascot" class="hero-mascot">ğŸ¦¸</div>
    </div>

    <!-- Instruction du jour : encart net -->
    <div class="hero-instruction" style="text-align:center;">
      <div class="hero-instr-label" style="margin-bottom:6px;">Aujourd'hui, colle le cache sur ton :</div>
      <div style="font-family:'Nunito',sans-serif;font-size:1.25rem;font-weight:900;letter-spacing:.04em;text-shadow:0 2px 8px rgba(0,0,0,.18);margin-bottom:6px;">
        ğŸ‘ &nbsp;<span id="hero-oeil-txt">Å’IL GAUCHE</span>
      </div>
      <div class="hero-instr-horaire" style="margin-bottom:4px;">de 8h Ã  18h &nbsp;Â·&nbsp; Objectif 10h ğŸš€</div>
      <div style="font-size:.82rem;font-weight:600;opacity:.88;">Bon courage champion !</div>
    </div>

    <!-- Barre de progression journÃ©e -->
    <div class="hero-day-progress" style="position:relative;z-index:1;margin-bottom:4px;">
      <div style="font-size:.6rem;font-weight:800;opacity:.78;letter-spacing:.04em;margin-bottom:5px;">La journÃ©e en cours :</div>
      <div class="hero-day-times">
        <span>8h00</span>
        <span id="hero-now-label" style="font-size:.66rem;font-weight:800;background:rgba(255,255,255,.22);padding:1px 7px;border-radius:20px;"></span>
        <span>18h00</span>
      </div>
      <div class="hero-day-bar-bg">
        <div class="hero-day-bar" id="hero-day-bar" style="width:0%"></div>
      </div>
    </div>

    <!-- Semainier -->
    <div style="position:relative;z-index:1;margin-top:10px;">
      <div style="font-size:.6rem;font-weight:800;opacity:.78;letter-spacing:.04em;margin-bottom:6px;">La semaine en cours :</div>
      <div id="hero-semainier" style="display:flex;gap:4px;"></div>
    </div>
  </div>

  <!-- PERMISSION BANNER -->
  <div class="perm-banner" id="perm-banner">
    <p>ğŸ”” Active les notifications pour les rappels de Jules !</p>
    <button onclick="demanderPermission()">ğŸ”” Activer</button>
  </div>

  <!-- â•â•â• ACTION DU JOUR â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--blue-l);">ğŸ©¹</div>
    Action du jour
  </div>

  <div class="action-card" id="saisie-card">
    <div class="action-card-header">
      <div class="action-card-title">
        ğŸŒ™ Ce soir â€” valider le port
      </div>
      <div class="action-card-date" id="saisie-date">Vendredi 27 fÃ©v.</div>
    </div>
    <div class="action-card-body" id="saisie-form">
      <!-- locked avant 18h -->
      <div class="locked-msg" id="today-locked">
        <span>ğŸ”’</span>
        <span>Disponible Ã  partir de 18h00</span>
      </div>
      <div id="today-slider-content" style="display:none;">
        <div id="today-dur" style="text-align:center;margin-bottom:10px;">
          <span style="font-family:'Nunito',sans-serif;font-size:1.4rem;font-weight:900;color:var(--blue);">0h portÃ©es</span>
          <span style="font-size:.75rem;color:var(--text-m);margin-left:8px;">8h00 â†’ 18h00</span>
          <div style="font-size:.7rem;color:var(--text-m);font-weight:700;margin-top:2px;">0% de l'objectif couvert</div>
        </div>
        <!-- Slider drag identique aux jours Ã  complÃ©ter -->
        <div style="position:relative;height:52px;margin:0 8px 14px;user-select:none;">
          <div style="position:absolute;top:50%;left:0;right:0;height:10px;border-radius:5px;background:#CBD5E1;transform:translateY(-50%);"></div>
          <div id="today-pi-fill" style="position:absolute;top:50%;height:10px;border-radius:5px;background:var(--blue);transform:translateY(-50%);pointer-events:none;transition:left .05s,width .05s;"></div>
          <!-- Trait vert objectif 8h -->
          <div style="position:absolute;top:8px;height:28px;width:2.5px;border-radius:2px;background:#27AE60;left:12.5%;transform:translateX(-50%);pointer-events:none;">
            <span style="position:absolute;top:30px;left:50%;transform:translateX(-50%);font-size:.5rem;font-weight:800;color:#27AE60;white-space:nowrap;">8h</span>
          </div>
          <!-- Trait vert objectif 18h -->
          <div style="position:absolute;top:8px;height:28px;width:2.5px;border-radius:2px;background:#27AE60;left:75%;transform:translateX(-50%);pointer-events:none;">
            <span style="position:absolute;top:30px;left:50%;transform:translateX(-50%);font-size:.5rem;font-weight:800;color:#27AE60;white-space:nowrap;">18h</span>
          </div>
          <!-- Handle dÃ©but -->
          <div id="today-hs" style="position:absolute;top:50%;width:28px;height:28px;border-radius:50%;background:white;border:3px solid var(--blue);box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;">
            <span style="font-size:.52rem;font-weight:900;color:var(--blue);">â–¶</span>
          </div>
          <!-- Handle fin -->
          <div id="today-he" style="position:absolute;top:50%;width:28px;height:28px;border-radius:50%;background:white;border:3px solid var(--blue);box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;">
            <span style="font-size:.52rem;font-weight:900;color:var(--blue);">â—€</span>
          </div>
          <div style="position:absolute;top:-15px;left:0;font-size:.52rem;color:#94A3B8;font-weight:700;">6h</div>
          <div style="position:absolute;top:-15px;right:0;font-size:.52rem;color:#94A3B8;font-weight:700;">22h</div>
        </div>
        <button class="valider-btn" id="valider-btn" onclick="validerSaisie()">Valider âœ“</button>
      </div>
      <div class="congrats-box" id="congrats-box">
        <span class="c-emoji" id="c-emoji">ğŸ‰</span>
        <h3 id="c-title">Bravo Jules !</h3>
        <p id="c-sub">Continue comme Ã§a ğŸ’ª</p>
      </div>
    </div>
  </div>

  <!-- â•â•â• JOURS Ã€ COMPLÃ‰TER â•â•â• -->
  <div id="pending-section" style="margin-top:4px;">
    <div class="section-title">
      <div class="section-title-icon" style="background:var(--orange-l);">ğŸ“‹</div>
      Jours Ã  complÃ©ter
    </div>
    <div class="pending-section" id="pending-list-wrap">
      <div id="pending-list"></div>
    </div>
  </div>

  <!-- â•â•â• CALENDRIER â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--blue-l);">ğŸ“…</div>
    Calendrier mensuel
  </div>

  <div class="card">
    <div class="cal-hd">
      <div class="cal-nav">
        <button class="cal-nav-btn" onclick="calPrev()">â€¹</button>
        <div class="cal-month-label" id="cal-month-label">FÃ©vrier 2026</div>
        <button class="cal-nav-btn" onclick="calNext()">â€º</button>
      </div>
      <div>
        <div class="cal-score-val" id="cal-score-val">84%</div>
        <div class="cal-score-label">observance</div>
      </div>
    </div>
    <div class="cal-day-labels"><div class="cdl">L</div><div class="cdl">M</div><div class="cdl">M</div><div class="cdl">J</div><div class="cdl">V</div><div class="cdl">S</div><div class="cdl">D</div></div>
    <div class="cal-grid" id="cal-grid"></div>
    <div style="margin-top:11px;border-top:1px solid var(--border);padding-top:9px;font-family:'Nunito',sans-serif;font-size:.7rem;font-weight:700;color:var(--text);display:flex;flex-direction:column;gap:7px;">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:13px;height:13px;border-radius:3px;background:#4A90D9;flex-shrink:0;"></span> OD</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:13px;height:13px;border-radius:3px;background:#2EAFAF;flex-shrink:0;"></span> OG</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:13px;height:13px;border-radius:3px;background:#94A3B8;flex-shrink:0;"></span> Pause â˜•</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:9px;height:9px;border-radius:50%;background:#27AE60;flex-shrink:0;"></span> Objectif rempli</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:9px;height:9px;border-radius:50%;background:#F39C12;flex-shrink:0;"></span> Partiel</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:9px;height:9px;border-radius:50%;background:#E74C3C;flex-shrink:0;"></span> ManquÃ©</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:13px;height:13px;border-radius:3px;border:2px solid #F39C12;flex-shrink:0;font-size:.52rem;display:flex;align-items:center;justify-content:center;">ğŸ¥</span> RDV mÃ©dical</div>
      </div>
    </div>
  </div>

  <div style="margin:8px 16px 0;">
    <button class="add-event-btn" onclick="showToast('BientÃ´t disponible ğŸš§','blue')">
      â• Ajouter un Ã©vÃ©nement
    </button>
  </div>

  <!-- â•â•â• RENDEZ-VOUS â€” bloc unifiÃ© â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:#E0F5F5;">ğŸ—“</div>
    Mes rendez-vous
  </div>

  <div class="rdv-unified">

    <!-- RDV 1 : orthoptiste -->
    <div class="rdv-item-card next" id="rdv-card-0">
      <div class="rdv-date-pill">
        <div class="rdv-day">03</div>
        <div class="rdv-mois">Mar</div>
      </div>
      <div class="rdv-info">
        <div class="rdv-who">ğŸ¥ Bilan orthoptique</div>
        <div class="rdv-detail">14h00 Â· Mme Lecomte</div>
        <div class="rdv-badge-row">
          <span class="rdv-tag next">ğŸ“… Dans 5 jours</span>
        </div>
        <!-- Actions -->
        <div class="rdv-actions" id="rdv-actions-0" style="display:none;">
          <button class="rdv-act-btn call" onclick="window.location.href='tel:+33556000000'">ğŸ“ Appeler</button>
          <button class="rdv-act-btn edit" onclick="showToast('Modification bientÃ´t disponible','blue')">âœï¸ Modifier</button>
          <button class="rdv-act-btn del" onclick="supprimerRdv(0)">ğŸ—‘ Supprimer</button>
        </div>
      </div>
      <button class="rdv-toggle-btn" onclick="toggleRdvActions(0)">â‹¯</button>
    </div>

    <!-- RDV 2 : ophtalmo -->
    <div class="rdv-item-card teal" id="rdv-card-1">
      <div class="rdv-date-pill">
        <div class="rdv-day">07</div>
        <div class="rdv-mois" style="color:rgba(255,255,255,.85)">Avr</div>
      </div>
      <div class="rdv-info">
        <div class="rdv-who">ğŸ‘ ContrÃ´le ophtalmologue</div>
        <div class="rdv-detail">10h30 Â· Dr. Benali</div>
        <div class="rdv-badge-row">
          <span class="rdv-tag ok">âœ“ ConfirmÃ©</span>
        </div>
        <div class="rdv-actions" id="rdv-actions-1" style="display:none;">
          <button class="rdv-act-btn call" onclick="window.location.href='tel:+33556000001'">ğŸ“ Appeler</button>
          <button class="rdv-act-btn edit" onclick="showToast('Modification bientÃ´t disponible','blue')">âœï¸ Modifier</button>
          <button class="rdv-act-btn del" onclick="supprimerRdv(1)">ğŸ—‘ Supprimer</button>
        </div>
      </div>
      <button class="rdv-toggle-btn" onclick="toggleRdvActions(1)">â‹¯</button>
    </div>

    <!-- RDV 3 : Ã  planifier -->
    <div class="rdv-item-card warn" id="rdv-card-2">
      <div class="rdv-date-pill">
        <div class="rdv-day">ğŸ“‹</div>
      </div>
      <div class="rdv-info">
        <div class="rdv-who">ğŸ©º Prochain suivi</div>
        <div class="rdv-detail">Juin Â· Dr. Benali</div>
        <div class="rdv-badge-row">
          <span class="rdv-tag warn">â° Ã€ planifier</span>
          <button onclick="showToast('Ouverture Doctolibâ€¦','blue')" style="background:#0596DE;color:white;border:none;border-radius:7px;padding:2px 9px;font-family:'Nunito',sans-serif;font-weight:800;font-size:.62rem;cursor:pointer;">ğŸ“… Prendre RDV</button>
        </div>
        <div class="rdv-actions" id="rdv-actions-2" style="display:none;">
          <button class="rdv-act-btn edit" onclick="showToast('Modification bientÃ´t disponible','blue')">âœï¸ Modifier</button>
          <button class="rdv-act-btn del" onclick="supprimerRdv(2)">ğŸ—‘ Supprimer</button>
        </div>
      </div>
      <button class="rdv-toggle-btn" onclick="toggleRdvActions(2)">â‹¯</button>
    </div>

  </div>

  <!-- â•â•â• MES CONTACTS â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--teal-l);">ğŸ“</div>
    Mes contacts
  </div>

  <div style="margin:0 16px;display:flex;flex-direction:column;gap:8px;">

    <!-- Orthoptiste -->
    <div class="contact-card">
      <div class="contact-avatar" style="background:var(--blue);">L</div>
      <div class="contact-info">
        <div class="contact-name">Mme Lecomte</div>
        <div class="contact-role">Orthoptiste</div>
        <div class="contact-addr">Cabinet Saint-Augustin Â· 12 rue de la SantÃ©, Bordeaux</div>
      </div>
      <div class="contact-actions">
        <button class="contact-btn phone" onclick="window.location.href='tel:+33556000000'" title="Appeler">ğŸ“</button>
        <button class="contact-btn mail" onclick="window.location.href='mailto:lecomte@cabinet-ortho.fr'" title="Email">âœ‰ï¸</button>
        <button class="contact-btn rdv" onclick="showToast('Ouverture Doctolibâ€¦','blue')" title="Prendre RDV">ğŸ“…</button>
      </div>
    </div>

    <!-- Ophtalmologue -->
    <div class="contact-card">
      <div class="contact-avatar" style="background:var(--teal);">B</div>
      <div class="contact-info">
        <div class="contact-name">Dr. Benali</div>
        <div class="contact-role">Ophtalmologue</div>
        <div class="contact-addr">Clinique du Regard Â· 5 av. Victor Hugo, Bordeaux</div>
      </div>
      <div class="contact-actions">
        <button class="contact-btn phone" onclick="window.location.href='tel:+33556000001'" title="Appeler">ğŸ“</button>
        <button class="contact-btn mail" onclick="window.location.href='mailto:benali@clinique-regard.fr'" title="Email">âœ‰ï¸</button>
        <button class="contact-btn rdv" onclick="showToast('Ouverture Doctolibâ€¦','teal')" title="Prendre RDV">ğŸ“…</button>
      </div>
    </div>

  </div>

  <div style="height:10px;"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : MES PROGRÃˆS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-progres">

  <div class="app-header" style="justify-content:center;">
    <img src="amblyup-logo.png" alt="Amblyup" class="header-logo">
  </div>
  <div class="page-title">
    <div class="page-title-icon" style="background:#E8F8F4;"><img src="progres.png" style="width:22px;height:22px;object-fit:contain;" alt="progrÃ¨s"></div>
    <div><div class="page-title-text">Mes progrÃ¨s</div><div class="page-title-sub">Vision, observance & badges</div></div>
  </div>

  <!-- â•â•â• KPI STRIP â€” badge + 3 stats â•â•â• -->
  <div class="kpi-strip">
    <div class="kpi-strip-top">
      <div class="kpi-badge-icon">ğŸ…</div>
      <div>
        <div class="kpi-badge-label">Badge actuel</div>
        <div class="kpi-badge-name">Champion</div>
        <div class="kpi-badge-sub">40 Ã©toiles atteintes âœ“</div>
      </div>
    </div>
    <div class="kpi-cols">
      <div class="kpi-col">
        <div class="kpi-col-phrase">J'ai rÃ©ussi Ã <br>porter le cache :</div>
        <div class="kpi-col-val">12</div>
        <div class="kpi-col-label">jours d'affilÃ©e</div>
      </div>
      <div class="kpi-col">
        <div class="kpi-col-phrase">J'ai atteint :</div>
        <div class="kpi-col-val">84%</div>
        <div class="kpi-col-label">de mes objectifs<br>ce mois</div>
      </div>
      <div class="kpi-col">
        <div class="kpi-col-phrase">J'ai gagnÃ© :</div>
        <div class="kpi-col-val">47â­</div>
        <div class="kpi-col-label">Ã©toiles</div>
      </div>
    </div>
  </div>

  <!-- â•â•â• PROCHAIN OBJECTIF â€” carte sÃ©parÃ©e â•â•â• -->
  <div class="next-obj-card">
    <!-- Accroche principale trÃ¨s visible -->
    <div style="text-align:center;margin-bottom:14px;padding:12px 10px;background:linear-gradient(135deg,var(--orange-l),#fff8e1);border-radius:12px;border:2px solid var(--orange);">
      <div style="font-size:1.8rem;margin-bottom:4px;">ğŸ†</div>
      <div style="font-family:'Nunito',sans-serif;font-size:1.15rem;font-weight:900;color:var(--orange-d);line-height:1.2;">Plus que <span style="font-size:1.5rem;color:var(--red);">3 Ã©toiles</span></div>
      <div style="font-family:'Nunito',sans-serif;font-size:.88rem;font-weight:800;color:var(--orange-d);margin-top:3px;">avant de gagner le badge <strong>HÃ©ros â­</strong></div>
    </div>
    <div class="next-obj-top">
      <div class="next-obj-label">Progression vers HÃ©ros</div>
      <div class="next-obj-name"><span class="next-obj-stars">47 / 50 Ã©toiles</span></div>
    </div>
    <div class="next-obj-bar-bg">
      <div class="next-obj-bar" style="width:94%"></div>
    </div>
    <div class="next-obj-pct">94% du chemin parcouru ğŸš€</div>
    <!-- Timeline badges scrollable -->
    <div style="margin-top:12px;border-top:1px solid var(--border);padding-top:10px;">
      <div style="font-family:'Nunito',sans-serif;font-size:.65rem;font-weight:800;color:var(--text-m);text-transform:uppercase;letter-spacing:.07em;margin-bottom:7px;">Parcours badges</div>
      <div class="badges-timeline" id="badges-timeline"></div>
    </div>
  </div>

  <!-- â•â•â• COURBE D'ACUITÃ‰ â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--blue-l);">ğŸ‘</div>
    Courbe d'acuitÃ© visuelle
  </div>
  <div class="card">
    <div class="vision-hd">
      <div style="font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;">Progression</div>
      <div class="vision-tabs">
        <button class="vtab active" onclick="activateVtab(this)">3 mois</button>
        <button class="vtab" onclick="activateVtab(this)">6 mois</button>
        <button class="vtab" onclick="activateVtab(this)">Tout</button>
      </div>
    </div>
    <div class="vision-eyes">
      <div class="eye-stat eye-od"><div class="eye-label">Å’il droit (OD)</div><div class="eye-val">6/10</div><div class="eye-prog">â†‘ +2/10 depuis dÃ©c.</div></div>
      <div class="eye-stat eye-og"><div class="eye-label">Å’il gauche (OG)</div><div class="eye-val">9/10</div><div class="eye-prog">â†‘ +1/10 depuis dÃ©c.</div></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-labels-y"><span>10</span><span>8</span><span>6</span><span>4</span><span>2</span></div>
      <div class="chart-svg">
        <svg viewBox="0 0 340 120" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%">
          <defs>
            <linearGradient id="gOD" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4A90D9" stop-opacity=".2"/><stop offset="100%" stop-color="#4A90D9" stop-opacity="0"/></linearGradient>
            <linearGradient id="gOG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#5BBF8E" stop-opacity=".2"/><stop offset="100%" stop-color="#5BBF8E" stop-opacity="0"/></linearGradient>
          </defs>
          <line x1="0" y1="0" x2="340" y2="0" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="24" x2="340" y2="24" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="48" x2="340" y2="48" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="72" x2="340" y2="72" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="96" x2="340" y2="96" stroke="#EAF4FF" stroke-width="1"/>
          <polygon points="0,108 68,96 136,72 204,84 272,72 340,48 340,120 0,120" fill="url(#gOD)"/>
          <polyline points="0,108 68,96 136,72 204,84 272,72 340,48" fill="none" stroke="#4A90D9" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="108" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="68" cy="96" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="136" cy="72" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="204" cy="84" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="272" cy="72" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="340" cy="48" r="5" fill="#4A90D9" stroke="white" stroke-width="2.5"/>
          <text x="326" y="41" font-size="9" fill="#2E6DB4" font-weight="800" font-family="Nunito">6/10</text>
          <polygon points="0,12 68,6 136,0 204,6 272,12 340,12 340,50 0,50" fill="url(#gOG)"/>
          <polyline points="0,12 68,6 136,0 204,6 272,12 340,12" fill="none" stroke="#5BBF8E" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="12" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="68" cy="6" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="136" cy="0" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="204" cy="6" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="272" cy="12" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="340" cy="12" r="5" fill="#5BBF8E" stroke="white" stroke-width="2.5"/>
          <text x="326" y="8" font-size="9" fill="#3A8F68" font-weight="800" font-family="Nunito">9/10</text>
          <text x="0" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Nov</text>
          <text x="68" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">DÃ©c</text>
          <text x="136" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Jan</text>
          <text x="204" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">FÃ©v</text>
          <text x="272" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Mar</text>
          <text x="340" y="115" font-size="8" fill="#4A90D9" font-family="Nunito" font-weight="800" text-anchor="middle">Auj.</text>
        </svg>
      </div>
    </div>
    <div class="vision-legend">
      <div class="vleg"><div class="vleg-line" style="background:#4A90D9"></div>Å’il droit</div>
      <div class="vleg"><div class="vleg-line" style="background:#5BBF8E"></div>Å’il gauche</div>
    </div>
  </div>

  <!-- â•â•â• OBSERVANCE â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--blue-l);">ğŸ“Š</div>
    Taux d'observance
  </div>
  <div class="card">
    <div class="obs-big">
      <div class="obs-pct">84%</div>
      <div class="obs-label">Ce mois Â· objectif 4h/jour</div>
    </div>
    <div class="obs-bar-wrap"><div class="obs-bar" id="obs-bar" style="width:0%"></div></div>
    <div class="obs-months">
      <div class="obs-month"><div class="obs-month-val">91%</div><div class="obs-month-label">DÃ©cembre</div></div>
      <div class="obs-month"><div class="obs-month-val">78%</div><div class="obs-month-label">Janvier</div></div>
      <div class="obs-month"><div class="obs-month-val">84%</div><div class="obs-month-label">FÃ©vrier</div></div>
    </div>
  </div>

  <!-- â•â•â• BADGES LISTE â•â•â• -->
  <div class="section-title">
    <div class="section-title-icon" style="background:var(--orange-l);">ğŸ†</div>
    Badges & rÃ©compenses
  </div>
  <div class="card" id="badges-section"></div>
  <div style="height:10px;"></div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : MES DOCS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-docs">
  <div class="app-header" style="justify-content:center;">
    <img src="amblyup-logo.png" alt="Amblyup" class="header-logo">
  </div>
  <div class="page-title">
    <div class="page-title-icon" style="background:#FEF3C7;"><img src="docs.png" style="width:22px;height:22px;object-fit:contain;" alt="docs"></div>
    <div><div class="page-title-text">Mes documents</div><div class="page-title-sub">Ordonnances & ressources</div></div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">ğŸ“„</div> Ordonnances</div>
  <div style="margin:0 16px">
    <div class="ordo-item">
      <div class="ordo-icon">ğŸ©¹</div>
      <div class="ordo-info"><div class="ordo-title">Ordonnance cache-Å“il</div><div class="ordo-date">Dr. Benali Â· 15 janvier 2026 Â· 20 sÃ©ances</div></div>
      <button class="ordo-btn">Voir</button>
    </div>
    <div class="ordo-item" style="border-color:var(--green)">
      <div class="ordo-icon" style="background:var(--green-l)">ğŸ‘“</div>
      <div class="ordo-info"><div class="ordo-title">Ordonnance lunettes</div><div class="ordo-date">Dr. Benali Â· 15 janvier 2026</div></div>
      <button class="ordo-btn" style="background:var(--green)">Voir</button>
    </div>
  </div>

  <!-- â•â•â• COMPTES RENDUS â•â•â• -->
  <div class="section-title" style="padding-top:14px;">
    <div class="section-title-icon" style="background:#F0E8FF;">ğŸ“‹</div>
    Mes comptes rendus
  </div>

  <div class="doc-list">

    <!-- Ophtalmologue -->
    <div class="doc-item" id="cr-ophtalmo" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon" style="background:#E0F5F5;">ğŸ‘</div>
        <div class="doc-item-info">
          <div class="doc-item-title">Ophtalmologue â€” Dr. Benali</div>
          <div class="doc-item-sub" id="cr-ophtalmo-count">2 comptes rendus</div>
        </div>
        <div class="doc-item-arrow">â€º</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list" id="cr-ophtalmo-list">
          <!-- EntrÃ©es gÃ©nÃ©rÃ©es par JS -->
        </div>
        <button class="cr-add-btn" onclick="event.stopPropagation();ouvrirAjoutCR('ophtalmo')">
          ğŸ“· Ajouter un compte rendu
        </button>
      </div>
    </div>

    <!-- Orthoptiste -->
    <div class="doc-item" id="cr-ortho" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon" style="background:var(--blue-l);">ğŸ¥</div>
        <div class="doc-item-info">
          <div class="doc-item-title">Orthoptiste â€” Mme Lecomte</div>
          <div class="doc-item-sub" id="cr-ortho-count">3 comptes rendus</div>
        </div>
        <div class="doc-item-arrow">â€º</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list" id="cr-ortho-list">
          <!-- EntrÃ©es gÃ©nÃ©rÃ©es par JS -->
        </div>
        <button class="cr-add-btn" onclick="event.stopPropagation();ouvrirAjoutCR('ortho')">
          ğŸ“· Ajouter un compte rendu
        </button>
      </div>
    </div>

  </div>

  <!-- Modal ajout CR -->
  <div id="cr-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:200;align-items:flex-end;justify-content:center;">
    <div style="background:white;border-radius:22px 22px 0 0;padding:22px 20px 36px;width:100%;max-width:430px;box-shadow:0 -8px 32px rgba(0,0,0,.18);">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;color:var(--text);" id="cr-modal-title">Ajouter un compte rendu</div>
        <button onclick="fermerModalCR()" style="background:var(--bg);border:none;border-radius:50%;width:30px;height:30px;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;">âœ•</button>
      </div>

      <!-- Zone aperÃ§u photo -->
      <div id="cr-preview-wrap" style="position:relative;background:var(--bg);border:2px dashed var(--border);border-radius:14px;min-height:160px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;margin-bottom:14px;overflow:hidden;cursor:pointer;" onclick="document.getElementById('cr-file-input').click()">
        <img id="cr-preview-img" src="" alt="" style="display:none;width:100%;height:200px;object-fit:cover;border-radius:12px;">
        <div id="cr-preview-placeholder">
          <div style="font-size:2.5rem;margin-bottom:6px;">ğŸ“·</div>
          <div style="font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;color:var(--text-m);">Appuyer pour prendre une photo</div>
          <div style="font-size:.72rem;color:var(--text-l);margin-top:3px;">ou importer depuis la galerie</div>
        </div>
      </div>

      <!-- Input file cachÃ© â€” capture=environment pour ouvrir camÃ©ra sur mobile -->
      <input type="file" id="cr-file-input" accept="image/*" capture="environment" style="display:none;" onchange="previewCR(this)">

      <!-- Titre optionnel -->
      <input type="text" id="cr-titre" placeholder="Titre (ex: Bilan jan. 2026) â€” optionnel"
        style="width:100%;box-sizing:border-box;padding:10px 13px;border-radius:11px;border:1.5px solid var(--border);font-family:'Quicksand',sans-serif;font-size:.85rem;color:var(--text);background:var(--bg);outline:none;margin-bottom:12px;"
        onfocus="this.style.borderColor='var(--blue)'" onblur="this.style.borderColor='var(--border)'">

      <!-- Date automatique modifiable -->
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;">
        <span style="font-size:.78rem;color:var(--text-m);font-weight:600;flex-shrink:0;">Date :</span>
        <input type="date" id="cr-date" style="flex:1;padding:8px 11px;border-radius:10px;border:1.5px solid var(--border);font-family:'Quicksand',sans-serif;font-size:.82rem;color:var(--text);background:var(--bg);outline:none;"
          onfocus="this.style.borderColor='var(--blue)'" onblur="this.style.borderColor='var(--border)'">
      </div>

      <button id="cr-save-btn" onclick="sauvegarderCR()" style="width:100%;padding:14px;border-radius:13px;border:none;background:var(--blue);color:white;font-family:'Nunito',sans-serif;font-weight:900;font-size:.95rem;cursor:pointer;box-shadow:0 4px 14px rgba(74,144,217,.3);opacity:.5;" disabled>
        ğŸ’¾ Enregistrer
      </button>
    </div>
  </div>

  <div class="doc-section-hd">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Pour les parents</div>
  <div class="doc-list">
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon blue">ğŸ“–</div><div class="doc-item-info"><div class="doc-item-title">Comprendre l'amblyopie</div><div class="doc-item-sub">Causes, dÃ©pistage, risques, traitement</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ“˜</span><span class="doc-sub-text">L'amblyopie : causes, dÃ©pistage, risques</span><span class="doc-sub-badge pdf">PDF</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ“—</span><span class="doc-sub-text">L'amblyothÃ©rapie : objectifs, dispositifs, Ã©tapes clÃ©s</span><span class="doc-sub-badge pdf">PDF</span></div></div></div>
    </div>
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon orange">ğŸ’¡</div><div class="doc-item-info"><div class="doc-item-title">Conseils pratiques</div><div class="doc-item-sub">Poser, enlever, motiver, routine</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸŒ…</span><span class="doc-sub-text">Les premiers jours : annoncer & prÃ©parer</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ©¹</span><span class="doc-sub-text">Poser le patch / filtre (infographie)</span><span class="doc-sub-badge new">Infographie</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸŒ¸</span><span class="doc-sub-text">Enlever le patch en douceur</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ¯</span><span class="doc-sub-text">Customiser le patch</span><span class="doc-sub-badge new">IdÃ©es</span></div></div></div>
    </div>
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon green">ğŸ®</div><div class="doc-item-info"><div class="doc-item-title">Motiver & crÃ©er la routine</div><div class="doc-item-sub">IdÃ©es, poster, tableau de rÃ©compenses</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ’¡</span><span class="doc-sub-text">IdÃ©es pour motiver</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ–¨</span><span class="doc-sub-text">Poster Ã  imprimer</span><span class="doc-sub-badge pdf">PDF</span></div><div class="doc-sub-item"><span class="doc-sub-icon">â­</span><span class="doc-sub-text">Tableau de rÃ©compenses</span><span class="doc-sub-badge pdf">PDF</span></div><div class="doc-sub-item"><span class="doc-sub-icon">â±</span><span class="doc-sub-text">Timer visuel (mini-app)</span><span class="doc-sub-badge new">App</span></div></div></div>
    </div>
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon teal">ğŸ’¬</div><div class="doc-item-info"><div class="doc-item-title">TÃ©moignages & aller plus loin</div><div class="doc-item-sub">Familles, articles, guides officiels</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span class="doc-sub-text">TÃ©moignages parents / enfants</span><span class="doc-sub-badge video">VidÃ©o</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ“°</span><span class="doc-sub-text">Articles vulgarisÃ©s</span><span class="doc-sub-badge pdf">PDF</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ“‹</span><span class="doc-sub-text">Guides officiels (HAS, SFO)</span><span class="doc-sub-badge pdf">PDF</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ¤</span><span class="doc-sub-text">Associations & groupes conseillÃ©s</span></div></div></div>
    </div>
  </div>

  <div class="doc-section-hd">ğŸ§’ Pour l'enfant</div>
  <div class="doc-list">
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon orange">ğŸ“š</div><div class="doc-item-info"><div class="doc-item-title">Comprendre avec les enfants</div><div class="doc-item-sub">BD, infographies, mini-jeux</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ¨</span><span class="doc-sub-text">BD : pourquoi je porte un cache ?</span><span class="doc-sub-badge new">Nouveau</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ–¼</span><span class="doc-sub-text">Infographies illustrÃ©es</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ®</span><span class="doc-sub-text">Mini-jeux pÃ©dagogiques</span><span class="doc-sub-badge new">App</span></div></div></div>
    </div>
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon blue">ğŸ—£</div><div class="doc-item-info"><div class="doc-item-title">Expliquer Ã  mes copains</div><div class="doc-item-sub">Cartes prÃªtes Ã  l'emploi</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸƒ</span><span class="doc-sub-text">Cartes d'explication simples</span><span class="doc-sub-badge pdf">PDF</span></div></div></div>
    </div>
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd"><div class="doc-item-icon green">ğŸ’ª</div><div class="doc-item-info"><div class="doc-item-title">Rester motivÃ©</div><div class="doc-item-sub">Livres, films, FAQ, tÃ©moignages</div></div><div class="doc-item-arrow">â€º</div></div>
      <div class="doc-item-body"><div class="doc-sub-list"><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ“–</span><span class="doc-sub-text">Livres / films par Ã¢ge</span></div><div class="doc-sub-item"><span class="doc-sub-icon">â“</span><span class="doc-sub-text">FAQ enfant â€” mes questions</span></div><div class="doc-sub-item"><span class="doc-sub-icon">ğŸ¥</span><span class="doc-sub-text">TÃ©moignages d'anciens amblyopes</span><span class="doc-sub-badge video">VidÃ©o</span></div></div></div>
    </div>
  </div>

  <div class="doc-section-hd">ğŸ–¨ Kits pratiques Ã  imprimer</div>
  <div style="margin:0 16px">
    <div class="kit-card" onclick="toggleKit(this)">
      <div class="kit-hd"><div class="kit-icon" style="background:var(--blue-l)">ğŸ«</div><div class="kit-info"><div class="kit-title">Kit instituteur</div><div class="kit-sub">Pour expliquer Ã  l'Ã©cole</div></div><div style="color:var(--text-l);font-size:.92rem;transition:transform .2s">â€º</div></div>
      <div class="kit-body"><button class="kit-dl-btn blue">ğŸ“„ Fiche "Amblyopie en 2 min"</button><button class="kit-dl-btn orange">ğŸ“… Rythme actualisÃ© de l'enfant</button><button class="kit-dl-btn green">ğŸ“ Expliquer aux autres enfants</button></div>
    </div>
    <div class="kit-card" onclick="toggleKit(this)">
      <div class="kit-hd"><div class="kit-icon" style="background:var(--green-l)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</div><div class="kit-info"><div class="kit-title">Kit famille Ã©largie</div><div class="kit-sub">Grands-parents, oncles, tantes...</div></div><div style="color:var(--text-l);font-size:.92rem;transition:transform .2s">â€º</div></div>
      <div class="kit-body"><button class="kit-dl-btn blue">ğŸ“„ Fiche "Comprendre en 2 min"</button><button class="kit-dl-btn green">ğŸ–¨ Planning imprimable (pÃ©riode au choix)</button></div>
    </div>
  </div>
  <div style="height:10px;"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : RÃ‰GLAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-reglages">
  <div class="app-header" style="justify-content:center;">
    <img src="amblyup-logo.png" alt="Amblyup" class="header-logo">
  </div>
  <div class="page-title">
    <div class="page-title-icon" style="background:#F1F5F9;"><img src="reglages.png" style="width:22px;height:22px;object-fit:contain;" alt="rÃ©glages"></div>
    <div><div class="page-title-text">RÃ©glages</div><div class="page-title-sub">Profil & prÃ©fÃ©rences</div></div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">ğŸ‘¤</div> Profil</div>
  <div class="card" style="display:flex;align-items:center;gap:13px;">
    <div style="width:52px;height:52px;border-radius:50%;background:var(--blue);display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:white;font-family:'Nunito',sans-serif;font-weight:900;flex-shrink:0;">J</div>
    <div style="flex:1">
      <div style="font-family:'Nunito',sans-serif;font-weight:900;font-size:.98rem;">Jules</div>
      <div style="font-size:.72rem;color:var(--text-m);margin-top:2px;">8 ans Â· Amblyopie OD Â· Dr. Benali</div>
    </div>
    <button style="background:var(--blue-l);border:none;border-radius:9px;padding:6px 11px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.72rem;color:var(--blue);cursor:pointer;">Modifier</button>
  </div>

  <!-- Semaine type â€” ici dans les rÃ©glages -->
  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">ğŸ“†</div> Rythme prescrit</div>
  <div class="card">
    <!-- En-tÃªte : orthoptiste + date mise Ã  jour -->
    <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px;gap:8px;">
      <div>
        <div style="font-family:'Nunito',sans-serif;font-size:.82rem;font-weight:900;color:var(--text);">Alternance prescrite par Mme Lecomte</div>
        <div style="font-size:.68rem;color:var(--text-m);font-weight:600;margin-top:2px;">ğŸ“… DerniÃ¨re mise Ã  jour : <strong>15 janvier 2026</strong></div>
      </div>
      <span style="background:var(--green-l);color:var(--green-d);font-size:.6rem;font-weight:800;padding:3px 8px;border-radius:20px;white-space:nowrap;border:1px solid var(--green);flex-shrink:0;">âœ“ Ã€ jour</span>
    </div>

    <!-- Semainier -->
    <div style="display:flex;gap:5px;margin-bottom:14px;">
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#4A90D9;display:flex;align-items:center;justify-content:center;font-size:.54rem;font-weight:900;color:white;">OD</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Lu</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#4A90D9;display:flex;align-items:center;justify-content:center;font-size:.54rem;font-weight:900;color:white;">OD</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Ma</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.54rem;font-weight:900;color:white;">OG</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Me</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.54rem;font-weight:900;color:white;">OG</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Je</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.54rem;font-weight:900;color:white;">OG</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Ve</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#E2E8F0;display:flex;align-items:center;justify-content:center;font-size:.7rem;">â˜•</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Sa</span></div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#E2E8F0;display:flex;align-items:center;justify-content:center;font-size:.7rem;">â˜•</div><span style="font-size:.55rem;font-weight:700;color:var(--text-m);">Di</span></div>
    </div>

    <!-- Bouton signalement -->
    <button onclick="signalerPbRythme()" style="width:100%;padding:11px 14px;border-radius:11px;border:1.5px solid var(--orange);background:var(--orange-l);color:var(--orange-d);font-family:'Nunito',sans-serif;font-weight:800;font-size:.82rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .15s;" onmouseover="this.style.background='#FFE0A0'" onmouseout="this.style.background='var(--orange-l)'">
      âš ï¸ Signaler un rythme non mis Ã  jour
    </button>
    <!-- Formulaire signalement (cachÃ© par dÃ©faut) -->
    <div id="signalement-form" style="display:none;margin-top:12px;padding:13px;background:var(--bg);border-radius:11px;border:1.5px solid var(--border);">
      <div style="font-family:'Nunito',sans-serif;font-weight:800;font-size:.82rem;color:var(--text);margin-bottom:8px;">ğŸ“‹ Signaler un problÃ¨me de rythme</div>
      <textarea id="signalement-msg" placeholder="DÃ©crivez le problÃ¨me : ex. le rythme a changÃ© lors du dernier RDV mais n'a pas Ã©tÃ© mis Ã  jour dans l'application..." style="width:100%;box-sizing:border-box;padding:10px;border-radius:9px;border:1.5px solid var(--border);font-family:'Quicksand',sans-serif;font-size:.8rem;color:var(--text);background:white;resize:none;height:80px;outline:none;" onfocus="this.style.borderColor='var(--orange)'" onblur="this.style.borderColor='var(--border)'"></textarea>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:8px;">
        <button onclick="annulerSignalement()" style="padding:10px;border-radius:9px;border:1.5px solid var(--border);background:white;color:var(--text-m);font-family:'Nunito',sans-serif;font-weight:700;font-size:.8rem;cursor:pointer;">Annuler</button>
        <button onclick="envoyerSignalement()" style="padding:10px;border-radius:9px;border:none;background:var(--orange);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:.8rem;cursor:pointer;box-shadow:0 3px 10px rgba(249,168,37,.3);">ğŸ“¤ Envoyer</button>
      </div>
    </div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">ğŸ””</div> Notifications</div>
  <div class="settings-section">
    <div class="toggle-row"><div class="toggle-info"><div class="toggle-title">Rappel matin â€” mettre le cache</div><div class="toggle-sub">Chaque jour Ã  8h00</div></div><label class="toggle"><input type="checkbox" checked id="t-matin"><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-info"><div class="toggle-title">Rappel soir â€” valider l'observance</div><div class="toggle-sub">Chaque jour Ã  18h00</div></div><label class="toggle"><input type="checkbox" checked id="t-soir"><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-info"><div class="toggle-title">Rappels de rendez-vous</div><div class="toggle-sub">J-2 et J-1 avant chaque RDV</div></div><label class="toggle"><input type="checkbox" checked id="t-rdv"><span class="toggle-slider"></span></label></div>
    <div class="toggle-row"><div class="toggle-info"><div class="toggle-title">Notifications badges & Ã©toiles</div><div class="toggle-sub">Quand Jules dÃ©bloque une rÃ©compense</div></div><label class="toggle"><input type="checkbox" checked id="t-badges"><span class="toggle-slider"></span></label></div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">ğŸ“£</div> Tester les rappels</div>
  <div class="card">
    <div class="perm-banner" id="perm-banner-2" style="margin:0 0 11px;display:none;"><p>ğŸ”” Active les notifications d'abord !</p><button onclick="demanderPermission()">ğŸ”” Activer</button></div>
    <button style="width:100%;border:none;border-radius:13px;padding:14px;margin-bottom:7px;background:var(--blue);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;cursor:pointer;display:flex;align-items:center;gap:9px;text-align:left;box-shadow:0 4px 13px rgba(74,144,217,.28);" onclick="envoyerNotifDelai('cache',this)">
      <span style="font-size:1.3rem">ğŸ´â€â˜ ï¸</span>
      <span>Rappel : mettre le cache<br><span style="font-size:.73rem;opacity:.85;font-weight:500">Envoi dans 5 secondesâ€¦</span></span>
    </button>
    <button style="width:100%;border:none;border-radius:13px;padding:14px;background:var(--green);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;cursor:pointer;display:flex;align-items:center;gap:9px;text-align:left;box-shadow:0 4px 13px rgba(91,191,142,.28);" onclick="envoyerNotifDelai('soir',this)">
      <span style="font-size:1.3rem">ğŸ‰</span>
      <span>PrÃªt Ã  remplir l'observance<br><span style="font-size:.73rem;opacity:.85;font-weight:500">Envoi dans 5 secondesâ€¦</span></span>
    </button>
    <div class="notif-status" id="notif-status">ğŸ’¤ En attente</div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--blue-l);">âš™ï¸</div> ParamÃ¨tres du traitement</div>
  <div class="settings-section">
    <div class="settings-item"><div class="settings-icon" style="background:var(--blue-l)">ğŸ¯</div><div class="settings-info"><div class="settings-title">Objectif quotidien de cache</div><div class="settings-sub">Actuellement : 4h / jour</div></div><div class="settings-arrow">â€º</div></div>
    <div class="settings-item"><div class="settings-icon" style="background:var(--orange-l)">â°</div><div class="settings-info"><div class="settings-title">Plage horaire du cache</div><div class="settings-sub">8h00 â€“ 18h00</div></div><div class="settings-arrow">â€º</div></div>
    <div class="settings-item"><div class="settings-icon" style="background:var(--green-l)">ğŸ‘</div><div class="settings-info"><div class="settings-title">Å’il amblyope</div><div class="settings-sub">Å’il droit (OD)</div></div><div class="settings-arrow">â€º</div></div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--bg);">ğŸ”§</div> Compte</div>
  <div class="settings-section">
    <div class="settings-item"><div class="settings-icon" style="background:var(--blue-l)">ğŸ“±</div><div class="settings-info"><div class="settings-title">Installer sur l'Ã©cran d'accueil</div><div class="settings-sub">AccÃ¨s rapide comme une vraie app</div></div><div class="settings-arrow">â€º</div></div>
    <div class="settings-item"><div class="settings-icon" style="background:var(--green-l)">ğŸ”’</div><div class="settings-info"><div class="settings-title">ConfidentialitÃ© & donnÃ©es</div><div class="settings-sub">RGPD Â· HDS certifiÃ©</div></div><div class="settings-arrow">â€º</div></div>
    <div class="settings-item" onclick="showToast('Version 1.0.0 â€” Amblyup','blue')"><div class="settings-icon" style="background:var(--bg)">â„¹ï¸</div><div class="settings-info"><div class="settings-title">Ã€ propos d'Amblyup</div><div class="settings-sub">Version 1.0.0</div></div><div class="settings-arrow">â€º</div></div>
  </div>

  <div class="section-title"><div class="section-title-icon" style="background:var(--orange-l);">ğŸ</div> Les rÃ©compenses</div>
  <div class="card">
    <div style="font-family:'Nunito',sans-serif;font-size:.8rem;color:var(--text-m);font-weight:600;margin-bottom:11px;line-height:1.5;">DÃ©finissez les rÃ©compenses que Jules gagnera Ã  chaque badge dÃ©bloquÃ©.</div>
    <div id="rewards-form"></div>
  </div>
  <div style="height:10px;"></div>
</div>

<!-- â”€â”€ BOTTOM NAV â”€â”€ -->
<nav class="bottom-nav">
  <button class="bnav active" id="bnav-0" onclick="goPage('page-agenda')"><img class="bnav-img" src="calendrier.png" alt="agenda"><span class="bnav-label">Mon agenda</span></button>
  <button class="bnav" id="bnav-1" onclick="goPage('page-progres')"><img class="bnav-img" src="progres.png" alt="progrÃ¨s"><span class="bnav-label">Mes progrÃ¨s</span></button>
  <button class="bnav" id="bnav-2" onclick="goPage('page-docs')"><img class="bnav-img" src="docs.png" alt="docs"><span class="bnav-label">Mes Docs</span></button>
  <button class="bnav" id="bnav-3" onclick="goPage('page-reglages')"><img class="bnav-img" src="reglages.png" alt="rÃ©glages"><span class="bnav-label">RÃ©glages</span></button>
</nav>

<div class="confetti-wrap" id="confetti"></div>

<script>
'use strict';
let swReg=null,selectedH=null;
const OBJ=4;
let calYear=2026,calMonth=1;
const CAL_CACHE={};
const MONTHS_FR=['Janvier','FÃ©vrier','Mars','Avril','Mai','Juin','Juillet','AoÃ»t','Septembre','Octobre','Novembre','DÃ©cembre'];
const NEXT_RDV=new Date(2026,2,3);
const RDV_DAYS={'2026-3-3':{icon:'ğŸ¥',label:'Orthoptiste'},'2026-4-7':{icon:'ğŸ‘',label:'Ophtalmo'}};

const BADGES=[
  {icon:'ğŸŒ±',name:'Courageux',   desc:'10 Ã©toiles', stars:10, unlocked:true},
  {icon:'ğŸ’ª',name:'PersÃ©vÃ©rant',desc:'20 Ã©toiles', stars:20, unlocked:true},
  {icon:'ğŸ¯',name:'DÃ©terminÃ©',  desc:'30 Ã©toiles', stars:30, unlocked:true},
  {icon:'ğŸ…',name:'Champion',   desc:'40 Ã©toiles', stars:40, unlocked:true},
  {icon:'â­',name:'HÃ©ros',       desc:'50 Ã©toiles', stars:50, unlocked:false},
  {icon:'ğŸ¦¸',name:'Super-HÃ©ros',desc:'60 Ã©toiles', stars:60, unlocked:false},
  {icon:'ğŸ”¬',name:'Expert',      desc:'70 Ã©toiles', stars:70, unlocked:false},
  {icon:'ğŸ“',name:'MaÃ®tre',      desc:'80 Ã©toiles', stars:80, unlocked:false},
  {icon:'ğŸ‘‘',name:'Grand MaÃ®tre',desc:'90 Ã©toiles', stars:90, unlocked:false},
  {icon:'ğŸŒŸ',name:'LÃ©gende',     desc:'100 Ã©toiles',stars:100,unlocked:false},
];
const TOTAL_STARS=47;
const STARS_PER_BADGE=10;

window.addEventListener('load',async()=>{
  try{
    if('serviceWorker' in navigator){
      const needsHttps=location.protocol!=='https:'&&location.hostname!=='localhost';
      if(!needsHttps){
        try{
          swReg=await navigator.serviceWorker.register('sw.js');
          const waitActive=()=>{
            const sw=swReg.installing||swReg.waiting||swReg.active;
            if(!sw)return;
            const activate=()=>{if(Notification.permission==='granted')sw.postMessage('SCHEDULE_NOTIFS');};
            if(sw.state==='activated')activate();
            else sw.addEventListener('statechange',()=>{if(sw.state==='activated')activate();});
          };
          waitActive();
        }catch(e){console.log('SW:'+e.message);}
      }
    }
    if('Notification' in window&&Notification.permission==='default'){
      const b1=document.getElementById('perm-banner');
      const b2=document.getElementById('perm-banner-2');
      if(b1)b1.style.display='block';
      if(b2)b2.style.display='block';
    }
    checkDeepLink();
    initDate();
    buildCalendar();
    buildBadgesSection();
    buildBadgesTimeline();
    buildRewardsForm();
    buildPending();
    buildCRList('ophtalmo');
    buildCRList('ortho');
    initTodaySlider();
    setTimeout(()=>{const b=document.getElementById('obs-bar');if(b)b.style.width='84%';},400);
  }catch(e){console.error('Init:',e);}
});

function goPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const t=document.getElementById(id);if(t)t.classList.add('active');
  document.querySelectorAll('.bnav').forEach(b=>b.classList.remove('active'));
  const map={'page-agenda':0,'page-progres':1,'page-docs':2,'page-reglages':3};
  const idx=map[id];
  const bnavs=document.querySelectorAll('.bnav');
  if(idx!==undefined&&bnavs[idx])bnavs[idx].classList.add('active');
  try{window.scrollTo(0,0);}catch(e){}
}

function eyeForDate(date){
  const dow=date.getDay();
  if(dow===1||dow===2)return'OD';
  if(dow===3||dow===4||dow===5)return'OG';
  return'none';
}

function buildHeroSemainier(){
  const wrap=document.getElementById('hero-semainier');if(!wrap)return;
  const today=new Date();today.setHours(0,0,0,0);
  // Trouver lundi de la semaine en cours
  const dow=today.getDay();
  const mondayOffset=dow===0?-6:1-dow;
  const monday=new Date(today);monday.setDate(today.getDate()+mondayOffset);
  const days=['Lu','Ma','Me','Je','Ve','Sa','Di'];
  wrap.innerHTML='';
  for(let i=0;i<7;i++){
    const d=new Date(monday);d.setDate(monday.getDate()+i);
    const isToday=d.getTime()===today.getTime();
    const eye=eyeForDate(d);
    const isPause=eye==='none';
    const bg=isPause?'rgba(255,255,255,.12)':eye==='OD'?'#4A90D9':'#2EAFAF';
    const label=isPause?'â˜•':(eye==='OD'?'OD':'OG');
    const fontSize=isPause?'.8rem':'.52rem';
    const outline=isToday?'outline:2.5px solid rgba(255,255,255,.95);outline-offset:2px;':'';
    const dayNumStyle=isToday?'font-weight:900;opacity:1;':'font-weight:700;opacity:.75;';
    wrap.innerHTML+=
      '<div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">'+
        '<div style="width:100%;aspect-ratio:1;border-radius:8px;background:'+bg+';display:flex;align-items:center;justify-content:center;font-size:'+fontSize+';font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);'+outline+'">'+label+'</div>'+
        '<span style="font-size:.55rem;'+dayNumStyle+'color:white;">'+days[i]+'</span>'+
        '<span style="font-size:.5rem;font-weight:800;color:rgba(255,255,255,.7);">'+d.getDate()+'</span>'+
      '</div>';
  }
}

// â”€â”€ Slider "Action du jour" avec drag handles â”€â”€
const todayState={start:8,end:18};
function hToPosTd(h){return((h-6)/16)*100;}
function posToHTd(pct){return Math.max(6,Math.min(22,Math.round(pct/100*16+6)));}
function fmtHTd(h){return h+'h00';}

function updateTodaySlider(){
  const s=todayState.start,e=todayState.end;
  const sp=hToPosTd(s),ep=hToPosTd(e);
  const hs=document.getElementById('today-hs');
  const he=document.getElementById('today-he');
  const fill=document.getElementById('today-pi-fill');
  const dur=document.getElementById('today-dur');
  if(hs)hs.style.left=sp+'%';
  if(he)he.style.left=ep+'%';
  if(fill){fill.style.left=sp+'%';fill.style.width=(ep-sp)+'%';}
  if(dur){
    const hours=e-s;
    const covered=Math.max(0,Math.min(e,18)-Math.max(s,8));
    const pct=Math.round(covered/10*100);
    const col=hours>=10?'#27AE60':hours>=5?'#F39C12':'var(--blue)';
    const vbtn=document.getElementById('valider-btn');
    if(vbtn)vbtn.disabled=false;
    dur.innerHTML=
      '<span style="font-family:Nunito,sans-serif;font-size:1.4rem;font-weight:900;color:'+col+';">'+hours+'h portÃ©es</span>'+
      '<span style="font-size:.75rem;color:var(--text-m);margin-left:8px;">'+fmtHTd(s)+' â†’ '+fmtHTd(e)+'</span>'+
      '<div style="font-size:.7rem;color:'+col+';font-weight:700;margin-top:2px;">'+pct+'% de l\'objectif couvert</div>';
  }
}

function initTodayDrag(){
  ['today-hs','today-he'].forEach(id=>{
    const el=document.getElementById(id);if(!el)return;
    const side=id==='today-hs'?'start':'end';
    let dragging=false;
    const handleMove=clientX=>{
      const track=el.parentElement;
      const rect=track.getBoundingClientRect();
      let pct=Math.max(0,Math.min(100,(clientX-rect.left)/rect.width*100));
      let h=posToHTd(pct);
      if(side==='start')todayState.start=Math.min(h,todayState.end-1);
      else todayState.end=Math.max(h,todayState.start+1);
      updateTodaySlider();
    };
    el.addEventListener('mousedown',ev=>{dragging=true;ev.preventDefault();});
    document.addEventListener('mousemove',ev=>{if(dragging)handleMove(ev.clientX);});
    document.addEventListener('mouseup',()=>{dragging=false;});
    el.addEventListener('touchstart',ev=>{dragging=true;ev.preventDefault();},{passive:false});
    document.addEventListener('touchmove',ev=>{if(dragging)handleMove(ev.touches[0].clientX);},{passive:true});
    document.addEventListener('touchend',()=>{dragging=false;});
  });
}

function initDate(){
  const d=new Date();
  const J=['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const M=['janvier','fÃ©vrier','mars','avril','mai','juin','juillet','aoÃ»t','septembre','octobre','novembre','dÃ©cembre'];
  const el=document.getElementById('saisie-date');
  if(el)el.textContent=J[d.getDay()]+' '+d.getDate()+' '+M[d.getMonth()];
  buildHeroSemainier();
  updateDayBar();
  setInterval(updateDayBar,60000);
}

function updateDayBar(){
  const now=new Date();
  const startMin=8*60,endMin=18*60;
  const nowMin=now.getHours()*60+now.getMinutes();
  let pct=0;
  if(nowMin>=startMin&&nowMin<=endMin)pct=Math.round((nowMin-startMin)/(endMin-startMin)*100);
  else if(nowMin>endMin)pct=100;
  const bar=document.getElementById('hero-day-bar');
  if(bar)setTimeout(()=>{bar.style.width=pct+'%';},400);
  const label=document.getElementById('hero-now-label');
  if(label){const hh=now.getHours(),mm=String(now.getMinutes()).padStart(2,'0');label.textContent=hh+'h'+mm;}
}

// â”€â”€ Slider saisie du jour â”€â”€
function initTodaySlider(){
  const now=new Date();
  // Pour dÃ©mo, toujours dÃ©verrouillÃ© (en prod : now.getHours()>=18)
  const after18=true; // now.getHours()>=18
  const lockedEl=document.getElementById('today-locked');
  const sliderContent=document.getElementById('today-slider-content');
  if(after18){
    if(lockedEl)lockedEl.style.display='none';
    if(sliderContent)sliderContent.style.display='block';
    updateTodaySlider();
    initTodayDrag();
  }
}

function updateSlider(id){
  const objEl=document.getElementById(id+'-obj');
  const realEl=document.getElementById(id+'-real');
  const trackObj=document.getElementById(id+'-track-obj');
  const trackReal=document.getElementById(id+'-track-real');
  const objLabel=document.getElementById(id+'-obj-label');
  const realLabel=document.getElementById(id+'-real-label');
  if(!objEl||!realEl)return;
  const max=parseFloat(objEl.max);
  const objVal=parseFloat(objEl.value);
  const realVal=parseFloat(realEl.value);
  if(trackObj)trackObj.style.width=(objVal/max*100)+'%';
  if(trackReal)trackReal.style.width=(realVal/max*100)+'%';
  if(objLabel)objLabel.textContent='Objectif '+objVal+'h';
  if(realLabel)realLabel.textContent=realVal+'h portÃ©es';
  const vbtn=document.getElementById('valider-btn');
  if(vbtn&&realVal>0)vbtn.disabled=false;
}

function validerSaisie(){
  const h=todayState.end-todayState.start;
  document.getElementById('saisie-form').style.display='none';
  const cbox=document.getElementById('congrats-box');
  cbox.style.display='block';
  document.getElementById('saisie-card').style.borderColor=h>=OBJ?'var(--green)':'var(--orange)';
  if(h>=OBJ){
    document.getElementById('c-emoji').textContent=h>OBJ?'ğŸ†':'ğŸ‰';
    document.getElementById('c-title').textContent=h>OBJ?'ğŸ† '+h+'h, incroyable Jules !':'ğŸ‰ Bravo Jules !';
    document.getElementById('c-sub').textContent="C'est excellent ! Continue comme Ã§a ğŸ’ª";
    document.getElementById('mascot').textContent=h>OBJ?'ğŸ‘‘':'ğŸ†';
    lancerConfetti();
  }else if(h===0){
    document.getElementById('c-emoji').textContent='ğŸ˜”';
    document.getElementById('c-title').textContent="Pas de cache aujourd'hui...";
    document.getElementById('c-sub').textContent="N'oublie pas demain ! ğŸ’™";
  }else{
    document.getElementById('c-emoji').textContent='ğŸ‘';
    document.getElementById('c-title').textContent='ğŸ‘ '+h+'h enregistrÃ©es !';
    document.getElementById('c-sub').textContent="Bonne journÃ©e, on continue demain !";
    document.getElementById('mascot').textContent='ğŸ’ª';
  }
}

// â”€â”€ Pending (jours Ã  complÃ©ter) â”€â”€
const PENDING=[
  {d:23,label:"Aujourd'hui",month:'FÃ©v',isToday:true, eye:'OD',defaultStart:8,defaultEnd:18},
  {d:19,label:'Jeu 19 fÃ©v', month:'FÃ©v',isToday:false,eye:'OD',defaultStart:8,defaultEnd:18},
  {d:21,label:'Sam 21 fÃ©v', month:'FÃ©v',isToday:false,eye:'OG',defaultStart:8,defaultEnd:18},
];
let pendingDone=0;
const piState=PENDING.map(d=>({start:d.defaultStart,end:d.defaultEnd,validated:false}));
function hToPos(h){return((h-6)/16)*100;}
function posToH(pct){return Math.round(pct/100*16+6);}
function fmtH(h){return h+'h00';}

function buildPending(){
  const list=document.getElementById('pending-list');if(!list)return;
  const now=new Date();const after18=now.getHours()>=18;
  PENDING.forEach((day,i)=>{
    const isLocked=day.isToday&&!after18;
    const eyeColor='#4A90D9';const eyeBg='#EAF4FF';
    const el=document.createElement('div');
    el.id='pi-'+i;
    el.className='pending-item';
    el.style.background=eyeBg;
    const hdr=document.createElement('div');
    hdr.style.cssText='display:flex;align-items:center;gap:10px;margin-bottom:'+(isLocked?'0':'10px')+';';
    hdr.innerHTML=
      '<div style="width:42px;height:46px;border-radius:11px;background:'+eyeColor+';display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;">'+
        '<span style="font-family:Nunito,sans-serif;font-weight:900;font-size:'+(day.isToday?'1.1':'1')+'rem;color:white;line-height:1;">'+(day.isToday?'ğŸ“…':day.d)+'</span>'+
        (day.isToday?'':'<span style="font-size:.54rem;font-weight:700;color:rgba(255,255,255,.85);text-transform:uppercase;">'+day.month+'</span>')+
      '</div>'+
      '<div style="flex:1;">'+
        '<div style="font-family:Nunito,sans-serif;font-weight:900;font-size:.88rem;color:'+eyeColor+';">'+day.label+'</div>'+
        '<div style="font-size:.7rem;color:#64748B;margin-top:1px;">Cache '+day.eye+' Â· 8hâ†’18h</div>'+
        (isLocked?'<div style="font-size:.66rem;color:#F39C12;font-weight:700;margin-top:2px;">ğŸ”’ Disponible aprÃ¨s 18h</div>':'')+
      '</div>';
    el.appendChild(hdr);
    if(!isLocked){
      const durDiv=document.createElement('div');
      durDiv.id='pi-dur-'+i;
      durDiv.style.cssText='text-align:center;margin-bottom:8px;';
      durDiv.innerHTML='<span style="font-family:Nunito,sans-serif;font-size:1.3rem;font-weight:900;color:'+eyeColor+';">'+(piState[i].end-piState[i].start)+'h portÃ©es</span>'+
        '<span style="font-size:.72rem;color:#64748B;margin-left:7px;">'+fmtH(piState[i].start)+' â†’ '+fmtH(piState[i].end)+'</span>';
      el.appendChild(durDiv);
      const trackWrap=document.createElement('div');
      trackWrap.style.cssText='position:relative;height:44px;margin:0 8px 6px;user-select:none;';
      trackWrap.innerHTML=`
        <div style="position:absolute;top:50%;left:0;right:0;height:10px;border-radius:5px;background:#CBD5E1;transform:translateY(-50%);"></div>
        <div id="pi-fill-${i}" style="position:absolute;top:50%;height:10px;border-radius:5px;background:${eyeColor};transform:translateY(-50%);pointer-events:none;"></div>
        <div style="position:absolute;top:8px;height:26px;width:2.5px;border-radius:2px;background:#27AE60;left:${hToPos(8)}%;transform:translateX(-50%);pointer-events:none;"><span style="position:absolute;top:28px;left:50%;transform:translateX(-50%);font-size:.48rem;font-weight:800;color:#27AE60;white-space:nowrap;">8h</span></div>
        <div style="position:absolute;top:8px;height:26px;width:2.5px;border-radius:2px;background:#27AE60;left:${hToPos(18)}%;transform:translateX(-50%);pointer-events:none;"><span style="position:absolute;top:28px;left:50%;transform:translateX(-50%);font-size:.48rem;font-weight:800;color:#27AE60;white-space:nowrap;">18h</span></div>
        <div id="pi-hs-${i}" data-pi="${i}" data-side="start" style="position:absolute;top:50%;width:26px;height:26px;border-radius:50%;background:white;border:3px solid ${eyeColor};box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;"><span style="font-size:.5rem;font-weight:900;color:${eyeColor};">â–¶</span></div>
        <div id="pi-he-${i}" data-pi="${i}" data-side="end" style="position:absolute;top:50%;width:26px;height:26px;border-radius:50%;background:white;border:3px solid ${eyeColor};box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;"><span style="font-size:.5rem;font-weight:900;color:${eyeColor};">â—€</span></div>
        <div style="position:absolute;top:-14px;left:0;font-size:.52rem;color:#94A3B8;font-weight:700;">6h</div>
        <div style="position:absolute;top:-14px;right:0;font-size:.52rem;color:#94A3B8;font-weight:700;">22h</div>`;
      el.appendChild(trackWrap);
      const valBtn=document.createElement('button');
      valBtn.id='pi-vbtn-'+i;
      valBtn.style.cssText='width:100%;padding:11px;border-radius:11px;border:none;background:'+eyeColor+';color:white;font-family:Nunito,sans-serif;font-weight:900;font-size:.88rem;cursor:pointer;margin-top:7px;';
      valBtn.textContent='âœ“ Valider ce jour';
      valBtn.onclick=()=>validatePiDay(i);
      el.appendChild(valBtn);
      const cbox=document.createElement('div');
      cbox.id='pi-cbox-'+i;cbox.style.display='none';el.appendChild(cbox);
    }
    list.appendChild(el);
    if(!isLocked){updatePiSlider(i);initPiDrag(i);}
  });
  // hide section if empty
  const sec=document.getElementById('pending-section');
  if(sec&&PENDING.length===0)sec.style.display='none';
}

function updatePiSlider(i){
  const s=piState[i].start,e=piState[i].end;
  const sp=hToPos(s),ep=hToPos(e);
  const hs=document.getElementById('pi-hs-'+i);
  const he=document.getElementById('pi-he-'+i);
  const fill=document.getElementById('pi-fill-'+i);
  const dur=document.getElementById('pi-dur-'+i);
  if(hs)hs.style.left=sp+'%';
  if(he)he.style.left=ep+'%';
  if(fill){fill.style.left=sp+'%';fill.style.width=(ep-sp)+'%';}
  if(dur){
    const hours=e-s;
    const covered=Math.max(0,Math.min(e,18)-Math.max(s,8));
    const pct=Math.round(covered/10*100);
    const col=hours>=10?'#27AE60':hours>=5?'#F39C12':'#E74C3C';
    dur.innerHTML='<span style="font-family:Nunito,sans-serif;font-size:1.3rem;font-weight:900;color:'+col+';">'+hours+'h portÃ©es</span>'+
      '<span style="font-size:.72rem;color:#64748B;margin-left:7px;">'+fmtH(s)+' â†’ '+fmtH(e)+'</span>'+
      '<div style="font-size:.68rem;color:'+col+';font-weight:700;margin-top:2px;">'+pct+'% de l\'objectif</div>';
  }
}

function initPiDrag(i){
  ['pi-hs-'+i,'pi-he-'+i].forEach(id=>{
    const el=document.getElementById(id);if(!el)return;
    const side=el.dataset.side;let dragging=false;
    const handleMove=clientX=>{
      const track=el.parentElement;
      const rect=track.getBoundingClientRect();
      let pct=Math.max(0,Math.min(100,(clientX-rect.left)/rect.width*100));
      let h=Math.max(6,Math.min(22,posToH(pct)));
      if(side==='start')piState[i].start=Math.min(h,piState[i].end-1);
      else piState[i].end=Math.max(h,piState[i].start+1);
      updatePiSlider(i);
    };
    el.addEventListener('mousedown',ev=>{dragging=true;ev.preventDefault();});
    document.addEventListener('mousemove',ev=>{if(dragging)handleMove(ev.clientX);});
    document.addEventListener('mouseup',()=>{dragging=false;});
    el.addEventListener('touchstart',ev=>{dragging=true;ev.preventDefault();},{passive:false});
    document.addEventListener('touchmove',ev=>{if(dragging)handleMove(ev.touches[0].clientX);},{passive:true});
    document.addEventListener('touchend',()=>{dragging=false;});
  });
}

function validatePiDay(i){
  const s=piState[i].start,e=piState[i].end;
  const hours=e-s;
  const cbox=document.getElementById('pi-cbox-'+i);
  const vbtn=document.getElementById('pi-vbtn-'+i);
  const durDiv=document.getElementById('pi-dur-'+i);
  if(vbtn)vbtn.style.display='none';
  if(durDiv)durDiv.style.display='none';
  const track=document.querySelector('#pi-hs-'+i)?.parentElement;
  if(track)track.style.display='none';
  let emoji,title,sub,doConfetti;
  if(hours>=10){emoji='ğŸ†';title='Objectif atteint !';sub='Bravo Jules, '+hours+'h portÃ©es ! ğŸ’ª';doConfetti=true;}
  else if(hours>=7){emoji='ğŸ‘';title='Bonne journÃ©e !';sub=hours+'h portÃ©es Â· presque l\'objectif ğŸ˜Š';doConfetti=false;}
  else if(hours>0){emoji='ğŸ’ª';title="C'est un dÃ©but !";sub=hours+'h portÃ©es Â· on peut faire mieux !';doConfetti=false;}
  else{emoji='ğŸ˜”';title='Pas de cache ce jourâ€¦';sub='Pas grave, on rattrape demain ! ğŸ’™';doConfetti=false;}
  if(cbox){
    cbox.style.display='block';
    cbox.innerHTML='<div style="font-size:2rem;margin-bottom:5px;">'+emoji+'</div>'+
      '<div style="font-family:Nunito,sans-serif;font-weight:900;font-size:.95rem;color:#4A90D9;">'+title+'</div>'+
      '<div style="font-size:.78rem;color:#64748B;margin-top:3px;margin-bottom:9px;">'+sub+'</div>'+
      '<button onclick="resolvePi('+i+')" style="padding:7px 18px;border-radius:9px;border:none;background:#4A90D9;color:white;font-family:Nunito,sans-serif;font-weight:800;font-size:.78rem;cursor:pointer;">OK âœ“</button>';
  }
  if(doConfetti)lancerConfetti();
  piState[i].validated=true;
}

function resolvePi(i){
  const el=document.getElementById('pi-'+i);
  if(el){el.style.opacity='0';el.style.transform='translateX(16px);';el.style.transition='all .35s';}
  pendingDone++;
  setTimeout(()=>{
    if(el)el.remove();
    if(pendingDone>=PENDING.length){
      const sec=document.getElementById('pending-section');
      if(sec)sec.style.display='none';
    }
  },380);
}

// â”€â”€ Calendrier â”€â”€
function buildDayEntry(year,month,d){
  const date=new Date(year,month,d);
  const today=new Date();today.setHours(0,0,0,0);date.setHours(0,0,0,0);
  const isToday=date.getTime()===today.getTime();
  const isFuture=date>today;
  const pastRdv=date>NEXT_RDV;
  if(isToday)return{d,s:'today',eye:eyeForDate(date),obs:'?'};
  if(isFuture||pastRdv)return{d,s:'future',eye:eyeForDate(date)};
  const eye=eyeForDate(date);
  const dateKey=year*10000+(month+1)*100+d;
  const partials=[20260204,20260207,20260214,20260218,20260221];
  const missed=[20260209];
  const unknown=[20260219,20260221,20260222];
  let obs;
  if(unknown.includes(dateKey))obs='?';
  else if(missed.includes(dateKey))obs='miss';
  else if(partials.includes(dateKey))obs='partial';
  else obs='ok';
  return{d,s:obs==='miss'?'miss':obs==='partial'?'partial':obs==='?'?'unknown':'ok',eye,obs};
}

function generateRichMonth(year,month){
  const firstDate=new Date(year,month,1);
  const dow=firstDate.getDay();
  const firstDow=dow===0?6:dow-1;
  const daysInMonth=new Date(year,month+1,0).getDate();
  const days=[];
  for(let i=0;i<firstDow;i++)days.push(null);
  for(let d=1;d<=daysInMonth;d++)days.push(buildDayEntry(year,month,d));
  const today=new Date();today.setHours(0,0,0,0);
  let total=0,ok=0;
  days.forEach(day=>{
    if(!day)return;
    const date=new Date(year,month,day.d);date.setHours(0,0,0,0);
    if(date>=today||day.s==='future')return;
    if(day.eye==='none')return;
    total++;
    if(day.obs==='ok')ok++;
    else if(day.obs==='partial')ok+=0.5;
  });
  return{days,score:total>0?Math.round(ok/total*100):null};
}

function getCalData(year,month){
  const key=year+'-'+String(month+1).padStart(2,'0');
  if(!CAL_CACHE[key])CAL_CACHE[key]=generateRichMonth(year,month);
  return CAL_CACHE[key];
}

function buildCalendar(){
  const data=getCalData(calYear,calMonth);
  const label=document.getElementById('cal-month-label');
  if(label)label.textContent=MONTHS_FR[calMonth]+' '+calYear;
  const scoreEl=document.getElementById('cal-score-val');
  if(scoreEl)scoreEl.textContent=data.score!=null?data.score+'%':'â€”';
  const grid=document.getElementById('cal-grid');if(!grid)return;
  grid.innerHTML='';
  data.days.forEach(day=>{
    const el=document.createElement('div');el.className='cday';
    if(!day){el.classList.add('empty');grid.appendChild(el);return;}
    const rdvKey=calYear+'-'+(calMonth+1)+'-'+day.d;
    const rdv=RDV_DAYS[rdvKey];
    if(day.s==='future'){
      el.classList.add('future');
      if(rdv){el.style.outline='2.5px solid #F39C12';el.style.outlineOffset='1px';el.style.borderRadius='9px';}
      const thisDate=new Date(calYear,calMonth,day.d);
      const isBeforeRdv=thisDate<=NEXT_RDV;
      const isPauseFut=day.eye==='none';
      if(isBeforeRdv){
        const bg=day.eye==='OD'?'#4A90D9':day.eye==='OG'?'#2EAFAF':'transparent';
        const col=isPauseFut?'#94A3B8':'white';
        const content=isPauseFut?'â˜•':(day.eye==='OD'?'OD':day.eye==='OG'?'OG':'');
        el.innerHTML=(rdv?'<span style="position:absolute;top:2px;left:3px;font-size:.6rem;">'+rdv.icon+'</span>':'')+
          '<span class="cday-num" style="color:#475569;font-weight:900;">'+day.d+'</span>'+
          (content?'<span class="cday-eye-badge" style="background:'+bg+';color:'+col+';font-size:'+(isPauseFut?'.7':'.42')+'rem;font-weight:900;padding:1px 3px;border-radius:3px;">'+content+'</span>':'');
      }else{
        const eyeLbl=day.eye==='OD'?'OD':day.eye==='OG'?'OG':'';
        const ebc=day.eye==='OD'?'eye-badge-od':day.eye==='OG'?'eye-badge-og':'eye-badge-pause';
        el.innerHTML=(rdv?'<span style="position:absolute;top:2px;left:3px;font-size:.6rem;">'+rdv.icon+'</span>':'')+
          '<span class="cday-num" style="color:#94A3B8;">'+day.d+'</span>'+
          (eyeLbl?'<span class="cday-eye-badge '+ebc+'" style="opacity:.4;">'+eyeLbl+'</span>':'');
      }
      grid.appendChild(el);return;
    }
    el.classList.add('cal-normal');
    if(day.s==='today'){el.classList.remove('cal-normal');el.classList.add('today');}
    if(rdv){el.style.outline='2.5px solid #F39C12';el.style.outlineOffset='1px';}
    const isPause=day.eye==='none';
    const eyeLabel=day.eye==='OD'?'OD':day.eye==='OG'?'OG':'â˜•';
    const eyeBadgeClass=day.eye==='OD'?'eye-badge-od':day.eye==='OG'?'eye-badge-og':'eye-badge-pause';
    const dotClass=isPause?'dot-none':day.obs==='ok'?'dot-ok':day.obs==='partial'?'dot-partial':day.obs==='miss'?'dot-miss':day.obs==='?'?'dot-unknown':'dot-none';
    const dotContent=(!isPause&&day.obs==='?')?'?':'';
    el.innerHTML='<div class="cday-obs-dot '+dotClass+'">'+dotContent+'</div>'+
      (rdv?'<span style="position:absolute;top:2px;left:3px;font-size:.6rem;line-height:1;">'+rdv.icon+'</span>':'')+
      '<span class="cday-num">'+day.d+'</span>'+
      '<span class="cday-eye-badge '+eyeBadgeClass+'">'+eyeLabel+'</span>';
    el.addEventListener('mouseenter',()=>el.style.transform='scale(1.08)');
    el.addEventListener('mouseleave',()=>el.style.transform='');
    grid.appendChild(el);
  });
}
function calPrev(){calMonth--;if(calMonth<0){calMonth=11;calYear--;}buildCalendar();}
function calNext(){calMonth++;if(calMonth>11){calMonth=0;calYear++;}buildCalendar();}

// â”€â”€ Badges â”€â”€
function loadRewards(){try{return JSON.parse(localStorage.getItem('amblyup_rewards')||'{}');}catch(e){return{};}}
function saveReward(idx,text){const r=loadRewards();r[idx]=text;try{localStorage.setItem('amblyup_rewards',JSON.stringify(r));}catch(e){}}

function buildBadgesTimeline(){
  const wrap=document.getElementById('badges-timeline');if(!wrap)return;
  const rewards=loadRewards();
  const currentIdx=BADGES.filter(b=>b.unlocked).length-1;
  BADGES.forEach((b,i)=>{
    const div=document.createElement('div');
    div.className='btl-item '+(b.unlocked?'done':i===currentIdx+1?'next':'locked');
    div.innerHTML='<div class="btl-icon">'+b.icon+'</div><div class="btl-name">'+b.name+'</div>';
    wrap.appendChild(div);
  });
}

function buildBadgesSection(){
  const wrap=document.getElementById('badges-section');if(!wrap)return;
  const currentIdx=BADGES.filter(b=>b.unlocked).length-1;
  const nextBadge=BADGES.find(b=>!b.unlocked);
  const starsToNext=nextBadge?nextBadge.stars-TOTAL_STARS:0;
  const rewards=loadRewards();
  let html='<div style="text-align:center;padding:6px 0 4px;">'+
    '<div style="font-size:2.6rem;font-weight:900;font-family:Nunito,sans-serif;color:#F39C12;line-height:1;">'+TOTAL_STARS+' â­</div>'+
    '<div style="font-size:.78rem;color:var(--text-m);font-weight:600;margin-top:3px;">Ã©toiles gagnÃ©es</div>';
  if(nextBadge)html+='<div style="font-size:.75rem;color:var(--blue);font-weight:700;margin-top:9px;background:var(--blue-l);border-radius:9px;padding:7px 11px;">â­ Encore <strong>'+starsToNext+'</strong> Ã©toile'+(starsToNext>1?'s':'')+' avant <strong>'+nextBadge.name+' '+nextBadge.icon+'</strong></div>';
  html+='</div><div style="border-top:1px solid var(--border);margin:12px 0 9px;"></div>';
  BADGES.forEach((b,i)=>{
    const reward=rewards[i]||'';
    if(b.unlocked){
      html+='<div class="badge-row-card">'+
        '<div class="badge-row-icon">'+b.icon+'</div>'+
        '<div class="badge-row-info"><div class="badge-row-name">'+b.name+'</div><div class="badge-row-desc">'+b.desc+' Â· âœ“ Obtenu</div>'+(reward?'<div class="reward-tag">ğŸ '+reward+'</div>':'')+'</div>'+
        '<div class="badge-row-check">âœ“</div></div>';
    }else if(i<=currentIdx+5){
      html+='<div class="badge-row-card locked">'+
        '<div class="badge-row-icon">'+b.icon+'</div>'+
        '<div class="badge-row-info"><div class="badge-row-name">'+b.name+'</div><div class="badge-row-desc">'+b.desc+' Â· ğŸ”’ Ã€ dÃ©bloquer</div>'+(reward?'<div class="reward-tag" style="color:var(--orange);">ğŸ PrÃ©vu : '+reward+'</div>':'')+'</div>'+
        '<div class="badge-row-lock">ğŸ”’</div></div>';
    }
  });
  wrap.innerHTML=html;
}

function buildRewardsForm(){
  const wrap=document.getElementById('rewards-form');if(!wrap)return;
  const rewards=loadRewards();
  const currentIdx=BADGES.filter(b=>b.unlocked).length-1;
  let html='';
  for(let i=currentIdx;i<Math.min(currentIdx+7,BADGES.length);i++){
    const b=BADGES[i];if(!b)continue;
    const val=rewards[i]||'';
    const isNext=i===currentIdx+1;
    html+='<div style="margin-bottom:10px;">'+
      '<label style="display:flex;align-items:center;gap:7px;font-family:Nunito,sans-serif;font-weight:800;font-size:.8rem;color:var(--text);margin-bottom:4px;">'+
        '<span style="font-size:1.1rem;">'+b.icon+'</span><span>'+b.name+'</span>'+
        (isNext?'<span style="font-size:.62rem;background:var(--blue);color:white;border-radius:5px;padding:1px 6px;font-weight:700;">Prochain</span>':'')+
        '<span style="font-size:.62rem;color:var(--text-m);font-weight:600;">'+b.desc+'</span>'+
      '</label>'+
      '<input type="text" placeholder="Ex: sortie cinÃ©, jouet surpriseâ€¦ (facultatif)" value="'+val+'" data-idx="'+i+'" '+
        'oninput="saveReward(this.dataset.idx,this.value);buildBadgesSection();" '+
        'style="width:100%;box-sizing:border-box;padding:9px 11px;border-radius:9px;border:1.5px solid var(--border);font-family:Nunito,sans-serif;font-size:.78rem;font-weight:600;color:var(--text);background:var(--bg);outline:none;" '+
        'onfocus="this.style.borderColor=\'var(--blue)\'" onblur="this.style.borderColor=\'var(--border)\'">'+
    '</div>';
  }
  wrap.innerHTML=html;
}

// â”€â”€ Docs & Kits â”€â”€
function toggleDoc(el){
  const isOpen=el.classList.contains('open');
  document.querySelectorAll('.doc-item.open').forEach(d=>d.classList.remove('open'));
  if(!isOpen)el.classList.add('open');
}
function toggleKit(el){el.classList.toggle('open');}

// â”€â”€ Deep link â”€â”€
function openPendingSection(){
  goPage('page-agenda');
  setTimeout(()=>{const el=document.getElementById('pending-section');if(el)el.scrollIntoView({behavior:'smooth',block:'start'});},200);
}
function checkDeepLink(){
  if(window.location.search.includes('open=pending')||window.location.hash==='#pending')
    setTimeout(()=>openPendingSection(),600);
}
navigator.serviceWorker&&navigator.serviceWorker.addEventListener('message',event=>{
  if(event.data&&event.data.action==='OPEN_PENDING')openPendingSection();
});

// â”€â”€ Notifications â”€â”€
async function demanderPermission(){
  if(!('Notification' in window)){showToast('âš ï¸ Non supportÃ©','orange');return false;}
  const result=await Notification.requestPermission();
  const b1=document.getElementById('perm-banner');
  const b2=document.getElementById('perm-banner-2');
  if(result==='granted'){
    if(b1)b1.style.display='none';if(b2)b2.style.display='none';
    showToast('ğŸ”” Notifications activÃ©es !','blue');
    if(swReg&&swReg.active)swReg.active.postMessage('SCHEDULE_NOTIFS');
    return true;
  }else{showToast('âš ï¸ Permission refusÃ©e','orange');return false;}
}

function envoyerNotifDelai(type,btn){
  let secs=5;
  const originalHTML=btn.querySelector('span:last-child').innerHTML;
  btn.disabled=true;btn.style.opacity='.7';
  btn.querySelector('span:last-child').innerHTML='Envoi dans <strong>'+secs+'s</strong>â€¦';
  const iv=setInterval(()=>{
    secs--;
    if(secs>0)btn.querySelector('span:last-child').innerHTML='Envoi dans <strong>'+secs+'s</strong>â€¦';
    else{
      clearInterval(iv);
      btn.querySelector('span:last-child').innerHTML=originalHTML;
      btn.disabled=false;btn.style.opacity='1';
      envoyerNotifTest(type);
    }
  },1000);
}

async function envoyerNotifTest(type){
  const statusEl=document.getElementById('notif-status');
  if(!('Notification' in window)){showToast('âš ï¸ Non supportÃ©','orange');return;}
  if(Notification.permission!=='granted'){const ok=await demanderPermission();if(!ok)return;}
  try{
    if(swReg&&swReg.active)swReg.active.postMessage(type==='cache'?'TEST_MATIN':'TEST_SOIR');
    else{
      const msg=type==='cache'?{title:'ğŸ´â€â˜ ï¸ Cache-Å“il de Jules ! [TEST]',body:'Mets le cache maintenant !'}:{title:'ğŸ‰ Bravo Jules ! [TEST]',body:"Retire le cache et remplis ton rythme !"};
      new Notification(msg.title,{body:msg.body,icon:'amblyup-logo.png'});
    }
    if(statusEl){statusEl.innerHTML='âœ… Notification envoyÃ©e !';statusEl.style.background='var(--green-l)';statusEl.style.color='var(--green-d)';}
  }catch(e){if(statusEl)statusEl.innerHTML='âŒ '+e.message;}
  setTimeout(()=>{if(statusEl){statusEl.innerHTML='ğŸ’¤ En attente';statusEl.style.background='';statusEl.style.color='';}},4000);
}

// â”€â”€ Confetti â”€â”€
function lancerConfetti(){
  const wrap=document.getElementById('confetti');
  wrap.classList.add('show');wrap.innerHTML='';
  const colors=['#4A90D9','#5BBF8E','#F9A825','#E74C3C','#C8E4FA','#2E6DB4'];
  for(let i=0;i<70;i++){
    const el=document.createElement('div');el.className='confetti';
    el.style.cssText='left:'+Math.random()*100+'%;top:'+(-(Math.random()*30))+'px;background:'+colors[~~(Math.random()*colors.length)]+';width:'+(6+Math.random()*8)+'px;height:'+(6+Math.random()*8)+'px;border-radius:'+(Math.random()>.5?'50%':'2px')+';--dur:'+(1+Math.random()*1.2)+'s;--delay:'+(Math.random()*.8)+'s';
    wrap.appendChild(el);
  }
  setTimeout(()=>{wrap.classList.remove('show');wrap.innerHTML='';},3000);
}

function toggleRdvActions(idx){
  const panel=document.getElementById('rdv-actions-'+idx);
  if(!panel)return;
  const isOpen=panel.style.display!=='none';
  // Ferme tous
  document.querySelectorAll('.rdv-actions').forEach(p=>p.style.display='none');
  document.querySelectorAll('.rdv-toggle-btn').forEach(b=>b.style.background='');
  if(!isOpen){
    panel.style.display='flex';
    const btn=panel.closest('.rdv-item-card')?.querySelector('.rdv-toggle-btn');
    if(btn)btn.style.background='var(--blue-l)';
  }
}

function supprimerRdv(idx){
  const card=document.getElementById('rdv-card-'+idx);
  if(!card)return;
  if(!confirm('Supprimer ce rendez-vous ?'))return;
  card.style.transition='all .35s';
  card.style.opacity='0';
  card.style.transform='translateX(20px)';
  setTimeout(()=>card.remove(),360);
  showToast('Rendez-vous supprimÃ©','orange');
}

// â”€â”€ Comptes rendus â”€â”€
const CR_DATA = {
  ophtalmo: [
    {id:'cr_o1', titre:'Bilan ophtalmologique', date:'2026-01-15', hasPhoto:false},
    {id:'cr_o2', titre:'ContrÃ´le 6 mois',       date:'2025-07-10', hasPhoto:false},
  ],
  ortho: [
    {id:'cr_r1', titre:'Bilan orthoptique initial', date:'2026-01-15', hasPhoto:false},
    {id:'cr_r2', titre:'Suivi mensuel â€” dÃ©cembre',  date:'2025-12-10', hasPhoto:false},
    {id:'cr_r3', titre:'Suivi mensuel â€” novembre',  date:'2025-11-08', hasPhoto:false},
  ]
};
let crModalTarget = null;
let crPhotoData = null;

function fmtDateFR(iso){
  if(!iso)return'';
  const [y,m,d]=iso.split('-');
  const M=['jan.','fÃ©v.','mars','avr.','mai','juin','juil.','aoÃ»t','sept.','oct.','nov.','dÃ©c.'];
  return d+' '+M[parseInt(m)-1]+' '+y;
}

function buildCRList(type){
  const list=document.getElementById('cr-'+type+'-list');
  const count=document.getElementById('cr-'+type+'-count');
  if(!list)return;
  const items=CR_DATA[type];
  list.innerHTML='';
  items.forEach(item=>{
    const div=document.createElement('div');
    div.className='cr-entry';
    const thumb = (item.hasPhoto && item.photoSrc)
      ? `<img class="cr-entry-thumb" src="${item.photoSrc}" alt="">`
      : `<div class="cr-entry-thumb-placeholder">ğŸ“‹</div>`;
    div.innerHTML = `${thumb}
      <div class="cr-entry-info">
        <div class="cr-entry-title">${item.titre}</div>
        <div class="cr-entry-date">ğŸ“… ${fmtDateFR(item.date)}</div>
      </div>
      <button class="cr-entry-del" title="Supprimer">ğŸ—‘</button>`;
    div.querySelector('.cr-entry-del').addEventListener('click', e=>{
      e.stopPropagation();
      supprimerCR(type, item.id);
    });
    list.appendChild(div);
  });
  if(count)count.textContent=items.length+' compte'+(items.length>1?'s':'')+' rendu'+(items.length>1?'s':'');
}

function supprimerCR(type, id){
  if(!confirm('Supprimer ce compte rendu ?'))return;
  CR_DATA[type]=CR_DATA[type].filter(i=>i.id!==id);
  buildCRList(type);
}

function ouvrirAjoutCR(type){
  crModalTarget=type;
  crPhotoData=null;
  // Reset modal
  document.getElementById('cr-preview-img').style.display='none';
  document.getElementById('cr-preview-placeholder').style.display='flex';
  document.getElementById('cr-preview-placeholder').style.flexDirection='column';
  document.getElementById('cr-preview-placeholder').style.alignItems='center';
  document.getElementById('cr-titre').value='';
  const today=new Date();
  const pad=n=>String(n).padStart(2,'0');
  document.getElementById('cr-date').value=today.getFullYear()+'-'+pad(today.getMonth()+1)+'-'+pad(today.getDate());
  const saveBtn=document.getElementById('cr-save-btn');
  if(saveBtn)saveBtn.disabled=true,saveBtn.style.opacity='.5';
  const modal=document.getElementById('cr-modal');
  const title=document.getElementById('cr-modal-title');
  if(title)title.textContent='Ajouter â€” '+(type==='ophtalmo'?'Dr. Benali':'Mme Lecomte');
  if(modal){modal.style.display='flex';}
}

function fermerModalCR(){
  const modal=document.getElementById('cr-modal');
  if(modal)modal.style.display='none';
  crModalTarget=null;crPhotoData=null;
  document.getElementById('cr-file-input').value='';
}

function previewCR(input){
  const file=input.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>{
    crPhotoData=e.target.result;
    const img=document.getElementById('cr-preview-img');
    const ph=document.getElementById('cr-preview-placeholder');
    img.src=crPhotoData;
    img.style.display='block';
    if(ph)ph.style.display='none';
    const saveBtn=document.getElementById('cr-save-btn');
    if(saveBtn)saveBtn.disabled=false,saveBtn.style.opacity='1';
  };
  reader.readAsDataURL(file);
}

function sauvegarderCR(){
  if(!crModalTarget||!crPhotoData)return;
  const titre=document.getElementById('cr-titre').value.trim()||
    (crModalTarget==='ophtalmo'?'Compte rendu ophtalmo':'Compte rendu orthoptiste');
  const date=document.getElementById('cr-date').value;
  const newId='cr_'+Date.now();
  CR_DATA[crModalTarget].unshift({id:newId,titre,date,hasPhoto:true,photoSrc:crPhotoData});
  buildCRList(crModalTarget);
  fermerModalCR();
  showToast('Compte rendu ajoutÃ© âœ…','green');
}

// Fermer modal en cliquant le fond
document.addEventListener('click',e=>{
  const modal=document.getElementById('cr-modal');
  if(modal&&e.target===modal)fermerModalCR();
});

function signalerPbRythme(){
  const form=document.getElementById('signalement-form');
  if(form)form.style.display=form.style.display==='none'?'block':'none';
}
function annulerSignalement(){
  const form=document.getElementById('signalement-form');
  if(form)form.style.display='none';
  const msg=document.getElementById('signalement-msg');
  if(msg)msg.value='';
}
function envoyerSignalement(){
  const msg=document.getElementById('signalement-msg');
  const txt=msg?msg.value.trim():'';
  annulerSignalement();
  // En production : POST vers API / email orthoptiste
  showToast('âœ… Signalement envoyÃ© Ã  Mme Lecomte','green');
}

function showToast(msg,color){
  const t=document.createElement('div');
  t.style.cssText='position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:var(--'+color+');color:white;padding:9px 16px;border-radius:11px;font-size:.8rem;font-weight:700;z-index:9999;box-shadow:0 5px 18px rgba(0,0,0,.14);font-family:Nunito,sans-serif;white-space:nowrap;animation:fadeUp .3s ease;';
  t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2500);
}

function activateVtab(el){
  document.querySelectorAll('.vtab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}
</script>
</body>
</html>
