<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4A90D9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Amblyup">
<link rel="manifest" href="manifest.json">
<title>Amblyup ‚Äî Jules</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --blue:#4A90D9; --blue-l:#EAF4FF; --blue-mid:#C8E4FA; --blue-d:#2E6DB4;
  --green:#5BBF8E; --green-l:#E8F7F1; --green-d:#3A8F68;
  --orange:#F9A825; --orange-l:#FFF8E1; --orange-d:#E65100;
  --red:#E74C3C; --red-l:#FDEDEC;
  --teal:#3ABFBF; --teal-l:#E0F5F5;
  --text:#2C3E50; --text-m:#7F8C8D; --text-l:#BDC3C7;
  --white:#FFFFFF; --bg:#F4F9FF; --border:#C8E4FA;
  --shadow:0 4px 20px rgba(74,144,217,.12);
  --shadow-lg:0 8px 30px rgba(74,144,217,.20);
  --r:20px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{scroll-behavior:smooth;}
body{font-family:'Quicksand',sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;overflow-x:hidden;padding-bottom:80px;}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{display:none;}
.page.active{display:block;animation:fadeUp .35s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
@keyframes popIn{0%{transform:scale(0)}80%{transform:scale(1.2)}100%{transform:scale(1)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:-200px 0}100%{background-position:200px 0}}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.app-header{padding:18px 16px 0;display:flex;align-items:center;justify-content:space-between;}
.header-logo{height:52px;object-fit:contain;}
.header-right{display:flex;align-items:center;gap:8px;}
.notif-btn{width:38px;height:38px;border-radius:12px;background:var(--white);border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1.05rem;cursor:pointer;position:relative;box-shadow:var(--shadow);}
.notif-dot{position:absolute;top:6px;right:6px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid var(--white);}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--white);border-radius:var(--r);padding:18px;margin:10px 16px 0;box-shadow:var(--shadow);}
.card-title{font-family:'Nunito',sans-serif;font-size:.72rem;font-weight:800;text-transform:uppercase;letter-spacing:.12em;color:var(--text-m);margin-bottom:12px;}
.section-title{font-family:'Nunito',sans-serif;font-size:.72rem;font-weight:800;text-transform:uppercase;letter-spacing:.12em;color:var(--text-m);padding:14px 16px 6px;}
/* ‚îÄ‚îÄ TITRE DE PAGE ‚îÄ‚îÄ */
.page-title{display:flex;align-items:center;gap:10px;padding:10px 16px 4px;margin-bottom:2px;}
.page-title-icon{width:38px;height:38px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.page-title-text{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.25rem;color:var(--text);line-height:1;}
.page-title-sub{font-size:.7rem;color:var(--text-m);font-weight:600;margin-top:1px;}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero{margin:12px 16px 0;background:var(--blue);border-radius:var(--r);padding:22px 20px 20px;color:white;position:relative;overflow:hidden;box-shadow:0 8px 28px rgba(74,144,217,.35);}
.hero::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;background:rgba(255,255,255,.12);border-radius:50%;}
.hero::after{content:'';position:absolute;bottom:-20px;left:20px;width:80px;height:80px;background:rgba(255,255,255,.08);border-radius:50%;}
.hero-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px;position:relative;z-index:1;}
.hero-greeting{font-size:.7rem;font-weight:700;opacity:.85;text-transform:uppercase;letter-spacing:.5px;}
.hero-name{font-family:'Nunito',sans-serif;font-size:1.45rem;font-weight:900;margin-top:2px;}
.hero-msg{font-size:.88rem;font-weight:600;line-height:1.55;opacity:.95;position:relative;z-index:1;margin-bottom:16px;background:rgba(255,255,255,.15);border-radius:14px;padding:12px 14px;}
.hero-msg strong{font-weight:900;opacity:1;}
.hero-mascot{font-size:2.8rem;animation:bounce 2.5s ease-in-out infinite;filter:drop-shadow(0 4px 8px rgba(0,0,0,.2));flex-shrink:0;}
/* Barre progression journ√©e */
.hero-day-progress{position:relative;z-index:1;margin-bottom:14px;}
.hero-day-label{display:flex;justify-content:space-between;font-size:.68rem;font-weight:700;opacity:.85;margin-bottom:5px;}
.hero-day-bar-bg{height:10px;background:rgba(255,255,255,.25);border-radius:20px;overflow:hidden;position:relative;}
.hero-day-bar{height:100%;background:linear-gradient(90deg,rgba(255,255,255,.9),rgba(255,255,255,.6));border-radius:20px;transition:width 1s ease;}
.hero-day-marker{position:absolute;top:-3px;width:16px;height:16px;background:white;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.2);margin-left:-8px;transition:left 1s ease;}
/* Stats */
.hero-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;position:relative;z-index:1;}
.hstat{background:rgba(255,255,255,.2);border-radius:14px;padding:10px 6px;text-align:center;}
.hstat-val{font-family:'Nunito',sans-serif;font-size:1.1rem;font-weight:900;line-height:1;}
.hstat-label{font-size:.58rem;font-weight:600;opacity:.85;margin-top:3px;}

/* ‚îÄ‚îÄ RAPPEL DU JOUR ‚îÄ‚îÄ */
.rappel-jour{margin:12px 16px 0;background:linear-gradient(135deg,var(--blue-l),#dceffe);border:2px solid var(--blue);border-radius:var(--r);padding:16px;box-shadow:var(--shadow);}
.rappel-jour-title{font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;color:var(--blue-d);margin-bottom:6px;display:flex;align-items:center;gap:8px;}
.rappel-jour-text{font-size:.85rem;color:var(--text);line-height:1.55;font-weight:600;}
.rappel-jour-sub{font-size:.75rem;color:var(--text-m);margin-top:8px;}

/* ‚îÄ‚îÄ PATCH POS√â ‚îÄ‚îÄ */
.patch-card{margin:10px 16px 0;}
.patch-question{font-family:'Nunito',sans-serif;font-weight:800;font-size:.95rem;color:var(--text);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.patch-jours{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.patch-jour-item{display:flex;align-items:center;justify-content:space-between;background:var(--orange-l);border:1.5px solid var(--orange);border-radius:14px;padding:10px 14px;}
.patch-jour-label{font-family:'Nunito',sans-serif;font-weight:700;font-size:.85rem;color:var(--orange-d);}
.patch-fait-btn{background:var(--green);color:white;border:none;border-radius:10px;padding:7px 14px;font-family:'Nunito',sans-serif;font-weight:800;font-size:.78rem;cursor:pointer;transition:all .15s;}
.patch-fait-btn:active{transform:scale(.95);}

/* ‚îÄ‚îÄ HOURS GRID ‚îÄ‚îÄ */
.obj-row{display:flex;align-items:center;justify-content:space-between;font-size:.78rem;color:var(--text-m);margin-bottom:10px;}
.obj-badge{background:var(--orange-l);color:var(--orange-d);border-radius:20px;padding:4px 10px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.72rem;}
.hours-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px;}
.hbtn{aspect-ratio:1;border-radius:12px;border:2px solid transparent;background:var(--blue-l);font-family:'Nunito',sans-serif;font-weight:800;font-size:1.2rem;color:var(--blue);cursor:pointer;transition:all .15s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;}
.hbtn .hbtn-sub{font-size:.56rem;font-weight:600;opacity:.8;font-family:'Quicksand',sans-serif;}
.hbtn:hover,.hbtn.sel{background:var(--blue);color:white;border-color:var(--blue);transform:scale(1.05);}
.hbtn.zero:hover,.hbtn.zero.sel{background:var(--red);color:white;border-color:var(--red);}
.hbtn.target{background:var(--orange-l);color:var(--orange-d);border-color:var(--orange);}
.hbtn.target:hover,.hbtn.target.sel{background:var(--orange);color:white;border-color:var(--orange);transform:scale(1.05);}
.hbtn.over{background:var(--green-l);color:var(--green-d);border-color:var(--green);}
.hbtn.over:hover,.hbtn.over.sel{background:var(--green);color:white;border-color:var(--green);transform:scale(1.05);}
.valider-btn{width:100%;padding:15px;border-radius:14px;border:none;background:var(--blue);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:1rem;cursor:pointer;transition:all .15s;box-shadow:0 4px 16px rgba(74,144,217,.35);display:flex;align-items:center;justify-content:center;gap:8px;}
.valider-btn:disabled{background:var(--border);color:var(--text-l);box-shadow:none;cursor:not-allowed;}
.valider-btn:not(:disabled):active{transform:scale(.97);}
.congrats-box{background:linear-gradient(135deg,var(--green-l),#d4f0e5);border-radius:var(--r);padding:20px;text-align:center;margin-top:12px;display:none;}
.congrats-box .c-emoji{font-size:2.5rem;display:block;margin-bottom:8px;animation:popIn .4s cubic-bezier(.34,1.56,.64,1);}
.congrats-box h3{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.2rem;color:var(--green);margin-bottom:4px;}
.congrats-box p{color:var(--text-m);font-size:.85rem;}

/* ‚îÄ‚îÄ CALENDRIER ‚îÄ‚îÄ */
.cal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.cal-nav{display:flex;align-items:center;gap:8px;}
.cal-nav-btn{width:30px;height:30px;border-radius:9px;background:var(--blue-l);border:1.5px solid var(--blue-mid);color:var(--blue);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;font-weight:800;}
.cal-nav-btn:active{background:var(--blue);color:white;transform:scale(.93);}
.cal-month-label{font-family:'Nunito',sans-serif;font-weight:900;font-size:.95rem;color:var(--text);min-width:100px;text-align:center;}
.cal-score-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.35rem;color:var(--blue);line-height:1;text-align:right;}
.cal-score-label{font-size:.62rem;color:var(--text-m);}
.cal-day-labels{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:3px;}
.cdl{text-align:center;font-family:'Nunito',sans-serif;font-size:.6rem;font-weight:700;color:var(--text-l);text-transform:uppercase;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cday{aspect-ratio:1;border-radius:9px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:'Nunito',sans-serif;font-size:.62rem;font-weight:700;transition:transform .15s;position:relative;cursor:default;}
/* Toutes les cases = bleu clair uniforme */
.cday.empty{background:none;}
.cday.future{background:#F0F7FF;color:var(--text-l);}
.cday.cal-normal, .cday.today { background:#C8E4FA; color:#1A3A5C; }
.cday.today { background:#4A90D9; color:white; box-shadow:0 2px 8px rgba(74,144,217,.4); }
.cday.cal-normal:hover,.cday.today:hover{ transform:scale(1.08); }
/* Badge int√©rieur : couleur de l'≈ìil */
.cday-eye-badge{
  font-size:.42rem; font-weight:900; line-height:1.4;
  padding:1px 3px; border-radius:3px; margin-top:2px;
}
.eye-badge-od  { background:#4A90D9; color:white; }  /* bleu */
.eye-badge-og  { background:#2EAFAF; color:white; }  /* teal doux */
.eye-badge-none{ background:#94A3B8; color:white; }  /* gris */
.eye-badge-pause{ background:transparent; color:#94A3B8; font-size:.7rem !important; line-height:1; } /* tasse caf√© */
/* Point observance ‚Äî coin haut droit */
.cday-obs-dot {
  position:absolute; top:3px; right:3px;
  width:7px; height:7px; border-radius:50%;
  border:1.5px solid rgba(255,255,255,.7);
  display:flex;align-items:center;justify-content:center;
  font-size:.32rem;font-weight:900;
}
.dot-ok      { background:#27AE60; }
.dot-partial { background:#F39C12; }
.dot-miss    { background:#E74C3C; }
.dot-unknown { background:rgba(100,116,139,.35); border-color:rgba(100,116,139,.6); color:#64748B; }
.dot-none    { display:none; }
.cday-num{font-size:.6rem;line-height:1;font-weight:800;}
/* L√©gende */
.cal-legend-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 12px;margin-top:12px;}
.cal-leg{display:flex;align-items:center;gap:6px;font-size:.7rem;color:var(--text-m);font-weight:600;}
.cal-leg-dot{width:22px;height:22px;border-radius:7px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.55rem;font-weight:800;color:white;}
.cal-leg-dot.ok{background:var(--green);}
.cal-leg-dot.partial{background:var(--orange);}
.cal-leg-dot.miss{background:var(--red-l);color:var(--red);border:1.5px solid #FECACA;}
.cal-leg-dot.future{background:var(--bg);border:1.5px solid var(--border);color:var(--text-l);}
.cal-leg-desc{line-height:1.3;}

/* ‚îÄ‚îÄ AJOUTER √âV√âNEMENT ‚îÄ‚îÄ */
.add-event-btn{width:100%;padding:13px;border-radius:14px;border:2px dashed var(--blue-mid);background:var(--blue-l);color:var(--blue);font-family:'Nunito',sans-serif;font-weight:700;font-size:.88rem;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px;}
.add-event-btn:active{transform:scale(.97);}

/* ‚îÄ‚îÄ RDV ‚îÄ‚îÄ */
.rdv-list{border-radius:var(--r);overflow:hidden;box-shadow:var(--shadow);margin:10px 16px 0;}
.rdv-item{background:var(--white);padding:14px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s;}
.rdv-item:last-child{border-bottom:none;}
.rdv-item:active{background:var(--bg);}
.rdv-date-box{width:46px;height:50px;border-radius:13px;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;}
.rdv-date-box.next{background:var(--blue);box-shadow:0 4px 12px rgba(74,144,217,.3);}
.rdv-date-box.fut{background:var(--bg);border:2px solid var(--border);}
.rdv-date-box.warn{background:var(--orange-l);border:2px solid var(--orange);}
.rdv-day{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.1rem;line-height:1;color:white;}
.rdv-date-box.fut .rdv-day,.rdv-date-box.warn .rdv-day{color:var(--text);}
.rdv-date-box.warn .rdv-day{color:var(--orange-d);}
.rdv-mois{font-family:'Nunito',sans-serif;font-weight:700;font-size:.58rem;color:rgba(255,255,255,.85);text-transform:uppercase;}
.rdv-date-box.fut .rdv-mois{color:var(--text-m);}
.rdv-date-box.warn .rdv-mois{color:var(--orange-d);}
.rdv-info{flex:1;}
.rdv-type{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.rdv-detail{font-size:.72rem;color:var(--text-m);margin-top:3px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.rdv-badge{display:inline-flex;padding:3px 8px;border-radius:20px;font-size:.63rem;font-weight:700;font-family:'Nunito',sans-serif;}
.rdv-badge.next{background:var(--blue-l);color:var(--blue);}
.rdv-badge.ok{background:var(--green-l);color:var(--green-d);}
.rdv-badge.attente{background:var(--orange-l);color:var(--orange-d);}
.rdv-arrow{color:var(--text-l);font-size:1rem;}
.rdv-link-btn{width:100%;padding:12px;border-radius:14px;border:none;margin-top:4px;font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px;}
.rdv-link-btn.ortho{background:var(--blue);color:white;box-shadow:0 4px 14px rgba(74,144,217,.3);}
.rdv-link-btn.ophtalmo{background:var(--teal);color:white;box-shadow:0 4px 14px rgba(58,191,191,.3);}
.rdv-link-btn:active{transform:scale(.97);}

/* ‚îÄ‚îÄ PROGR√àS ‚îÄ‚îÄ */
.vision-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.vision-tabs{display:flex;gap:4px;}
.vtab{padding:4px 10px;border-radius:8px;font-family:'Nunito',sans-serif;font-size:.7rem;font-weight:700;border:1.5px solid var(--border);background:var(--bg);color:var(--text-m);cursor:pointer;transition:all .15s;}
.vtab.active{background:var(--blue);border-color:var(--blue);color:white;}
.vision-eyes{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.eye-stat{border-radius:14px;padding:12px;text-align:center;border:2px solid var(--border);}
.eye-od{border-color:var(--blue);background:var(--blue-l);}
.eye-og{border-color:var(--green);background:var(--green-l);}
.eye-label{font-size:.63rem;font-weight:700;color:var(--text-m);text-transform:uppercase;letter-spacing:.4px;margin-bottom:3px;}
.eye-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.55rem;line-height:1;}
.eye-od .eye-val{color:var(--blue);}
.eye-og .eye-val{color:var(--green-d);}
.eye-prog{font-size:.7rem;font-weight:700;margin-top:3px;color:var(--green-d);}
.chart-wrap{position:relative;height:140px;}
.chart-labels-y{position:absolute;left:0;top:0;bottom:20px;width:24px;display:flex;flex-direction:column;justify-content:space-between;align-items:flex-end;padding-right:4px;}
.chart-labels-y span{font-size:.54rem;color:var(--text-l);font-family:'Nunito',sans-serif;font-weight:700;}
.chart-svg{position:absolute;left:24px;right:0;top:0;bottom:0;}
.vision-legend{display:flex;gap:14px;margin-top:8px;}
.vleg{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--text-m);font-weight:600;}
.vleg-line{width:16px;height:3px;border-radius:2px;}

/* ‚îÄ‚îÄ TAUX OBSERVANCE ‚îÄ‚îÄ */
.obs-big{text-align:center;padding:10px 0 6px;}
.obs-pct{font-family:'Nunito',sans-serif;font-weight:900;font-size:3rem;color:var(--blue);line-height:1;}
.obs-label{font-size:.8rem;color:var(--text-m);margin-top:4px;}
.obs-bar-wrap{height:16px;background:var(--bg);border-radius:20px;overflow:hidden;margin:12px 0;}
.obs-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--green));border-radius:20px;transition:width 1s ease;}
.obs-months{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px;}
.obs-month{background:var(--bg);border-radius:12px;padding:10px 8px;text-align:center;border:1.5px solid var(--border);}
.obs-month-val{font-family:'Nunito',sans-serif;font-weight:800;font-size:.95rem;color:var(--blue);}
.obs-month-label{font-size:.65rem;color:var(--text-m);margin-top:2px;}

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.stars-row{display:flex;justify-content:center;gap:4px;flex-wrap:wrap;margin-bottom:10px;}
.star{font-size:1.35rem;transition:transform .2s cubic-bezier(.34,1.56,.64,1);}
.star.filled{animation:popIn .3s ease-out both;}
.stars-sub{text-align:center;font-size:.75rem;color:var(--text-m);margin-bottom:12px;}
.badges-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.badge-item{display:flex;flex-direction:column;align-items:center;gap:5px;padding:12px 5px;border-radius:14px;border:2px solid var(--border);background:var(--bg);opacity:.4;}
.badge-item.unlocked{background:var(--orange-l);border-color:var(--orange);opacity:1;}
.badge-item.unlocked:hover{transform:scale(1.06);transition:transform .15s cubic-bezier(.34,1.56,.64,1);}
.badge-icon{font-size:1.5rem;}
.badge-name{font-family:'Nunito',sans-serif;font-size:.58rem;font-weight:800;color:var(--text-m);text-align:center;line-height:1.2;}
.badge-item.unlocked .badge-name{color:var(--orange-d);}
.badge-row{background:var(--white);border-radius:16px;padding:13px 15px;display:flex;align-items:center;gap:12px;border:1.5px solid var(--border);box-shadow:var(--shadow);margin-bottom:8px;}
.badge-row.unlocked{border-color:var(--orange);background:var(--orange-l);}
.badge-row-icon{width:48px;height:48px;border-radius:14px;background:var(--bg);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0;}
.badge-row.unlocked .badge-row-icon{background:var(--white);border-color:var(--orange);}
.badge-row-info{flex:1;}
.badge-row-name{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.badge-row-desc{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.badge-row-status{font-size:.75rem;font-weight:700;}
.badge-row.unlocked .badge-row-status{color:var(--green-d);}
.badge-row:not(.unlocked) .badge-row-status{color:var(--text-l);}

/* ‚îÄ‚îÄ DOCS ‚îÄ‚îÄ */
.doc-section-hd{font-family:'Nunito',sans-serif;font-size:.8rem;font-weight:900;text-transform:uppercase;letter-spacing:.1em;padding:14px 16px 6px;color:var(--text-m);display:flex;align-items:center;gap:6px;}
.doc-list{margin:0 16px 4px;display:flex;flex-direction:column;gap:6px;}
.doc-item{background:var(--white);border-radius:16px;border:1.5px solid var(--border);box-shadow:var(--shadow);cursor:pointer;transition:all .15s;overflow:hidden;}
.doc-item:active{transform:scale(.98);}
.doc-item-hd{padding:13px 16px;display:flex;align-items:center;gap:12px;}
.doc-item-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;}
.doc-item-icon.blue{background:var(--blue-l);}
.doc-item-icon.green{background:var(--green-l);}
.doc-item-icon.orange{background:var(--orange-l);}
.doc-item-icon.teal{background:var(--teal-l);}
.doc-item-icon.red{background:var(--red-l);}
.doc-item-info{flex:1;}
.doc-item-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;color:var(--text);}
.doc-item-sub{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.doc-item-arrow{color:var(--text-l);font-size:.95rem;transition:transform .2s;}
.doc-item.open .doc-item-arrow{transform:rotate(90deg);}
.doc-item-body{padding:0 16px;max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease;}
.doc-item.open .doc-item-body{max-height:500px;padding:0 16px 14px;}
.doc-sub-list{display:flex;flex-direction:column;gap:6px;}
.doc-sub-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:12px;background:var(--bg);cursor:pointer;transition:background .1s;border:1px solid var(--border);}
.doc-sub-item:active{background:var(--blue-l);}
.doc-sub-icon{font-size:1rem;flex-shrink:0;}
.doc-sub-text{font-size:.82rem;font-weight:600;color:var(--text);flex:1;}
.doc-sub-badge{font-size:.62rem;font-weight:700;padding:2px 7px;border-radius:10px;}
.doc-sub-badge.new{background:var(--blue-l);color:var(--blue);}
.doc-sub-badge.pdf{background:var(--red-l);color:var(--red);}
.doc-sub-badge.video{background:var(--orange-l);color:var(--orange-d);}

/* ‚îÄ‚îÄ ORDONNANCES ‚îÄ‚îÄ */
.ordo-item{background:var(--white);border-radius:16px;border:2px solid var(--blue);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;box-shadow:var(--shadow);}
.ordo-icon{width:44px;height:44px;border-radius:12px;background:var(--blue-l);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
.ordo-info{flex:1;}
.ordo-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.ordo-date{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.ordo-btn{background:var(--blue);color:white;border:none;border-radius:10px;padding:7px 12px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.75rem;cursor:pointer;}

/* ‚îÄ‚îÄ KITS ‚îÄ‚îÄ */
.kit-card{background:var(--white);border-radius:16px;border:1.5px solid var(--border);margin-bottom:8px;box-shadow:var(--shadow);overflow:hidden;}
.kit-hd{padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;}
.kit-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.kit-info{flex:1;}
.kit-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.kit-sub{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.kit-body{padding:0 16px;max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease;}
.kit-card.open .kit-body{max-height:300px;padding:0 16px 14px;}
.kit-dl-btn{width:100%;padding:11px;border-radius:12px;border:none;font-family:'Nunito',sans-serif;font-weight:700;font-size:.82rem;cursor:pointer;margin-bottom:6px;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .15s;}
.kit-dl-btn:active{transform:scale(.97);}
.kit-dl-btn.blue{background:var(--blue);color:white;box-shadow:0 3px 12px rgba(74,144,217,.3);}
.kit-dl-btn.orange{background:var(--orange);color:white;}
.kit-dl-btn.green{background:var(--green);color:white;}

/* ‚îÄ‚îÄ R√âGLAGES ‚îÄ‚îÄ */
.settings-section{margin:0 16px 4px;}
.settings-item{background:var(--white);border-radius:16px;border:1.5px solid var(--border);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;box-shadow:var(--shadow);cursor:pointer;transition:background .1s;}
.settings-item:active{background:var(--bg);}
.settings-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;}
.settings-info{flex:1;}
.settings-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.settings-sub{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.settings-arrow{color:var(--text-l);font-size:.9rem;}
.toggle-row{background:var(--white);border-radius:16px;border:1.5px solid var(--border);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;box-shadow:var(--shadow);}
.toggle-info{flex:1;}
.toggle-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.88rem;}
.toggle-sub{font-size:.72rem;color:var(--text-m);margin-top:2px;}
.toggle{position:relative;width:42px;height:24px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:var(--border);border-radius:20px;cursor:pointer;transition:.2s;}
.toggle-slider::before{content:'';position:absolute;width:18px;height:18px;left:3px;top:3px;background:white;border-radius:50%;transition:.2s;box-shadow:0 1px 4px rgba(0,0,0,.15);}
.toggle input:checked + .toggle-slider{background:var(--blue);}
.toggle input:checked + .toggle-slider::before{transform:translateX(18px);}

/* ‚îÄ‚îÄ PERMISSION BANNER ‚îÄ‚îÄ */
.perm-banner{background:var(--orange-l);border:2px solid var(--orange);border-radius:14px;padding:14px 16px;margin:10px 16px 0;display:none;animation:fadeUp .4s ease;}
.perm-banner p{font-size:.85rem;color:var(--text);font-weight:600;}
.perm-banner button{margin-top:8px;background:var(--orange);color:white;border:none;border-radius:10px;padding:8px 16px;font-family:'Nunito',sans-serif;font-weight:700;cursor:pointer;font-size:.85rem;display:flex;align-items:center;gap:6px;}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.94);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1.5px solid var(--border);display:grid;grid-template-columns:repeat(4,1fr);padding:8px 0 16px;z-index:100;}
.bnav{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:4px 8px;border:none;background:none;font-family:'Quicksand',sans-serif;position:relative;transition:all .15s;border-radius:12px;}
.bnav.active{background:var(--blue-l);}
.bnav::before{content:'';position:absolute;top:-4px;left:50%;transform:translateX(-50%);width:0;height:3px;background:var(--blue);border-radius:0 0 3px 3px;transition:width .2s ease;}
.bnav.active::before{width:24px;}
.bnav-img{width:28px;height:28px;object-fit:contain;transition:transform .2s cubic-bezier(.34,1.56,.64,1);}
.bnav-label{font-size:.6rem;font-weight:700;color:var(--text-m);transition:color .15s;}
.bnav.active .bnav-img{transform:scale(1.15);}
.bnav.active .bnav-label{color:var(--blue);font-weight:900;}
.bnav-badge{position:absolute;top:0;right:50%;margin-right:-18px;background:var(--red);color:white;font-size:.5rem;font-weight:800;padding:2px 5px;border-radius:10px;font-family:'Nunito',sans-serif;min-width:16px;text-align:center;}

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.confetti-wrap{position:fixed;inset:0;pointer-events:none;z-index:999;display:none;}
.confetti-wrap.show{display:block;}
.confetti{position:absolute;border-radius:2px;animation:confettiFall var(--dur) ease-in forwards;animation-delay:var(--delay);}
@keyframes confettiFall{0%{transform:translateY(-20px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* ‚îÄ‚îÄ NOTIFICATION STATUS ‚îÄ‚îÄ */
.notif-status{display:inline-flex;align-items:center;gap:6px;background:var(--blue-l);color:var(--blue);border-radius:30px;padding:6px 14px;font-family:'Nunito',sans-serif;font-size:.8rem;font-weight:700;margin-top:10px;}

/* spacing helpers */
.pb8{padding-bottom:8px;}
.mt8{margin-top:8px;}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE : MON AGENDA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-agenda">

  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" class="header-logo">
    <div class="header-right">
      <button class="notif-btn" onclick="envoyerNotif('cache')">üîî<div class="notif-dot" id="notif-dot"></div></button>
    </div>
  </div>

  <!-- TITRE PAGE -->
  <div class="page-title">
    <div class="page-title-icon" style="background:#EBF4FB;"><img src="calendrier.png" style="width:24px;height:24px;object-fit:contain;" alt="agenda"></div>
    <div><div class="page-title-text">Mon agenda</div><div class="page-title-sub">Suivi quotidien du cache</div></div>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div class="hero-top">
      <div>
        <div class="hero-greeting">üëã Bonjour</div>
        <div class="hero-name" id="hero-name">Jules !</div>
      </div>
      <div id="mascot" style="font-size:2.8rem;animation:bounce 2.5s ease-in-out infinite;filter:drop-shadow(0 4px 8px rgba(0,0,0,.2));flex-shrink:0">ü¶∏</div>
    </div>
    <!-- Message du jour -->
    <div class="hero-msg" id="hero-msg-day" style="text-align:center;">
      Aujourd'hui, colle le cache sur ton :<br>
      <span style="font-size:1.1rem;font-weight:900;letter-spacing:.05em;display:block;margin:8px 0 6px;text-shadow:0 2px 8px rgba(0,0,0,.18);">üëÅ &nbsp;≈íIL DROIT</span>
      <span style="font-size:.88rem;font-weight:600;opacity:.92;">de 8h √† 18h &nbsp;¬∑&nbsp; Objectif 10h üöÄ</span>
      <span style="margin-top:6px;display:block;font-size:.82rem;opacity:.85;">Bon courage champion !</span>
    </div>
    <!-- Barre de progression de la journ√©e -->
    <div class="hero-day-progress">
      <div style="font-size:.62rem;font-weight:800;opacity:.82;letter-spacing:.05em;margin-bottom:6px;position:relative;z-index:1;">Journ√©e en cours :</div>
      <div class="hero-day-label">
        <span>8h00</span>
        <span></span>
        <span>18h00</span>
      </div>
      <div class="hero-day-bar-bg">
        <div class="hero-day-bar" id="hero-day-bar" style="width:0%"></div>
        <div class="hero-day-marker" id="hero-day-marker" style="left:0%"></div>
      </div>
    </div>
    <!-- Semaine type -->
    <div style="background:rgba(255,255,255,.13);border-radius:10px;padding:10px 12px;position:relative;z-index:1;">
      <div style="font-size:.62rem;font-weight:800;opacity:.85;margin-bottom:8px;letter-spacing:.05em;">Semaine type</div>
      <div style="display:flex;gap:4px;"><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#4A90D9;display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">OD</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Lu</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#4A90D9;display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">OD</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Ma</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">OG</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Me</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">OG</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Je</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:#2EAFAF;display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">OG</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Ve</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">‚òï</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Sa</span></div><div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;"><div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:.52rem;font-weight:900;color:white;box-shadow:0 1px 4px rgba(0,0,0,.15);">‚òï</div><span style="font-size:.55rem;font-weight:700;opacity:.8;">Di</span></div></div>
    </div>
  </div>

  <!-- PERMISSION BANNER -->
  <div class="perm-banner" id="perm-banner">
    <p>üîî Active les notifications pour les rappels de Jules !</p>
    <button onclick="demanderPermission()">üîî Activer</button>
  </div>

  <!-- JOURS √Ä COMPL√âTER -->
  <div id="pending-section">
    <div class="section-title">üìã Jours √† compl√©ter</div>
    <div class="card" style="margin:0 16px;">
      <div style="font-family:'Nunito',sans-serif;font-weight:700;font-size:.88rem;color:var(--text);margin-bottom:14px;line-height:1.5;">
        Combien d'heures as-tu r√©ussi √† porter le cache ces jours-ci ?
      </div>
      <div id="pending-list"></div>
    </div>
  </div>

  <!-- CALENDRIER -->
  <div class="section-title">üìÖ Calendrier mensuel</div>
  <div class="card">
    <div class="cal-hd">
      <div class="cal-nav">
        <button class="cal-nav-btn" onclick="calPrev()">‚Äπ</button>
        <div class="cal-month-label" id="cal-month-label">F√©vrier 2026</div>
        <button class="cal-nav-btn" onclick="calNext()">‚Ä∫</button>
      </div>
      <div><div class="cal-score-val" id="cal-score-val">84%</div><div class="cal-score-label">observance</div></div>
    </div>
    <div class="cal-day-labels"><div class="cdl">L</div><div class="cdl">M</div><div class="cdl">M</div><div class="cdl">J</div><div class="cdl">V</div><div class="cdl">S</div><div class="cdl">D</div></div>
    <div class="cal-grid" id="cal-grid"></div>
    <!-- L√©gende calendrier simplifi√©e -->
    <div style="margin-top:12px;border-top:1px solid var(--border);padding-top:10px;font-family:'Nunito',sans-serif;font-size:.72rem;font-weight:700;color:var(--text);display:flex;flex-direction:column;gap:8px;">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#4A90D9;flex-shrink:0;"></span> OD</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#2EAFAF;flex-shrink:0;"></span> OG</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#94A3B8;flex-shrink:0;"></span> Pause ‚òï</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#27AE60;flex-shrink:0;"></span> Objectif rempli</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#F39C12;flex-shrink:0;"></span> Objectif partiel</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#E74C3C;flex-shrink:0;"></span> Objectif manqu√©</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:rgba(100,116,139,.3);border:1px solid #94A3B8;font-size:.4rem;font-weight:900;color:#64748B;display:flex;align-items:center;justify-content:center;flex-shrink:0;">?</span> Non renseign√©</div>
        <div style="display:flex;align-items:center;gap:4px;"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;border:2px solid #F39C12;flex-shrink:0;font-size:.55rem;display:flex;align-items:center;justify-content:center;">üè•</span> RDV m√©dical</div>
      </div>
    </div>
    </div>

  <div style="margin:10px 16px 0;">
    <button class="add-event-btn" onclick="showToast('Bient√¥t disponible üöß','blue')">
      ‚ûï Ajouter un √©v√©nement (lunettes perdues, cass√©es...)
    </button>
  </div>

  <!-- RDV -->
  <div class="section-title">üóì Mes rendez-vous</div>
  <div style="margin:0 16px;display:flex;flex-direction:column;gap:8px;">

    <!-- RDV prochain : orthoptiste -->
    <div style="background:white;border-radius:16px;border:2px solid #4A90D9;box-shadow:0 4px 14px rgba(74,144,217,.18);padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s;" onmouseover="this.style.transform='scale(1.01)'" onmouseout="this.style.transform=''">
      <div style="width:48px;height:52px;border-radius:13px;background:#4A90D9;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 3px 10px rgba(74,144,217,.35);">
        <div style="font-family:'Nunito',sans-serif;font-weight:900;font-size:1.15rem;color:white;line-height:1;">03</div>
        <div style="font-size:.6rem;font-weight:700;color:rgba(255,255,255,.88);text-transform:uppercase;">Mar</div>
      </div>
      <div style="flex:1;">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px;">
          <span style="font-size:1rem;">üè•</span>
          <span style="font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:#1A3A5C;">Bilan orthoptique</span>
        </div>
        <div style="font-size:.75rem;color:#64748B;">14h00 ¬∑ Mme Lecomte</div>
        <div style="margin-top:4px;"><span style="font-size:.65rem;background:#EBF4FB;color:#2E6DB4;border-radius:6px;padding:2px 7px;font-weight:700;border:1px solid #C8E4FA;">üìÖ Dans 5 jours</span></div>
      </div>
      <div style="font-size:1.2rem;color:#4A90D9;">‚Ä∫</div>
    </div>

    <!-- RDV ophtalmo -->
    <div style="background:white;border-radius:16px;border:2px solid #2EAFAF;box-shadow:0 3px 10px rgba(46,175,175,.12);padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s;" onmouseover="this.style.transform='scale(1.01)'" onmouseout="this.style.transform=''">
      <div style="width:48px;height:52px;border-radius:13px;background:#2EAFAF;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 3px 10px rgba(46,175,175,.25);">
        <div style="font-family:'Nunito',sans-serif;font-weight:900;font-size:1.15rem;color:white;line-height:1;">07</div>
        <div style="font-size:.6rem;font-weight:700;color:rgba(255,255,255,.88);text-transform:uppercase;">Avr</div>
      </div>
      <div style="flex:1;">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px;">
          <span style="font-size:1rem;">üëÅ</span>
          <span style="font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:#1A3A5C;">Contr√¥le ophtalmologue</span>
        </div>
        <div style="font-size:.75rem;color:#64748B;">10h30 ¬∑ Dr. Benali</div>
        <div style="margin-top:4px;"><span style="font-size:.65rem;background:#E8F8F8;color:#1A7A7A;border-radius:6px;padding:2px 7px;font-weight:700;border:1px solid #B2E8E8;">‚úì Confirm√©</span></div>
      </div>
      <div style="font-size:1.2rem;color:#2EAFAF;">‚Ä∫</div>
    </div>

    <!-- RDV √† planifier -->
    <div style="background:white;border-radius:16px;border:2px dashed #F39C12;box-shadow:0 3px 10px rgba(243,156,18,.1);padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .15s;" onmouseover="this.style.transform='scale(1.01)'" onmouseout="this.style.transform=''">
      <div style="width:48px;height:52px;border-radius:13px;background:#FEF3C7;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;border:2px dashed #F39C12;">
        <div style="font-size:1.4rem;">üìã</div>
      </div>
      <div style="flex:1;">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px;">
          <span style="font-size:1rem;">ü©∫</span>
          <span style="font-family:'Nunito',sans-serif;font-weight:900;font-size:.9rem;color:#1A3A5C;">Prochain suivi</span>
        </div>
        <div style="font-size:.75rem;color:#64748B;">Juin ¬∑ Dr. Benali</div>
        <div style="margin-top:4px;"><span style="font-size:.65rem;background:#FEF3C7;color:#92400E;border-radius:6px;padding:2px 7px;font-weight:700;border:1px solid #FDE68A;">‚è∞ √Ä planifier</span></div>
      </div>
      <div style="font-size:1.2rem;color:#F39C12;">‚Ä∫</div>
    </div>

  </div>

  <!-- PRENDRE RDV -->
  <div class="section-title">üìû Prendre rendez-vous</div>
  <div style="margin:0 16px;display:flex;flex-direction:column;gap:8px;padding-bottom:8px;">
    <button class="rdv-link-btn ortho" onclick="showToast('Ouverture Doctolib‚Ä¶','blue')">üìÖ Prendre RDV orthoptiste</button>
    <button class="rdv-link-btn ophtalmo" onclick="showToast('Ouverture Doctolib‚Ä¶','teal')">üëÅ Prendre RDV ophtalmologue</button>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE : MES PROGR√àS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-progres">

  <!-- TITRE PAGE -->
  <div class="page-title">
    <div class="page-title-icon" style="background:#E8F8F4;"><img src="progres.png" style="width:24px;height:24px;object-fit:contain;" alt="progr√®s"></div>
    <div><div class="page-title-text">Mes progr√®s</div><div class="page-title-sub">Vision, observance & badges</div></div>
  </div>

  <!-- ENCART BADGE ACTUEL + PROCHAIN OBJECTIF fusionn√©s -->
  <div style="margin:0 16px 0;border-radius:18px;background:#5BBF8E;padding:18px 20px;box-shadow:0 6px 20px rgba(91,191,142,.28);color:white;position:relative;overflow:hidden;">
    <div style="position:absolute;top:-30px;right:-30px;width:120px;height:120px;background:rgba(255,255,255,.12);border-radius:50%;pointer-events:none;"></div>
    <div style="position:absolute;bottom:-20px;left:20px;width:80px;height:80px;background:rgba(255,255,255,.08);border-radius:50%;pointer-events:none;"></div>

    <!-- Badge actuel -->
    <div style="font-family:'Nunito',sans-serif;font-size:.62rem;font-weight:800;text-transform:uppercase;letter-spacing:.12em;opacity:.8;margin-bottom:8px;">Badge actuel</div>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
      <div style="font-size:2.4rem;filter:drop-shadow(0 3px 6px rgba(0,0,0,.15));flex-shrink:0;">üèÖ</div>
      <div style="flex:1;">
        <div style="font-family:'Nunito',sans-serif;font-size:1.35rem;font-weight:900;line-height:1;">Champion</div>
        <div style="font-size:.75rem;opacity:.88;margin-top:2px;">40 √©toiles atteintes ‚úì</div>
      </div>
    </div>

    <!-- Ronds KPI -->
    <div style="display:flex;justify-content:space-around;gap:6px;position:relative;z-index:1;margin-bottom:14px;">
      <div style="display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;">
        <span style="font-size:.6rem;font-weight:800;opacity:.88;text-align:center;line-height:1.3;">J'ai r√©ussi √†<br>porter le cache :</span>
        <div style="width:62px;height:62px;border-radius:50%;background:rgba(255,255,255,.28);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(0,0,0,.12);">
          <span style="font-family:'Nunito',sans-serif;font-size:1.4rem;font-weight:900;line-height:1;">12</span>
        </div>
        <span style="font-size:.58rem;font-weight:700;opacity:.85;text-align:center;">jours d'affil√©e</span>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;">
        <span style="font-size:.6rem;font-weight:800;opacity:.88;text-align:center;line-height:1.3;">J'ai atteint :<br>&nbsp;</span>
        <div style="width:62px;height:62px;border-radius:50%;background:rgba(255,255,255,.28);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(0,0,0,.12);">
          <span style="font-family:'Nunito',sans-serif;font-size:1.4rem;font-weight:900;line-height:1;">84%</span>
        </div>
        <span style="font-size:.58rem;font-weight:700;opacity:.85;text-align:center;">de mes objectifs<br>ce mois-ci</span>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;">
        <span style="font-size:.6rem;font-weight:800;opacity:.88;text-align:center;line-height:1.3;">J'ai gagn√© :<br>&nbsp;</span>
        <div style="width:62px;height:62px;border-radius:50%;background:rgba(255,255,255,.28);display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(0,0,0,.12);">
          <span style="font-family:'Nunito',sans-serif;font-size:1.4rem;font-weight:900;line-height:1;">47</span>
        </div>
        <span style="font-size:.58rem;font-weight:700;opacity:.85;text-align:center;">√©toiles ‚≠ê</span>
      </div>
    </div>

    <!-- S√©parateur -->
    <div style="border-top:1px solid rgba(255,255,255,.25);margin-bottom:12px;"></div>

    <!-- Prochain objectif ‚Äî m√™me style que Semaine type -->
    <div style="background:rgba(255,255,255,.13);border-radius:10px;padding:10px 12px;position:relative;z-index:1;">
      <div style="font-size:.62rem;font-weight:800;opacity:.85;margin-bottom:8px;letter-spacing:.05em;">Prochain objectif</div>
      <div style="display:flex;gap:4px;">
        <!-- Badge actuel : mis en avant -->
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.9);display:flex;align-items:center;justify-content:center;font-size:.9rem;box-shadow:0 1px 4px rgba(0,0,0,.15);">üèÖ</div>
          <span style="font-size:.48rem;font-weight:900;opacity:1;text-align:center;line-height:1.2;">Cham-<br>pion</span>
        </div>
        <!-- Prochain : H√©ros -->
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;font-size:.9rem;box-shadow:0 1px 4px rgba(0,0,0,.15);border:2px solid rgba(255,255,255,.6);">‚≠ê</div>
          <span style="font-size:.48rem;font-weight:800;opacity:.9;text-align:center;line-height:1.2;">H√©ros<br><span style="opacity:.75;">-3‚≠ê</span></span>
        </div>
        <!-- Suivants gris√©s -->
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:.9rem;filter:grayscale(60%);box-shadow:0 1px 4px rgba(0,0,0,.1);">ü¶∏</div>
          <span style="font-size:.48rem;font-weight:700;opacity:.65;text-align:center;line-height:1.2;">Super-<br>H√©ros</span>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:.9rem;filter:grayscale(60%);box-shadow:0 1px 4px rgba(0,0,0,.1);">üî¨</div>
          <span style="font-size:.48rem;font-weight:700;opacity:.65;text-align:center;line-height:1.2;">Expert</span>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:.9rem;filter:grayscale(60%);box-shadow:0 1px 4px rgba(0,0,0,.1);">üéì</div>
          <span style="font-size:.48rem;font-weight:700;opacity:.65;text-align:center;line-height:1.2;">Ma√Ætre</span>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:.9rem;filter:grayscale(60%);box-shadow:0 1px 4px rgba(0,0,0,.1);">üëë</div>
          <span style="font-size:.48rem;font-weight:700;opacity:.65;text-align:center;line-height:1.2;">Grand<br>Ma√Ætre</span>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;">
          <div style="width:100%;aspect-ratio:1;border-radius:8px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;font-size:.9rem;filter:grayscale(60%);box-shadow:0 1px 4px rgba(0,0,0,.1);">üåü</div>
          <span style="font-size:.48rem;font-weight:700;opacity:.65;text-align:center;line-height:1.2;">L√©gende</span>
        </div>
      </div>
      <!-- Jauge progression vers prochain badge -->
      <div style="margin-top:8px;display:flex;align-items:center;gap:6px;">
        <div style="flex:1;background:rgba(255,255,255,.2);border-radius:10px;height:6px;overflow:hidden;">
          <div style="height:100%;width:94%;background:rgba(255,255,255,.85);border-radius:10px;transition:width 1s ease;"></div>
        </div>
        <span style="font-size:.62rem;font-weight:900;opacity:.95;white-space:nowrap;">encore 3 ‚≠ê</span>
      </div>
      <div id="next-badge-reward" style="font-size:.68rem;color:#FFF9C4;font-weight:700;margin-top:6px;display:none;">üéÅ <span id="next-reward-text"></span></div>
    </div>
  </div>

  <!-- COURBE VISION -->
  <div class="section-title">üëÅ Courbe d'acuit√© visuelle</div>
  <div class="card">
    <div class="vision-hd">
      <div style="font-family:'Nunito',sans-serif;font-weight:800;font-size:.95rem;">Progression</div>
      <div class="vision-tabs">
        <button class="vtab active" onclick="activateVtab(this)">3 mois</button>
        <button class="vtab" onclick="activateVtab(this)">6 mois</button>
        <button class="vtab" onclick="activateVtab(this)">Tout</button>
      </div>
    </div>
    <div class="vision-eyes">
      <div class="eye-stat eye-od"><div class="eye-label">≈íil droit (OD)</div><div class="eye-val">6/10</div><div class="eye-prog">‚Üë +2/10 depuis d√©c.</div></div>
      <div class="eye-stat eye-og"><div class="eye-label">≈íil gauche (OG)</div><div class="eye-val">9/10</div><div class="eye-prog">‚Üë +1/10 depuis d√©c.</div></div>
    </div>
    <div class="chart-wrap">
      <div class="chart-labels-y"><span>10</span><span>8</span><span>6</span><span>4</span><span>2</span></div>
      <div class="chart-svg">
        <svg viewBox="0 0 340 120" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%">
          <defs>
            <linearGradient id="gOD" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4A90D9" stop-opacity=".2"/><stop offset="100%" stop-color="#4A90D9" stop-opacity="0"/></linearGradient>
            <linearGradient id="gOG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#5BBF8E" stop-opacity=".2"/><stop offset="100%" stop-color="#5BBF8E" stop-opacity="0"/></linearGradient>
          </defs>
          <line x1="0" y1="0" x2="340" y2="0" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="24" x2="340" y2="24" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="48" x2="340" y2="48" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="72" x2="340" y2="72" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="96" x2="340" y2="96" stroke="#EAF4FF" stroke-width="1"/>
          <polygon points="0,108 68,96 136,72 204,84 272,72 340,48 340,120 0,120" fill="url(#gOD)"/>
          <polyline points="0,108 68,96 136,72 204,84 272,72 340,48" fill="none" stroke="#4A90D9" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="108" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="68" cy="96" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="136" cy="72" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="204" cy="84" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="272" cy="72" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/><circle cx="340" cy="48" r="5" fill="#4A90D9" stroke="white" stroke-width="2.5"/>
          <text x="326" y="41" font-size="9" fill="#2E6DB4" font-weight="800" font-family="Nunito">6/10</text>
          <polygon points="0,12 68,6 136,0 204,6 272,12 340,12 340,50 0,50" fill="url(#gOG)"/>
          <polyline points="0,12 68,6 136,0 204,6 272,12 340,12" fill="none" stroke="#5BBF8E" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="12" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="68" cy="6" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="136" cy="0" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="204" cy="6" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="272" cy="12" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/><circle cx="340" cy="12" r="5" fill="#5BBF8E" stroke="white" stroke-width="2.5"/>
          <text x="326" y="8" font-size="9" fill="#3A8F68" font-weight="800" font-family="Nunito">9/10</text>
          <text x="0" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Nov</text>
          <text x="68" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">D√©c</text>
          <text x="136" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Jan</text>
          <text x="204" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">F√©v</text>
          <text x="272" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="700" text-anchor="middle">Mar</text>
          <text x="340" y="115" font-size="8" fill="#4A90D9" font-family="Nunito" font-weight="800" text-anchor="middle">Auj.</text>
        </svg>
      </div>
    </div>
    <div class="vision-legend">
      <div class="vleg"><div class="vleg-line" style="background:#4A90D9"></div>≈íil droit</div>
      <div class="vleg"><div class="vleg-line" style="background:#5BBF8E"></div>≈íil gauche</div>
    </div>
  </div>

  <!-- TAUX D'OBSERVANCE -->
  <div class="section-title">üìä Taux d'observance</div>
  <div class="card">
    <div class="obs-big">
      <div class="obs-pct">84%</div>
      <div class="obs-label">Ce mois ¬∑ objectif 4h/jour</div>
    </div>
    <div class="obs-bar-wrap"><div class="obs-bar" id="obs-bar" style="width:0%"></div></div>
    <div class="obs-months">
      <div class="obs-month"><div class="obs-month-val">91%</div><div class="obs-month-label">D√©cembre</div></div>
      <div class="obs-month"><div class="obs-month-val">78%</div><div class="obs-month-label">Janvier</div></div>
      <div class="obs-month"><div class="obs-month-val">84%</div><div class="obs-month-label">F√©vrier</div></div>
    </div>
  </div>

  <!-- BADGES -->
  <div class="section-title">üèÜ Badges & r√©compenses</div>
  <div class="card" id="badges-section"></div>
  <div style="height:8px"></div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE : MES DOCS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-docs">

  <!-- TITRE PAGE -->
  <div class="page-title">
    <div class="page-title-icon" style="background:#FEF3C7;"><img src="docs.png" style="width:24px;height:24px;object-fit:contain;" alt="docs"></div>
    <div><div class="page-title-text">Mes documents</div><div class="page-title-sub">Ordonnances & ressources</div></div>
  </div>

  <!-- ORDONNANCES -->
  <div class="section-title">üìÑ Ordonnances</div>
  <div style="margin:0 16px">
    <div class="ordo-item">
      <div class="ordo-icon">ü©π</div>
      <div class="ordo-info"><div class="ordo-title">Ordonnance cache-≈ìil</div><div class="ordo-date">Dr. Benali ¬∑ 15 janvier 2026 ¬∑ 20 s√©ances</div></div>
      <button class="ordo-btn">Voir</button>
    </div>
    <div class="ordo-item" style="border-color:var(--green)">
      <div class="ordo-icon" style="background:var(--green-l)">üëì</div>
      <div class="ordo-info"><div class="ordo-title">Ordonnance lunettes</div><div class="ordo-date">Dr. Benali ¬∑ 15 janvier 2026</div></div>
      <button class="ordo-btn" style="background:var(--green)">Voir</button>
    </div>
  </div>

  <!-- POUR LES PARENTS -->
  <div class="doc-section-hd">üë®‚Äçüë©‚Äçüëß Pour les parents</div>

  <!-- Comprendre -->
  <div class="doc-list">
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon blue">üìñ</div>
        <div class="doc-item-info"><div class="doc-item-title">Comprendre l'amblyopie</div><div class="doc-item-sub">Causes, d√©pistage, risques, traitement</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item" onclick="showToast('Ouverture‚Ä¶','blue')"><span class="doc-sub-icon">üìò</span><span class="doc-sub-text">L'amblyopie : causes, d√©pistage, risques</span><span class="doc-sub-badge pdf">PDF</span></div>
          <div class="doc-sub-item" onclick="showToast('Ouverture‚Ä¶','blue')"><span class="doc-sub-icon">üìó</span><span class="doc-sub-text">L'amblyoth√©rapie : objectifs, dispositifs, √©tapes cl√©s</span><span class="doc-sub-badge pdf">PDF</span></div>
        </div>
      </div>
    </div>

    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon orange">üí°</div>
        <div class="doc-item-info"><div class="doc-item-title">Conseils pratiques</div><div class="doc-item-sub">Poser, enlever, motiver, routine</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üåÖ</span><span class="doc-sub-text">Les premiers jours : annoncer & pr√©parer</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">ü©π</span><span class="doc-sub-text">Poser le patch / filtre (infographie)</span><span class="doc-sub-badge new">Infographie</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üå∏</span><span class="doc-sub-text">Enlever le patch en douceur (soins de la peau)</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üéØ</span><span class="doc-sub-text">Customiser le patch</span><span class="doc-sub-badge new">Id√©es</span></div>
        </div>
      </div>
    </div>

    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon green">üéÆ</div>
        <div class="doc-item-info"><div class="doc-item-title">Motiver & cr√©er la routine</div><div class="doc-item-sub">Id√©es, poster, tableau de r√©compenses</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üí°</span><span class="doc-sub-text">Id√©es pour motiver</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üñ®</span><span class="doc-sub-text">Poster √† imprimer</span><span class="doc-sub-badge pdf">PDF</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">‚≠ê</span><span class="doc-sub-text">Tableau de r√©compenses</span><span class="doc-sub-badge pdf">PDF</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">‚è±</span><span class="doc-sub-text">Timer visuel (mini-app)</span><span class="doc-sub-badge new">App</span></div>
        </div>
      </div>
    </div>

    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon teal">üí¨</div>
        <div class="doc-item-info"><div class="doc-item-title">T√©moignages & aller plus loin</div><div class="doc-item-sub">Familles, articles, guides officiels</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üë®‚Äçüë©‚Äçüëß</span><span class="doc-sub-text">T√©moignages parents / enfants, courbes</span><span class="doc-sub-badge video">Vid√©o</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üì∞</span><span class="doc-sub-text">Articles vulgaris√©s</span><span class="doc-sub-badge pdf">PDF</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üìã</span><span class="doc-sub-text">Guides officiels (HAS, SFO)</span><span class="doc-sub-badge pdf">PDF</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">ü§ù</span><span class="doc-sub-text">Associations & groupes conseill√©s</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- POUR L'ENFANT -->
  <div class="doc-section-hd">üßí Pour l'enfant</div>
  <div class="doc-list">
    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon orange">üìö</div>
        <div class="doc-item-info"><div class="doc-item-title">Comprendre avec les enfants</div><div class="doc-item-sub">BD, infographies, mini-jeux</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üé®</span><span class="doc-sub-text">BD : pourquoi je porte un cache ?</span><span class="doc-sub-badge new">Nouveau</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üñº</span><span class="doc-sub-text">Infographies illustr√©es</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üéÆ</span><span class="doc-sub-text">Mini-jeux p√©dagogiques</span><span class="doc-sub-badge new">App</span></div>
        </div>
      </div>
    </div>

    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon blue">üó£</div>
        <div class="doc-item-info"><div class="doc-item-title">Expliquer √† mes copains</div><div class="doc-item-sub">Cartes pr√™tes √† l'emploi</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üÉè</span><span class="doc-sub-text">Cartes d'explication simples</span><span class="doc-sub-badge pdf">PDF</span></div>
        </div>
      </div>
    </div>

    <div class="doc-item" onclick="toggleDoc(this)">
      <div class="doc-item-hd">
        <div class="doc-item-icon green">üí™</div>
        <div class="doc-item-info"><div class="doc-item-title">Rester motiv√©</div><div class="doc-item-sub">Livres, films, FAQ, t√©moignages</div></div>
        <div class="doc-item-arrow">‚Ä∫</div>
      </div>
      <div class="doc-item-body">
        <div class="doc-sub-list">
          <div class="doc-sub-item"><span class="doc-sub-icon">üìñ</span><span class="doc-sub-text">Livres / films par √¢ge</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">‚ùì</span><span class="doc-sub-text">FAQ enfant ‚Äî mes questions</span></div>
          <div class="doc-sub-item"><span class="doc-sub-icon">üé•</span><span class="doc-sub-text">T√©moignages d'anciens amblyopes</span><span class="doc-sub-badge video">Vid√©o</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- KITS PRATIQUES -->
  <div class="doc-section-hd">üñ® Kits pratiques √† imprimer</div>
  <div style="margin:0 16px">
    <div class="kit-card" onclick="toggleKit(this)">
      <div class="kit-hd">
        <div class="kit-icon" style="background:var(--blue-l)">üè´</div>
        <div class="kit-info"><div class="kit-title">Kit instituteur</div><div class="kit-sub">Pour expliquer √† l'√©cole</div></div>
        <div style="color:var(--text-l);font-size:.95rem;transition:transform .2s">‚Ä∫</div>
      </div>
      <div class="kit-body">
        <button class="kit-dl-btn blue">üìÑ Fiche "Amblyopie en 2 min"</button>
        <button class="kit-dl-btn orange">üìÖ Rythme actualis√© de l'enfant</button>
        <button class="kit-dl-btn green">üéì Expliquer aux autres enfants</button>
      </div>
    </div>

    <div class="kit-card" onclick="toggleKit(this)">
      <div class="kit-hd">
        <div class="kit-icon" style="background:var(--green-l)">üë®‚Äçüë©‚Äçüë¶</div>
        <div class="kit-info"><div class="kit-title">Kit famille √©largie</div><div class="kit-sub">Grands-parents, oncles, tantes...</div></div>
        <div style="color:var(--text-l);font-size:.95rem;transition:transform .2s">‚Ä∫</div>
      </div>
      <div class="kit-body">
        <button class="kit-dl-btn blue">üìÑ Fiche "Comprendre en 2 min"</button>
        <button class="kit-dl-btn green">üñ® Planning imprimable (p√©riode au choix)</button>
      </div>
    </div>
  </div>
  <div style="height:8px"></div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE : R√âGLAGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-reglages">

  <!-- TITRE PAGE -->
  <div class="page-title">
    <div class="page-title-icon" style="background:#F1F5F9;"><img src="reglages.png" style="width:24px;height:24px;object-fit:contain;" alt="r√©glages"></div>
    <div><div class="page-title-text">R√©glages</div><div class="page-title-sub">Profil & pr√©f√©rences</div></div>
  </div>

  <!-- PROFIL -->
  <div class="section-title">üë§ Profil</div>
  <div class="card" style="display:flex;align-items:center;gap:14px;">
    <div style="width:56px;height:56px;border-radius:50%;background:var(--blue);display:flex;align-items:center;justify-content:center;font-size:1.6rem;color:white;font-family:'Nunito',sans-serif;font-weight:900;flex-shrink:0;">J</div>
    <div style="flex:1">
      <div style="font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;">Jules</div>
      <div style="font-size:.75rem;color:var(--text-m);margin-top:2px;">8 ans ¬∑ Amblyopie OD ¬∑ Dr. Benali</div>
    </div>
    <button style="background:var(--blue-l);border:none;border-radius:10px;padding:7px 12px;font-family:'Nunito',sans-serif;font-weight:700;font-size:.75rem;color:var(--blue);cursor:pointer;">Modifier</button>
  </div>

  <!-- NOTIFICATIONS -->
  <div class="section-title">üîî Notifications</div>
  <div class="settings-section">
    <div class="toggle-row">
      <div class="toggle-info"><div class="toggle-title">Rappel matin ‚Äî mettre le cache</div><div class="toggle-sub">Chaque jour √† 8h00</div></div>
      <label class="toggle"><input type="checkbox" checked id="t-matin"><span class="toggle-slider"></span></label>
    </div>
    <div class="toggle-row">
      <div class="toggle-info"><div class="toggle-title">Rappel soir ‚Äî valider l'observance</div><div class="toggle-sub">Chaque jour √† 18h00</div></div>
      <label class="toggle"><input type="checkbox" checked id="t-soir"><span class="toggle-slider"></span></label>
    </div>
    <div class="toggle-row">
      <div class="toggle-info"><div class="toggle-title">Rappels de rendez-vous</div><div class="toggle-sub">J-2 et J-1 avant chaque RDV</div></div>
      <label class="toggle"><input type="checkbox" checked id="t-rdv"><span class="toggle-slider"></span></label>
    </div>
    <div class="toggle-row">
      <div class="toggle-info"><div class="toggle-title">Notifications badges & √©toiles</div><div class="toggle-sub">Quand Jules d√©bloque une r√©compense</div></div>
      <label class="toggle"><input type="checkbox" checked id="t-badges"><span class="toggle-slider"></span></label>
    </div>
  </div>

  <!-- TESTER NOTIFS -->
  <div class="section-title">üì£ Tester les rappels</div>
  <div class="card">
    <div class="perm-banner" id="perm-banner-2" style="margin:0 0 12px;display:none;">
      <p>üîî Active les notifications d'abord !</p>
      <button onclick="demanderPermission()">üîî Activer</button>
    </div>
    <button class="rappel-btn-test" style="width:100%;border:none;border-radius:14px;padding:16px;margin-bottom:8px;background:var(--blue);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:10px;text-align:left;box-shadow:0 4px 14px rgba(74,144,217,.3);" onclick="envoyerNotifDelai('cache',this)">
      <span style="font-size:1.4rem">üè¥‚Äç‚ò†Ô∏è</span>
      <span>Rappel : mettre le cache<br><span style="font-size:.75rem;opacity:.85;font-weight:500">Envoi dans 5 secondes‚Ä¶</span></span>
    </button>
    <button class="rappel-btn-test" style="width:100%;border:none;border-radius:14px;padding:16px;margin-bottom:8px;background:var(--green);color:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:10px;text-align:left;box-shadow:0 4px 14px rgba(91,191,142,.3);" onclick="envoyerNotifDelai('soir',this)">
      <span style="font-size:1.4rem">üéâ</span>
      <span>Pr√™t √† remplir l'observance<br><span style="font-size:.75rem;opacity:.85;font-weight:500">Envoi dans 5 secondes‚Ä¶</span></span>
    </button>
    <div class="notif-status" id="notif-status">üí§ En attente</div>
  </div>

  <!-- PARAM√àTRES TRAITEMENT -->
  <div class="section-title">‚öôÔ∏è Param√®tres du traitement</div>
  <div class="settings-section">
    <div class="settings-item">
      <div class="settings-icon" style="background:var(--blue-l)">üéØ</div>
      <div class="settings-info"><div class="settings-title">Objectif quotidien de cache</div><div class="settings-sub">Actuellement : 4h / jour</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-item">
      <div class="settings-icon" style="background:var(--orange-l)">‚è∞</div>
      <div class="settings-info"><div class="settings-title">Plage horaire du cache</div><div class="settings-sub">8h00 ‚Äì 18h00</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-item">
      <div class="settings-icon" style="background:var(--green-l)">üëÅ</div>
      <div class="settings-info"><div class="settings-title">≈íil amblyope</div><div class="settings-sub">≈íil droit (OD)</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
  </div>

  <!-- COMPTE -->
  <div class="section-title">üîß Compte</div>
  <div class="settings-section">
    <div class="settings-item">
      <div class="settings-icon" style="background:var(--blue-l)">üì±</div>
      <div class="settings-info"><div class="settings-title">Installer sur l'√©cran d'accueil</div><div class="settings-sub">Acc√®s rapide comme une vraie app</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-item">
      <div class="settings-icon" style="background:var(--green-l)">üîí</div>
      <div class="settings-info"><div class="settings-title">Confidentialit√© & donn√©es</div><div class="settings-sub">RGPD ¬∑ HDS certifi√©</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-item" onclick="showToast('Version 1.0.0 ‚Äî Amblyup','blue')">
      <div class="settings-icon" style="background:var(--bg)">‚ÑπÔ∏è</div>
      <div class="settings-info"><div class="settings-title">√Ä propos d'Amblyup</div><div class="settings-sub">Version 1.0.0</div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
  </div>
  <!-- R√âCOMPENSES PARENTALES -->
  <div class="section-title">üéÅ Les r√©compenses</div>
  <div class="card">
    <div style="font-family:'Nunito',sans-serif;font-size:.82rem;color:var(--text-m);font-weight:600;margin-bottom:12px;line-height:1.5;">
      D√©finissez les r√©compenses que Jules gagnera √† chaque badge d√©bloqu√©. C'est facultatif !
    </div>
    <div id="rewards-form"></div>
  </div>
  <div style="height:8px"></div>

</div>

<!-- ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ -->
<nav class="bottom-nav">
  <button class="bnav active" id="bnav-0" onclick="goPage('page-agenda')"><img class="bnav-img" src="calendrier.png" alt="agenda"><span class="bnav-label">Mon agenda</span></button>
  <button class="bnav" id="bnav-1" onclick="goPage('page-progres')"><img class="bnav-img" src="progres.png" alt="progr√®s"><span class="bnav-label">Mes progr√®s</span></button>
  <button class="bnav" id="bnav-2" onclick="goPage('page-docs')"><img class="bnav-img" src="docs.png" alt="docs"><span class="bnav-label">Mes Docs</span></button>
  <button class="bnav" id="bnav-3" onclick="goPage('page-reglages')"><img class="bnav-img" src="reglages.png" alt="r√©glages"><span class="bnav-label">R√©glages</span></button>
</nav>

<!-- CONFETTI -->
<div class="confetti-wrap" id="confetti"></div>

<script>
'use strict';
let swReg = null;
let selectedH = null;
const OBJ = 4;
let calYear = 2026, calMonth = 1;
const CAL_CACHE = {};
const MONTHS_FR = ['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'];
const NEXT_RDV = new Date(2026, 2, 3); // 3 mars 2026
// RDV m√©dicaux √† afficher dans le calendrier
const RDV_DAYS = {
  '2026-3-3':  {icon:'üè•', label:'Orthoptiste'},
  '2026-4-7':  {icon:'üëÅ',  label:'Ophtalmo'},
};

window.addEventListener('load', async () => {
  try {
    if ('serviceWorker' in navigator) {
      // SW uniquement sur HTTPS ou localhost ‚Äî silencieux sinon
      const needsHttps = location.protocol !== 'https:' && location.hostname !== 'localhost';
      if (!needsHttps) {
        try {
          swReg = await navigator.serviceWorker.register('sw.js');
          const waitActive = () => {
            const sw = swReg.installing || swReg.waiting || swReg.active;
            if (!sw) return;
            const activate = () => {
              if (Notification.permission === 'granted') sw.postMessage('SCHEDULE_NOTIFS');
            };
            if (sw.state === 'activated') { activate(); }
            else { sw.addEventListener('statechange', () => { if (sw.state === 'activated') activate(); }); }
          };
          waitActive();
        } catch(e) {
          console.log('Amblyup SW: ' + e.message);
        }
      } else {
        console.log('Amblyup: notifications disponibles apr√®s d√©ploiement HTTPS (Netlify).');
      }
    }

    if ('Notification' in window && Notification.permission === 'default') {
      const b1 = document.getElementById('perm-banner');
      const b2 = document.getElementById('perm-banner-2');
      if (b1) b1.style.display = 'block';
      if (b2) b2.style.display = 'block';
    }

    checkDeepLink();
    initDate();
    buildHoursGrid();
    buildCalendar();
    buildBadgesSection();
    buildRewardsForm();
    buildPending();
    // Show next badge reward if defined
    const rewards = loadRewards();
    const nextIdx = BADGES.findIndex(b => !b.unlocked);
    if (nextIdx !== -1 && rewards[nextIdx]) {
      const el = document.getElementById('next-badge-reward');
      const txt = document.getElementById('next-reward-text');
      if (el && txt) { txt.textContent = rewards[nextIdx]; el.style.display = 'block'; }
    }
    setTimeout(() => { const b = document.getElementById('obs-bar'); if(b) b.style.width = '84%'; }, 400);
  } catch(e) { console.error('Init error:', e); }
});

// demanderPermission d√©finie plus bas avec le syst√®me complet

function goPage(id) {
  const target = document.getElementById(id);
  if (!target) return;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  target.classList.add('active');
  document.querySelectorAll('.bnav').forEach(b => b.classList.remove('active'));
  const map = {'page-agenda':0,'page-progres':1,'page-docs':2,'page-reglages':3};
  const idx = map[id];
  const bnavs = document.querySelectorAll('.bnav');
  if (idx !== undefined && bnavs[idx]) bnavs[idx].classList.add('active');
  try { window.scrollTo(0,0); } catch(e) {}
  try { target.scrollTop = 0; document.documentElement.scrollTop = 0; document.body.scrollTop = 0; } catch(e) {}
}

function initDate() {
  const d = new Date();
  const J = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const M = ['janvier','f√©vrier','mars','avril','mai','juin','juillet','ao√ªt','septembre','octobre','novembre','d√©cembre'];
  const str = J[d.getDay()] + ' ' + d.getDate() + ' ' + M[d.getMonth()] + ' ' + d.getFullYear();
  const el = document.getElementById('hero-date-str');
  if(el) el.textContent = str;
  const el2 = document.getElementById('rappel-date');
  if(el2) el2.textContent = str;
  updateDayBar();
  setInterval(updateDayBar, 60000);
}

function updateDayBar() {
  const now = new Date();
  const startMin = 8*60, endMin = 18*60;
  const nowMin = now.getHours()*60 + now.getMinutes();
  let pct = 0;
  if (nowMin >= startMin && nowMin <= endMin) pct = Math.round((nowMin-startMin)/(endMin-startMin)*100);
  else if (nowMin > endMin) pct = 100;
  const bar = document.getElementById('hero-day-bar');
  const marker = document.getElementById('hero-day-marker');
  const label = document.getElementById('hero-now-label');
  if(bar) setTimeout(()=>{ bar.style.width=pct+'%'; }, 400);
  if(marker) setTimeout(()=>{ marker.style.left=pct+'%'; }, 400);
  if(label) { const hh=now.getHours(),mm=String(now.getMinutes()).padStart(2,'0'); label.textContent=hh+'h'+mm; }
}

// ‚îÄ‚îÄ Prescription : Lun+Mar = OD, Mer+Jeu+Ven = OG, Sam+Dim = pas de cache
// Prochain RDV : 3 mars 2026 ‚Üí on remplit jusqu'au 3 mars inclus

function eyeForDate(date) {
  const dow = date.getDay(); // 0=dim, 1=lun, 2=mar, 3=mer, 4=jeu, 5=ven, 6=sam
  if (dow === 1 || dow === 2) return 'OD';      // lun + mar
  if (dow === 3 || dow === 4 || dow === 5) return 'OG'; // mer + jeu + ven
  return 'none'; // sam + dim
}

function buildDayEntry(year, month, d) {
  const date = new Date(year, month, d);
  const today = new Date(); today.setHours(0,0,0,0);
  date.setHours(0,0,0,0);
  const isToday = date.getTime() === today.getTime();
  const isFuture = date > today;
  const pastRdv = date > NEXT_RDV;

  if (isToday) return {d, s:'today', eye: eyeForDate(date), obs:'?'};
  if (isFuture) {
    // Toujours inclure l'≈ìil pour les jours futurs (affichage du rythme prescrit)
    return {d, s:'future', eye: eyeForDate(date)};
  }
  if (pastRdv) return {d, s:'future', eye: eyeForDate(date)};

  const eye = eyeForDate(date);
  // Observance simul√©e : quelques partiels et un manqu√© pour la d√©mo
  const dateKey = year*10000 + (month+1)*100 + d;
  const partials = [20260204, 20260207, 20260214, 20260218, 20260221];
  const missed   = [20260209];
  const unknown  = [20260219, 20260221, 20260222]; // jours non renseign√©s

  let obs;
  if (unknown.includes(dateKey)) obs = '?';
  else if (missed.includes(dateKey)) obs = 'miss';
  else if (partials.includes(dateKey)) obs = 'partial';
  else obs = 'ok';

  // Statut global de la case
  const s = obs === 'miss' ? 'miss' : obs === 'partial' ? 'partial' : obs === '?' ? 'unknown' : 'ok';
  return {d, s, eye, obs};
}

function generateRichMonth(year, month) {
  const firstDate = new Date(year, month, 1);
  const dow = firstDate.getDay();
  const firstDow = (dow === 0 ? 6 : dow - 1);
  const daysInMonth = new Date(year, month+1, 0).getDate();
  const days = [];
  for (let i = 0; i < firstDow; i++) days.push(null);
  for (let d = 1; d <= daysInMonth; d++) days.push(buildDayEntry(year, month, d));
  // Calcul score (jours pass√©s non-weekend avec obs=ok ou partial)
  const today = new Date(); today.setHours(0,0,0,0);
  let total = 0, ok = 0;
  days.forEach(day => {
    if (!day) return;
    const date = new Date(year, month, day.d); date.setHours(0,0,0,0);
    if (date >= today || day.s === 'future') return;
    if (day.eye === 'none') return; // weekend = pas de prescription
    total++;
    if (day.obs === 'ok') ok++;
    else if (day.obs === 'partial') ok += 0.5;
  });
  const score = total > 0 ? Math.round(ok/total*100) : null;
  return {days, score};
}


function getCalData(year, month) {
  const key = year+'-'+String(month+1).padStart(2,'0');
  if (!CAL_CACHE[key]) CAL_CACHE[key] = generateRichMonth(year, month);
  return CAL_CACHE[key];
}

function buildCalendar() {
  const data = getCalData(calYear, calMonth);
  const label = document.getElementById('cal-month-label');
  if(label) label.textContent = MONTHS_FR[calMonth]+' '+calYear;
  const scoreEl = document.getElementById('cal-score-val');
  if(scoreEl) scoreEl.textContent = data.score != null ? data.score+'%' : '‚Äî';
  const grid = document.getElementById('cal-grid');
  if(!grid) return;
  grid.innerHTML = '';
  data.days.forEach(day => {
    const el = document.createElement('div');
    el.className = 'cday';

    if (!day) {
      el.classList.add('empty');
      grid.appendChild(el); return;
    }

    // Check RDV m√©dical ce jour
    const rdvKey = calYear+'-'+(calMonth+1)+'-'+day.d;
    const rdv = RDV_DAYS[rdvKey];

    if (day.s === 'future') {
      el.classList.add('future');
      if (rdv) { el.style.outline='2.5px solid #F39C12'; el.style.outlineOffset='1px'; el.style.borderRadius='9px'; }

      const eyeLbl = day.eye==='OD' ? 'OD' : day.eye==='OG' ? 'OG' : '';
      const eyeBadgeClass = day.eye==='OD' ? 'eye-badge-od' : day.eye==='OG' ? 'eye-badge-og' : 'eye-badge-pause';

      // Marquer le rythme jusqu'au prochain RDV (3 mars 2026)
      const nextRdvDate = new Date(2026, 2, 3);
      const thisDate = new Date(calYear, calMonth, day.d);
      const isBeforeRdv = thisDate <= nextRdvDate;

      if (isBeforeRdv) {
        const isPauseFut = day.eye === 'none';
        const badgeBg = day.eye==='OD' ? '#4A90D9' : day.eye==='OG' ? '#2EAFAF' : 'transparent';
        const badgeColor = isPauseFut ? '#94A3B8' : 'white';
        const badgeContent = isPauseFut ? '‚òï' : eyeLbl;
        el.innerHTML =
          (rdv ? '<span style="position:absolute;top:2px;left:3px;font-size:.6rem;line-height:1;">'+rdv.icon+'</span>' : '') +
          '<span class="cday-num" style="color:#475569;font-weight:900;">'+day.d+'</span>' +
          (badgeContent ? '<span class="cday-eye-badge" style="background:'+badgeBg+';color:'+badgeColor+';font-size:'+(isPauseFut?'.7':'.42')+'rem;font-weight:900;padding:1px 3px;border-radius:3px;">'+badgeContent+'</span>' : '');
      } else {
        el.innerHTML =
          (rdv ? '<span style="position:absolute;top:2px;left:3px;font-size:.6rem;line-height:1;">'+rdv.icon+'</span>' : '') +
          '<span class="cday-num" style="color:#94A3B8;">'+day.d+'</span>' +
          (eyeLbl ? '<span class="cday-eye-badge '+eyeBadgeClass+'" style="opacity:.45;">'+eyeLbl+'</span>' : '');
      }
      grid.appendChild(el); return;
    }

    // Cases pass√©es = bleu clair uniforme
    el.classList.add('cal-normal');
    if (day.s === 'today') { el.classList.remove('cal-normal'); el.classList.add('today'); }
    if (rdv) { el.style.outline='2.5px solid #F39C12'; el.style.outlineOffset='1px'; }

    const isPause = day.eye === 'none';
    const eyeLabel = day.eye==='OD' ? 'OD' : day.eye==='OG' ? 'OG' : '‚òï';
    const eyeBadgeClass = day.eye==='OD' ? 'eye-badge-od' : day.eye==='OG' ? 'eye-badge-og' : 'eye-badge-pause';
    // Pas de point d'observance les jours pause (pas de cache)
    const dotClass = isPause ? 'dot-none'
      : day.obs==='ok' ? 'dot-ok'
      : day.obs==='partial' ? 'dot-partial'
      : day.obs==='miss' ? 'dot-miss'
      : day.obs==='?' ? 'dot-unknown'
      : 'dot-none';
    const dotContent = (!isPause && day.obs==='?') ? '?' : '';

    el.innerHTML =
      '<div class="cday-obs-dot '+dotClass+'">'+dotContent+'</div>' +
      (rdv ? '<span style="position:absolute;top:2px;left:3px;font-size:.6rem;line-height:1;">'+rdv.icon+'</span>' : '') +
      '<span class="cday-num">'+day.d+'</span>' +
      '<span class="cday-eye-badge '+eyeBadgeClass+'">'+eyeLabel+'</span>';

    el.addEventListener('mouseenter', ()=>el.style.transform='scale(1.08)');
    el.addEventListener('mouseleave', ()=>el.style.transform='');
    grid.appendChild(el);
  });
}

function calPrev() { calMonth--; if(calMonth<0){calMonth=11;calYear--;} buildCalendar(); }
function calNext() { calMonth++; if(calMonth>11){calMonth=0;calYear++;} buildCalendar(); }

function buildHoursGrid() {
  const grid = document.getElementById('hours-grid');
  if(!grid) return;
  for (let h = 0; h <= 7; h++) {
    const btn = document.createElement('button');
    let cls = 'hbtn';
    if (h === 0) cls += ' zero';
    else if (h === OBJ) cls += ' target';
    else if (h > OBJ) cls += ' over';
    btn.className = cls;
    const sub = h === 0 ? 'üòî' : h === OBJ ? '‚≠ê objectif' : h > OBJ ? 'üèÜ super !' : (h===1?'heure':'heures');
    btn.innerHTML = h + 'h<span class="hbtn-sub">' + sub + '</span>';
    btn.onclick = () => selectHeure(btn, h);
    grid.appendChild(btn);
  }
}

function selectHeure(btn, h) {
  document.querySelectorAll('.hbtn').forEach(b => b.classList.remove('sel'));
  btn.classList.add('sel');
  selectedH = h;
  const vbtn = document.getElementById('valider-btn');
  vbtn.disabled = false;
  if (h >= OBJ) {
    vbtn.style.background = 'var(--green)';
    vbtn.textContent = h > OBJ ? 'üèÜ Valider ‚Äî Super Jules !' : '‚≠ê Valider ‚Äî Objectif atteint !';
  } else if (h === 0) {
    vbtn.style.background = 'var(--red)';
    vbtn.textContent = 'Valider üòî';
  } else {
    vbtn.style.background = 'var(--blue)';
    vbtn.textContent = 'Valider ‚úì';
  }
}

function validerSaisie() {
  if (selectedH === null) return;
  const h = selectedH;
  document.getElementById('saisie-form').style.display = 'none';
  document.getElementById('congrats-box').style.display = 'block';
  document.getElementById('saisie-card').classList.add('done');
  if (h >= OBJ) {
    document.getElementById('c-emoji').textContent = h > OBJ ? 'üèÜ' : 'üéâ';
    document.getElementById('c-title').textContent = h > OBJ ? 'üèÜ ' + h + 'h, incroyable Jules !' : 'üéâ Bravo Jules !';
    document.getElementById('c-sub').textContent = "C'est excellent ! Continue comme √ßa üí™";
    document.getElementById('mascot').textContent = h > OBJ ? 'üëë' : 'üèÜ';
    lancerConfetti();
  } else if (h === 0) {
    document.getElementById('c-emoji').textContent = 'üòî';
    document.getElementById('c-title').textContent = 'Pas de cache aujourd\'hui...';
    document.getElementById('c-sub').textContent = "N'oublie pas demain ! Tu peux le faire üí™";
  } else {
    document.getElementById('c-emoji').textContent = 'üëç';
    document.getElementById('c-title').textContent = 'üëç ' + h + 'h enregistr√©es !';
    document.getElementById('c-sub').textContent = "Bonne journ√©e, on continue demain !";
    document.getElementById('mascot').textContent = 'üí™';
  }
}


const PENDING = [
  {d:23, label:"Aujourd'hui", dayLabel:'Lun 23 f√©v', month:'F√©v', isToday:true,  eye:'OD', defaultStart:8,  defaultEnd:18},
  {d:19, label:'Jeu 19 f√©v',  dayLabel:'Jeu 19 f√©v',  month:'F√©v', isToday:false, eye:'OD', defaultStart:8,  defaultEnd:18},
  {d:21, label:'Sam 21 f√©v',  dayLabel:'Sam 21 f√©v',  month:'F√©v', isToday:false, eye:'OG', defaultStart:8,  defaultEnd:18},
];
let pendingDone = 0;
// Store per-item state: {start, end, validated}
const piState = PENDING.map(d => ({start: d.defaultStart, end: d.defaultEnd, validated: false}));

function hToPos(h) { return ((h - 6) / 16) * 100; } // 6h‚Üí22h = 16h range
function posToH(pct) { return Math.round(pct / 100 * 16 + 6); }
function fmtH(h) { return h + 'h00'; }

function buildPending() {
  const list = document.getElementById('pending-list');
  if(!list) return;
  const now = new Date();
  const after18 = now.getHours() >= 18;

  PENDING.forEach((day, i) => {
    const isLocked = day.isToday && !after18;
    const eyeColor = '#4A90D9';
  const eyeBg    = '#EBF4FB';
    const el = document.createElement('div');
    el.id = 'pi-' + i;
    el.style.cssText = 'border-radius:16px;border:2px solid '+eyeColor+'33;padding:14px;margin-bottom:10px;background:'+eyeBg+';transition:opacity .4s,transform .4s;';

    // Header row
    const hdr = document.createElement('div');
    hdr.style.cssText = 'display:flex;align-items:center;gap:10px;margin-bottom:12px;';
    hdr.innerHTML =
      '<div style="width:44px;height:48px;border-radius:12px;background:'+eyeColor+';display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;">' +
        '<span style="font-family:Nunito,sans-serif;font-weight:900;font-size:'+(day.isToday?'1.2':'1')+'rem;color:white;line-height:1;">'+(day.isToday?'üìÖ':day.d)+'</span>' +
        (day.isToday ? '' : '<span style="font-size:.55rem;font-weight:700;color:rgba(255,255,255,.85);text-transform:uppercase;">'+day.month+'</span>') +
      '</div>' +
      '<div style="flex:1;">' +
        '<div style="font-family:Nunito,sans-serif;font-weight:900;font-size:.9rem;color:'+eyeColor+';">'+day.label+'</div>' +
        '<div style="font-size:.72rem;color:#64748B;margin-top:2px;">Cache '+day.eye+' ¬∑ objectif 8h‚Üí18h</div>' +
        (isLocked ? '<div style="font-size:.68rem;color:#F39C12;font-weight:700;margin-top:3px;">üîí Renseignement disponible apr√®s 18h</div>' : '') +
      '</div>';
    el.appendChild(hdr);

    if (!isLocked) {
      // Duration badge
      const durDiv = document.createElement('div');
      durDiv.id = 'pi-dur-'+i;
      durDiv.style.cssText = 'text-align:center;margin-bottom:10px;';
      durDiv.innerHTML = '<span style="font-family:Nunito,sans-serif;font-size:1.4rem;font-weight:900;color:'+eyeColor+';">'+
        (piState[i].end - piState[i].start)+'h port√©es</span>' +
        '<span style="font-size:.75rem;color:#64748B;margin-left:8px;">'+fmtH(piState[i].start)+' ‚Üí '+fmtH(piState[i].end)+'</span>';
      el.appendChild(durDiv);

      // Range slider track
      const trackWrap = document.createElement('div');
      trackWrap.style.cssText = 'position:relative;height:44px;margin:0 8px 6px;user-select:none;';
      trackWrap.innerHTML = `
        <!-- Track bg -->
        <div style="position:absolute;top:50%;left:0;right:0;height:10px;border-radius:5px;background:#CBD5E1;transform:translateY(-50%);"></div>
        <!-- Filled zone -->
        <div id="pi-fill-${i}" style="position:absolute;top:50%;height:10px;border-radius:5px;background:${eyeColor};transform:translateY(-50%);transition:left .05s,width .05s;pointer-events:none;"></div>
        <!-- Trait objectif 8h -->
        <div style="position:absolute;top:8px;height:26px;width:2.5px;border-radius:2px;background:#27AE60;left:${hToPos(8)}%;transform:translateX(-50%);pointer-events:none;" title="Objectif d√©but 8h">
          <span style="position:absolute;top:28px;left:50%;transform:translateX(-50%);font-size:.48rem;font-weight:800;color:#27AE60;white-space:nowrap;">8h</span>
        </div>
        <!-- Trait objectif 18h -->
        <div style="position:absolute;top:8px;height:26px;width:2.5px;border-radius:2px;background:#27AE60;left:${hToPos(18)}%;transform:translateX(-50%);pointer-events:none;" title="Objectif fin 18h">
          <span style="position:absolute;top:28px;left:50%;transform:translateX(-50%);font-size:.48rem;font-weight:800;color:#27AE60;white-space:nowrap;">18h</span>
        </div>
        <!-- Handle start -->
        <div id="pi-hs-${i}" data-pi="${i}" data-side="start"
          style="position:absolute;top:50%;width:26px;height:26px;border-radius:50%;background:white;border:3px solid ${eyeColor};box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;">
          <span style="font-size:.5rem;font-weight:900;color:${eyeColor};">‚ñ∂</span>
        </div>
        <!-- Handle end -->
        <div id="pi-he-${i}" data-pi="${i}" data-side="end"
          style="position:absolute;top:50%;width:26px;height:26px;border-radius:50%;background:white;border:3px solid ${eyeColor};box-shadow:0 2px 8px rgba(0,0,0,.2);transform:translate(-50%,-50%);cursor:grab;touch-action:none;z-index:2;display:flex;align-items:center;justify-content:center;">
          <span style="font-size:.5rem;font-weight:900;color:${eyeColor};">‚óÄ</span>
        </div>
        <!-- Labels min/max -->
        <div style="position:absolute;top:-14px;left:0;font-size:.52rem;color:#94A3B8;font-weight:700;">6h</div>
        <div style="position:absolute;top:-14px;right:0;font-size:.52rem;color:#94A3B8;font-weight:700;">22h</div>
      `;
      el.appendChild(trackWrap);

      // Validate button
      const valBtn = document.createElement('button');
      valBtn.id = 'pi-vbtn-'+i;
      valBtn.style.cssText = 'width:100%;padding:12px;border-radius:12px;border:none;background:'+eyeColor+';color:white;font-family:Nunito,sans-serif;font-weight:900;font-size:.9rem;cursor:pointer;margin-top:8px;transition:opacity .2s;';
      valBtn.textContent = '‚úì Valider ce jour';
      valBtn.onclick = () => validatePiDay(i);
      el.appendChild(valBtn);

      // Congrats box (hidden)
      const cbox = document.createElement('div');
      cbox.id = 'pi-cbox-'+i;
      cbox.style.cssText = 'display:none;text-align:center;padding:12px 0 4px;';
      el.appendChild(cbox);
    }

    list.appendChild(el);
    if (!isLocked) {
      updatePiSlider(i);
      initPiDrag(i);
    }
  });
}

function updatePiSlider(i) {
  const s = piState[i].start, e = piState[i].end;
  const sp = hToPos(s), ep = hToPos(e);
  const hs = document.getElementById('pi-hs-'+i);
  const he = document.getElementById('pi-he-'+i);
  const fill = document.getElementById('pi-fill-'+i);
  const dur = document.getElementById('pi-dur-'+i);
  if (hs) hs.style.left = sp+'%';
  if (he) he.style.left = ep+'%';
  if (fill) { fill.style.left = sp+'%'; fill.style.width = (ep-sp)+'%'; }
  if (dur) {
    const hours = e - s;
    const OBJ_S = 8, OBJ_E = 18;
    const covered = Math.max(0, Math.min(e, OBJ_E) - Math.max(s, OBJ_S));
    const pct = Math.round(covered / (OBJ_E - OBJ_S) * 100);
    let col = hours >= (OBJ_E-OBJ_S) ? '#27AE60' : hours >= 5 ? '#F39C12' : '#E74C3C';
    dur.innerHTML = '<span style="font-family:Nunito,sans-serif;font-size:1.4rem;font-weight:900;color:'+col+';">'+hours+'h port√©es</span>'+
      '<span style="font-size:.75rem;color:#64748B;margin-left:8px;">'+fmtH(s)+' ‚Üí '+fmtH(e)+'</span>'+
      '<div style="font-size:.7rem;color:'+col+';font-weight:700;margin-top:2px;">'+pct+'% de l\'objectif couvert</div>';
  }
}

function initPiDrag(i) {
  ['pi-hs-'+i, 'pi-he-'+i].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const side = el.dataset.side;
    let dragging = false;

    const getTrack = () => el.closest('div[style*="position:relative"]') ||
      el.parentElement;

    const handleMove = (clientX) => {
      const track = el.parentElement;
      const rect = track.getBoundingClientRect();
      let pct = Math.max(0, Math.min(100, (clientX - rect.left) / rect.width * 100));
      let h = posToH(pct);
      h = Math.max(6, Math.min(22, h));
      if (side === 'start') {
        piState[i].start = Math.min(h, piState[i].end - 1);
      } else {
        piState[i].end = Math.max(h, piState[i].start + 1);
      }
      updatePiSlider(i);
    };

    // Mouse
    el.addEventListener('mousedown', (ev) => { dragging = true; ev.preventDefault(); });
    document.addEventListener('mousemove', (ev) => { if (dragging) handleMove(ev.clientX); });
    document.addEventListener('mouseup', () => { dragging = false; });

    // Touch
    el.addEventListener('touchstart', (ev) => { dragging = true; ev.preventDefault(); }, {passive:false});
    document.addEventListener('touchmove', (ev) => { if (dragging) handleMove(ev.touches[0].clientX); }, {passive:true});
    document.addEventListener('touchend', () => { dragging = false; });
  });
}

function validatePiDay(i) {
  const s = piState[i].start, e = piState[i].end;
  const hours = e - s;
  const OBJ_HOURS = 10; // objectif 8h‚Üí18h = 10h
  const cbox = document.getElementById('pi-cbox-'+i);
  const vbtn = document.getElementById('pi-vbtn-'+i);
  const durDiv = document.getElementById('pi-dur-'+i);
  const day = PENDING[i];
  const eyeColor = day.eye === 'OD' ? '#4A90D9' : '#3ABFBF';

  if (vbtn) vbtn.style.display = 'none';
  if (durDiv) durDiv.style.display = 'none';
  // Hide slider
  const track = document.querySelector('#pi-hs-'+i)?.parentElement;
  if (track) track.style.display = 'none';

  let emoji, title, sub, doConfetti;
  if (hours >= OBJ_HOURS) {
    emoji='üèÜ'; title='Objectif atteint !'; sub='Bravo Jules, '+hours+'h port√©es ! Continue comme √ßa üí™'; doConfetti=true;
  } else if (hours >= OBJ_HOURS * 0.7) {
    emoji='üëç'; title='Bonne journ√©e !'; sub=hours+'h port√©es ¬∑ presque l\'objectif, c\'est bien ! üòä'; doConfetti=false;
  } else if (hours > 0) {
    emoji='üí™'; title='C\'est un d√©but !'; sub=hours+'h port√©es ¬∑ on peut faire mieux, courage !'; doConfetti=false;
  } else {
    emoji='üòî'; title='Pas de cache ce jour‚Ä¶'; sub='Pas grave, on rattrape demain ! üíô'; doConfetti=false;
  }

  if (cbox) {
    cbox.style.display = 'block';
    cbox.innerHTML =
      '<div style="font-size:2.2rem;margin-bottom:6px;">'+emoji+'</div>'+
      '<div style="font-family:Nunito,sans-serif;font-weight:900;font-size:1rem;color:'+eyeColor+';">'+title+'</div>'+
      '<div style="font-size:.8rem;color:#64748B;margin-top:4px;margin-bottom:10px;">'+sub+'</div>'+
      '<button onclick="resolvePi('+i+')" style="padding:8px 20px;border-radius:10px;border:none;background:'+eyeColor+';color:white;font-family:Nunito,sans-serif;font-weight:800;font-size:.8rem;cursor:pointer;">OK ‚úì</button>';
  }
  if (doConfetti) lancerConfetti();
  piState[i].validated = true;
}

function resolvePi(i) {
  const el = document.getElementById('pi-'+i);
  if (el) { el.style.opacity='0'; el.style.transform='translateX(20px)'; }
  pendingDone++;
  setTimeout(() => {
    if (el) el.remove();
    if (pendingDone >= PENDING.length) {
      const sec = document.getElementById('pending-section');
      if (sec) sec.style.display='none';
    }
  }, 400);
}

function togglePi(i) { /* legacy compat */ }
function buildPiGrid(i) { /* legacy compat */ }

// BADGES ‚Äî 1 badge tous les 10 √©toiles (1 √©toile/jour si observance > 80%)
const TOTAL_STARS = 47; // √©toiles actuelles Jules
const STARS_PER_BADGE = 10;
const BADGES = [
  {icon:'üå±',name:'Courageux',    desc:'10 √©toiles',  stars:10,  unlocked:true},
  {icon:'üí™',name:'Pers√©v√©rant', desc:'20 √©toiles',  stars:20,  unlocked:true},
  {icon:'üéØ',name:'D√©termin√©',   desc:'30 √©toiles',  stars:30,  unlocked:true},
  {icon:'üèÖ',name:'Champion',    desc:'40 √©toiles',  stars:40,  unlocked:true},
  {icon:'‚≠ê',name:'H√©ros',        desc:'50 √©toiles',  stars:50,  unlocked:false},
  {icon:'ü¶∏',name:'Super-H√©ros', desc:'60 √©toiles',  stars:60,  unlocked:false},
  {icon:'üî¨',name:'Expert',       desc:'70 √©toiles',  stars:70,  unlocked:false},
  {icon:'üéì',name:'Ma√Ætre',       desc:'80 √©toiles',  stars:80,  unlocked:false},
  {icon:'üëë',name:'Grand Ma√Ætre', desc:'90 √©toiles',  stars:90,  unlocked:false},
  {icon:'üåü',name:'L√©gende',      desc:'100 √©toiles', stars:100, unlocked:false},
];

// R√©compenses parentales (stock√©es localement)
function loadRewards() {
  try { return JSON.parse(localStorage.getItem('amblyup_rewards') || '{}'); } catch(e) { return {}; }
}
function saveReward(idx, text) {
  const r = loadRewards(); r[idx] = text;
  try { localStorage.setItem('amblyup_rewards', JSON.stringify(r)); } catch(e) {}
}

function buildStars(id, total, max) { /* legacy */ }

function buildBadgesSection() {
  const wrap = document.getElementById('badges-section'); if(!wrap) return;
  const stars = TOTAL_STARS;
  const currentBadgeIdx = BADGES.filter(b => b.unlocked).length - 1;
  const nextBadge = BADGES.find(b => !b.unlocked);
  const starsInLevel = stars % STARS_PER_BADGE || STARS_PER_BADGE;
  const starsToNext = nextBadge ? (nextBadge.stars - stars) : 0;
  const rewards = loadRewards();

  // Grande √©toile centrale
  let html = '<div style="text-align:center;padding:8px 0 4px;">' +
    '<div style="font-size:3rem;font-weight:900;font-family:Nunito,sans-serif;color:#F39C12;line-height:1;">'+stars+' ‚≠ê</div>' +
    '<div style="font-size:.8rem;color:#64748B;font-weight:600;margin-top:4px;">gagn√©</div>';

  if (nextBadge) {
    html += '<div style="font-size:.78rem;color:#4A90D9;font-weight:700;margin-top:10px;background:#EBF4FB;border-radius:10px;padding:8px 12px;">' +
      '‚≠ê Plus que <strong>'+starsToNext+' √©toile'+(starsToNext>1?'s':'')+'</strong> avant le badge <strong>'+nextBadge.name+' '+nextBadge.icon+'</strong></div>';
  }
  html += '</div>';

  // S√©parateur
  html += '<div style="border-top:1px solid #E8F0F8;margin:14px 0 10px;"></div>';

  // Titre badges
  html += '<div style="font-family:Nunito,sans-serif;font-size:.7rem;font-weight:800;text-transform:uppercase;letter-spacing:.1em;color:#94A3B8;margin-bottom:10px;">Mes badges</div>';

  // Liste badges
  BADGES.forEach((b, i) => {
    const reward = rewards[i] || '';
    if (b.unlocked) {
      html += '<div style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:14px;background:linear-gradient(135deg,#EBF4FB,#E8F8F4);border:1.5px solid #4A90D933;margin-bottom:8px;">' +
        '<div style="font-size:1.8rem;flex-shrink:0;">'+b.icon+'</div>' +
        '<div style="flex:1;">' +
          '<div style="font-family:Nunito,sans-serif;font-weight:900;font-size:.9rem;color:#2E6DB4;">'+b.name+'</div>' +
          '<div style="font-size:.7rem;color:#64748B;margin-top:1px;">'+b.desc+' ¬∑ ‚úì Obtenu</div>' +
          (reward ? '<div style="font-size:.72rem;color:#27AE60;font-weight:700;margin-top:4px;">üéÅ R√©compense : '+reward+'</div>' : '') +
        '</div>' +
        '<div style="font-size:1rem;color:#27AE60;font-weight:900;">‚úì</div>' +
      '</div>';
    } else if (i <= currentBadgeIdx + 5) {
      // Afficher les 5 prochains non d√©bloqu√©s
      html += '<div style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:14px;background:#F8FAFC;border:1.5px dashed #CBD5E1;margin-bottom:8px;opacity:.75;">' +
        '<div style="font-size:1.8rem;flex-shrink:0;filter:grayscale(80%);">'+b.icon+'</div>' +
        '<div style="flex:1;">' +
          '<div style="font-family:Nunito,sans-serif;font-weight:800;font-size:.9rem;color:#64748B;">'+b.name+'</div>' +
          '<div style="font-size:.7rem;color:#94A3B8;margin-top:1px;">'+b.desc+' ¬∑ üîí √Ä d√©bloquer</div>' +
          (reward ? '<div style="font-size:.72rem;color:#F39C12;font-weight:700;margin-top:4px;">üéÅ R√©compense pr√©vue : '+reward+'</div>' : '') +
        '</div>' +
        '<div style="font-size:1rem;color:#CBD5E1;">üîí</div>' +
      '</div>';
    }
  });

  wrap.innerHTML = html;
}

function buildBadgesGrid() { buildBadgesSection(); }
function buildBadgesList(id) { /* merged into buildBadgesSection */ }

// DOCS accordion
function toggleDoc(el) {
  const isOpen = el.classList.contains('open');
  document.querySelectorAll('.doc-item.open').forEach(d => d.classList.remove('open'));
  if (!isOpen) el.classList.add('open');
}

function toggleKit(el) {
  el.classList.toggle('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS ‚Äî syst√®me complet 7h55 + 18h00
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Ouvre la section "Jours √† compl√©ter" et scroll dessus
function openPendingSection() {
  goPage('page-agenda');
  setTimeout(() => {
    const el = document.getElementById('pending-section');
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 200);
}

// Deep link au chargement si ouvert depuis notif soir
function checkDeepLink() {
  if (window.location.search.includes('open=pending') ||
      window.location.hash === '#pending') {
    setTimeout(() => openPendingSection(), 600);
  }
}

// R√©ception du message du SW (app d√©j√† ouverte + notif soir cliqu√©e)
navigator.serviceWorker && navigator.serviceWorker.addEventListener('message', event => {
  if (event.data && event.data.action === 'OPEN_PENDING') {
    openPendingSection();
  }
});

async function demanderPermission() {
  if (!('Notification' in window)) {
    showToast('‚ö†Ô∏è Notifications non support√©es', 'orange'); return false;
  }
  const result = await Notification.requestPermission();
  const b1 = document.getElementById('perm-banner');
  const b2 = document.getElementById('perm-banner-2');
  if (result === 'granted') {
    if (b1) b1.style.display = 'none';
    if (b2) b2.style.display = 'none';
    showToast('üîî Notifications activ√©es !', 'blue');
    // Demande au SW de programmer les alarmes r√©elles
    if (swReg && swReg.active) {
      swReg.active.postMessage('SCHEDULE_NOTIFS');
    }
    return true;
  } else {
    showToast('‚ö†Ô∏è Permission refus√©e', 'orange'); return false;
  }
}

// Bouton test avec compte √† rebours ‚Äî utilise le SW pour coller au vrai flux
function envoyerNotifDelai(type, btn) {
  let secs = 5;
  const originalHTML = btn.querySelector('span:last-child').innerHTML;
  btn.disabled = true; btn.style.opacity = '.7';
  btn.querySelector('span:last-child').innerHTML =
    'Envoi dans <strong>' + secs + 's</strong>‚Ä¶<br>' +
    '<span style="font-size:.75rem;opacity:.85;font-weight:500">Prends ton t√©l√©phone !</span>';
  const iv = setInterval(() => {
    secs--;
    if (secs > 0) {
      btn.querySelector('span:last-child').innerHTML =
        'Envoi dans <strong>' + secs + 's</strong>‚Ä¶<br>' +
        '<span style="font-size:.75rem;opacity:.85;font-weight:500">Prends ton t√©l√©phone !</span>';
    } else {
      clearInterval(iv);
      btn.querySelector('span:last-child').innerHTML = originalHTML;
      btn.disabled = false; btn.style.opacity = '1';
      envoyerNotifTest(type);
    }
  }, 1000);
}

async function envoyerNotifTest(type) {
  const statusEl = document.getElementById('notif-status');

  // V√©rifie/demande permission
  if (!('Notification' in window)) {
    showToast('‚ö†Ô∏è Non support√©', 'orange'); return;
  }
  if (Notification.permission !== 'granted') {
    const ok = await demanderPermission();
    if (!ok) return;
  }

  try {
    if (swReg && swReg.active) {
      // Passe par le SW ‚Üí m√™me flux que la vraie notification
      swReg.active.postMessage(type === 'cache' ? 'TEST_MATIN' : 'TEST_SOIR');
    } else {
      // Fallback direct (hors SW)
      const msg = type === 'cache'
        ? { title: 'üè¥‚Äç‚ò†Ô∏è Cache-≈ìil de Jules ! [TEST]', body: 'Mets le cache maintenant !' }
        : { title: 'üéâ Bravo Jules ! [TEST]', body: "Retire le cache et remplis ton rythme !" };
      new Notification(msg.title, { body: msg.body, icon: 'amblyup-logo.png' });
    }
    if (statusEl) {
      statusEl.innerHTML = '‚úÖ Notification envoy√©e !';
      statusEl.style.background = 'var(--green-l)';
      statusEl.style.color = 'var(--green-d)';
    }
  } catch(e) {
    if (statusEl) statusEl.innerHTML = '‚ùå ' + e.message;
  }
  setTimeout(() => {
    if (statusEl) {
      statusEl.innerHTML = 'üí§ En attente';
      statusEl.style.background = '';
      statusEl.style.color = '';
    }
  }, 4000);
}

// Alias pour compatibilit√© boutons existants
async function envoyerNotif(type) { return envoyerNotifTest(type); }

// CONFETTI
function lancerConfetti() {
  const wrap = document.getElementById('confetti');
  wrap.classList.add('show'); wrap.innerHTML = '';
  const colors = ['#4A90D9','#5BBF8E','#F9A825','#E74C3C','#C8E4FA','#2E6DB4'];
  for (let i = 0; i < 70; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.cssText = 'left:'+Math.random()*100+'%;top:'+(-Math.random()*30)+'px;background:'+colors[~~(Math.random()*colors.length)]+';width:'+(6+Math.random()*8)+'px;height:'+(6+Math.random()*8)+'px;border-radius:'+(Math.random()>.5?'50%':'2px')+';--dur:'+(1+Math.random()*1.2)+'s;--delay:'+(Math.random()*.8)+'s';
    wrap.appendChild(el);
  }
  setTimeout(() => { wrap.classList.remove('show'); wrap.innerHTML=''; }, 3000);
}

// R√âCOMPENSES PARENTALES
function buildRewardsForm() {
  const wrap = document.getElementById('rewards-form'); if(!wrap) return;
  const rewards = loadRewards();
  const currentBadgeIdx = BADGES.filter(b=>b.unlocked).length - 1;
  let html = '';
  for (let i = currentBadgeIdx; i < Math.min(currentBadgeIdx + 7, BADGES.length); i++) {
    const b = BADGES[i];
    if (!b) continue;
    const val = rewards[i] || '';
    const isNext = (i === currentBadgeIdx + 1);
    html += '<div style="margin-bottom:12px;">' +
      '<label style="display:flex;align-items:center;gap:8px;font-family:Nunito,sans-serif;font-weight:800;font-size:.82rem;color:var(--text);margin-bottom:5px;">' +
        '<span style="font-size:1.2rem;">'+b.icon+'</span>' +
        '<span>'+b.name+'</span>' +
        (isNext ? '<span style="font-size:.65rem;background:var(--blue);color:white;border-radius:6px;padding:1px 6px;font-weight:700;">Prochain</span>' : '') +
        '<span style="font-size:.65rem;color:var(--text-m);font-weight:600;">'+b.desc+'</span>' +
      '</label>' +
      '<input type="text" placeholder="Ex: sortie cin√©, jouet surprise‚Ä¶ (facultatif)" value="'+val+'" '+
        'data-idx="'+i+'" '+
        'oninput="saveReward(this.dataset.idx, this.value); buildBadgesSection();" '+
        'style="width:100%;box-sizing:border-box;padding:10px 12px;border-radius:10px;border:1.5px solid var(--border);font-family:Nunito,sans-serif;font-size:.8rem;font-weight:600;color:var(--text);background:var(--bg);outline:none;" '+
        'onfocus="this.style.borderColor=\'var(--blue)\'" onblur="this.style.borderColor=\'var(--border)\'">' +
    '</div>';
  }
  wrap.innerHTML = html;
}


// TOAST
function showToast(msg, color) {
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:var(--'+color+');color:white;padding:10px 18px;border-radius:12px;font-size:.82rem;font-weight:700;z-index:9999;box-shadow:0 6px 20px rgba(0,0,0,.15);font-family:Nunito,sans-serif;white-space:nowrap;animation:fadeUp .3s ease;';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2500);
}

function activateVtab(el) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
</script>
</body>
</html>
