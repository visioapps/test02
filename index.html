<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4A90D9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Mon ≈íil">
<link rel="manifest" href="manifest.json">
<title>Jules üëÅ ‚Äî Mon Cache</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PALETTE ‚Äî identique √† la page observance
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  --blue:       #4A90D9;
  --blue-light: #EAF4FF;
  --blue-mid:   #C8E4FA;
  --blue-dark:  #2E6DB4;
  --green:      #5BBF8E;
  --green-light:#E8F7F1;
  --green-dark: #3A8F68;
  --orange:     #F9A825;
  --orange-light:#FFF8E1;
  --orange-dark: #E65100;
  --red:        #E74C3C;
  --red-light:  #FDEDEC;
  --text:       #2C3E50;
  --text-mid:   #7F8C8D;
  --text-light: #BDC3C7;
  --white:      #FFFFFF;
  --bg:         #F4F9FF;
  --border:     #C8E4FA;
  --radius:     20px;
  --shadow:     0 4px 20px rgba(74,144,217,0.12);
  --shadow-lg:  0 8px 30px rgba(74,144,217,0.22);
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html { scroll-behavior:smooth; }

body {
  font-family: 'Quicksand', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  padding-bottom: 84px;
}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page { display:none; }
.page.active { display:block; animation: fadeUp 0.4s ease; }

@keyframes fadeUp   { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:none} }
@keyframes fadeDown { from{opacity:0;transform:translateY(-14px)} to{opacity:1;transform:none} }
@keyframes bounce   { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
@keyframes popIn    { 0%{transform:scale(0)} 80%{transform:scale(1.2)} 100%{transform:scale(1)} }
@keyframes spin     { to{transform:rotate(360deg)} }

/* ‚îÄ‚îÄ HEADER GLOBAL ‚îÄ‚îÄ */
.app-header {
  padding: 20px 16px 0;
  display: flex; align-items:center; justify-content:space-between;
}
.logo {
  display:flex; align-items:center; gap:8px;
  font-family:'Nunito',sans-serif; font-weight:900; font-size:1.1rem; color:var(--text);
}
.logo-eye {
  width:34px; height:34px; border-radius:50%;
  background: var(--blue);
  display:flex; align-items:center; justify-content:center;
  font-size:1rem; box-shadow:0 4px 12px rgba(74,144,217,.3);
}
.notif-btn {
  width:38px; height:38px; border-radius:12px;
  background:var(--white); border:1.5px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  font-size:1.1rem; cursor:pointer; position:relative;
  box-shadow:var(--shadow);
}
.notif-dot {
  position:absolute; top:6px; right:6px;
  width:8px; height:8px; background:var(--red);
  border-radius:50%; border:2px solid var(--white);
}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card {
  background:var(--white);
  border-radius:var(--radius);
  padding:20px;
  margin:12px 16px 0;
  box-shadow:var(--shadow);
}
.card-title {
  font-family:'Nunito',sans-serif;
  font-size:.72rem; font-weight:800;
  text-transform:uppercase; letter-spacing:.12em;
  color:var(--text-mid);
  margin-bottom:14px;
}

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.section-title {
  font-family:'Nunito',sans-serif;
  font-size:.72rem; font-weight:800;
  text-transform:uppercase; letter-spacing:.12em;
  color:var(--text-mid);
  padding:16px 16px 6px;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  margin:14px 16px 0;
  background:var(--blue);
  border-radius:var(--radius);
  padding:20px;
  color:white;
  position:relative; overflow:hidden;
  box-shadow: 0 8px 28px rgba(74,144,217,.35);
}
.hero::before {
  content:''; position:absolute;
  top:-30px; right:-30px;
  width:110px; height:110px;
  background:rgba(255,255,255,.12); border-radius:50%;
}
.hero::after {
  content:''; position:absolute;
  bottom:-20px; left:20px;
  width:70px; height:70px;
  background:rgba(255,255,255,.08); border-radius:50%;
}
.hero-top {
  display:flex; align-items:flex-start; justify-content:space-between;
  margin-bottom:16px; position:relative; z-index:1;
}
.hero-greeting {
  font-size:.72rem; font-weight:700;
  opacity:.85; text-transform:uppercase; letter-spacing:.5px;
}
.hero-name {
  font-family:'Nunito',sans-serif;
  font-size:1.3rem; font-weight:900; margin-top:2px;
}
.hero-mascot {
  font-size:2.6rem;
  animation:bounce 2.5s ease-in-out infinite;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,.2));
}
.hero-stats {
  display:grid; grid-template-columns:1fr 1fr 1fr;
  gap:8px; position:relative; z-index:1;
}
.hstat {
  background:rgba(255,255,255,.2);
  border-radius:14px; padding:10px 8px; text-align:center;
}
.hstat-val {
  font-family:'Nunito',sans-serif;
  font-size:1.15rem; font-weight:900; line-height:1;
}
.hstat-label { font-size:.6rem; font-weight:600; opacity:.85; margin-top:3px; }

/* ‚îÄ‚îÄ PERMISSION BANNER ‚îÄ‚îÄ */
.perm-banner {
  background:var(--orange-light);
  border:2px solid var(--orange);
  border-radius:14px;
  padding:14px 16px;
  margin:12px 16px 0;
  display:none;
  animation:fadeUp .4s ease;
}
.perm-banner p { font-size:.85rem; color:var(--text); font-weight:600; }
.perm-banner button {
  margin-top:8px;
  background:var(--orange); color:white; border:none;
  border-radius:10px; padding:8px 16px;
  font-family:'Nunito',sans-serif; font-weight:700;
  cursor:pointer; font-size:.85rem;
  display:flex; align-items:center; gap:6px;
}
.perm-banner button:active { transform:scale(.96); }

/* ‚îÄ‚îÄ INSTRUCTION DU JOUR ‚îÄ‚îÄ */
.instruction-card {
  margin:12px 16px 0;
  background:var(--white);
  border:2px solid var(--blue);
  border-radius:var(--radius);
  padding:16px;
  display:flex; align-items:center; gap:14px;
  box-shadow:var(--shadow);
}
.instr-icon {
  width:48px; height:48px; border-radius:14px;
  background:var(--blue-light);
  display:flex; align-items:center; justify-content:center;
  font-size:1.6rem; flex-shrink:0;
}
.instr-body { flex:1; }
.instr-title {
  font-family:'Nunito',sans-serif;
  font-weight:800; font-size:.95rem; color:var(--text);
}
.instr-detail { font-size:.78rem; color:var(--text-mid); margin-top:4px; }
.instr-detail strong { color:var(--blue); font-weight:700; }
.instr-badge {
  background:var(--blue); border-radius:12px;
  padding:8px 12px; color:white; text-align:center; flex-shrink:0;
}
.instr-dur {
  font-family:'Nunito',sans-serif;
  font-weight:900; font-size:1.3rem; line-height:1;
}
.instr-dur-sub { font-size:.6rem; font-weight:700; opacity:.9; }

/* ‚îÄ‚îÄ JOURS EN ATTENTE ‚îÄ‚îÄ */
.pending-section { margin:0 16px; }
.pending-header {
  font-family:'Nunito',sans-serif;
  font-size:.72rem; font-weight:800;
  text-transform:uppercase; letter-spacing:.1em;
  color:var(--orange-dark);
  padding:14px 0 6px;
}
.pending-item {
  background:var(--white);
  border-radius:16px;
  border:2px solid var(--orange-light);
  padding:12px 14px;
  display:flex; align-items:center; gap:12px;
  margin-bottom:8px;
  box-shadow:var(--shadow);
  flex-wrap:wrap;
  transition:opacity .4s, transform .4s;
}
.pending-date-box {
  width:44px; height:48px; border-radius:12px;
  background:var(--orange-light); border:2px solid var(--orange);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  flex-shrink:0;
}
.pending-day { font-family:'Nunito',sans-serif; font-weight:900; font-size:1.1rem; color:var(--orange-dark); line-height:1; }
.pending-month { font-family:'Nunito',sans-serif; font-weight:700; font-size:.6rem; color:var(--orange-dark); text-transform:uppercase; }
.pending-info { flex:1; }
.pending-name { font-family:'Nunito',sans-serif; font-weight:800; font-size:.85rem; }
.pending-sub { font-size:.72rem; color:var(--text-mid); margin-top:2px; }
.pending-btn {
  padding:6px 12px; border-radius:10px;
  background:var(--blue-light); border:1.5px solid var(--blue);
  color:var(--blue); font-family:'Nunito',sans-serif;
  font-weight:700; font-size:.74rem; cursor:pointer;
  transition:all .15s; white-space:nowrap;
}
.pending-btn:active { transform:scale(.95); }
.pending-hours-wrap {
  width:100%; margin-top:10px; padding-top:10px;
  border-top:1px solid var(--border);
  display:none;
}
.pending-hours-wrap.open { display:block; }
.pending-hours-grid {
  display:grid; grid-template-columns:repeat(5,1fr); gap:8px;
  margin-bottom:10px;
}
.phbtn {
  aspect-ratio:1; border-radius:12px;
  border:2px solid transparent; background:var(--blue-light);
  font-family:'Nunito',sans-serif; font-weight:800; font-size:.95rem;
  color:var(--blue); cursor:pointer; transition:all .15s;
  display:flex; align-items:center; justify-content:center;
}
.phbtn:hover,.phbtn.sel { background:var(--blue); color:white; border-color:var(--blue); transform:scale(1.05); }
.phbtn.sel-green { background:var(--green); color:white; border-color:var(--green); transform:scale(1.05); }
.phbtn.sel-orange { background:var(--orange); color:white; border-color:var(--orange); transform:scale(1.05); }
.pending-valider {
  width:100%; padding:12px; border-radius:14px; border:none;
  background:var(--green); color:white;
  font-family:'Nunito',sans-serif; font-weight:800; font-size:.9rem;
  cursor:pointer; box-shadow:0 4px 16px rgba(91,191,142,.35);
  display:flex; align-items:center; justify-content:center; gap:6px;
}
.pending-valider:disabled { background:var(--border); color:var(--text-light); box-shadow:none; cursor:not-allowed; }
.pending-valider:not(:disabled):active { transform:scale(.97); }

/* ‚îÄ‚îÄ SAISIE DU SOIR ‚îÄ‚îÄ */
.saisie-card { margin:12px 16px 0; }
.saisie-card.done { border:2px solid var(--green) !important; }
.saisie-hd { display:flex; align-items:center; gap:12px; margin-bottom:14px; }
.saisie-icon {
  width:44px; height:44px; border-radius:14px;
  background:var(--blue-light);
  display:flex; align-items:center; justify-content:center; font-size:1.4rem;
  flex-shrink:0;
}
.saisie-title { font-family:'Nunito',sans-serif; font-weight:800; font-size:.95rem; }
.saisie-date { font-size:.74rem; color:var(--text-mid); margin-top:2px; }

/* Objectif row */
.obj-row {
  display:flex; align-items:center; justify-content:space-between;
  font-size:.78rem; color:var(--text-mid); margin-bottom:12px;
}
.obj-badge {
  background:var(--orange-light); color:var(--orange-dark);
  border-radius:20px; padding:4px 10px;
  font-family:'Nunito',sans-serif; font-weight:700; font-size:.72rem;
}

/* ‚îÄ‚îÄ BOUTONS HEURES ‚Äî style observance ‚îÄ‚îÄ */
.hours-grid {
  display:grid; grid-template-columns:repeat(4,1fr);
  gap:10px; margin-bottom:16px;
}
.hbtn {
  aspect-ratio:1; border-radius:12px;
  border:2px solid transparent;
  background:var(--blue-light);
  font-family:'Nunito',sans-serif; font-weight:800; font-size:1.2rem;
  color:var(--blue); cursor:pointer; transition:all .15s;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:2px;
}
.hbtn .hbtn-sub { font-size:.58rem; font-weight:600; opacity:.8; font-family:'Quicksand',sans-serif; }
.hbtn:hover, .hbtn.selected { background:var(--blue); color:white; border-color:var(--blue); transform:scale(1.05); }
.hbtn.zero:hover, .hbtn.zero.selected { background:var(--red); color:white; border-color:var(--red); }
.hbtn.target { background:var(--orange-light); color:var(--orange-dark); border-color:var(--orange); }
.hbtn.target:hover, .hbtn.target.selected { background:var(--orange); color:white; border-color:var(--orange); transform:scale(1.05); }
.hbtn.over { background:var(--green-light); color:var(--green-dark); border-color:var(--green); }
.hbtn.over:hover, .hbtn.over.selected { background:var(--green); color:white; border-color:var(--green); transform:scale(1.05); }

/* ‚îÄ‚îÄ BOUTON VALIDER ‚îÄ‚îÄ */
.valider-btn {
  width:100%; padding:16px 20px; border-radius:14px; border:none;
  background:var(--blue); color:white;
  font-family:'Nunito',sans-serif; font-weight:800; font-size:1rem;
  cursor:pointer; transition:transform .15s, box-shadow .15s;
  box-shadow:0 4px 16px rgba(74,144,217,.35);
  display:flex; align-items:center; justify-content:center; gap:8px;
}
.valider-btn:disabled { background:var(--border); color:var(--text-light); box-shadow:none; cursor:not-allowed; }
.valider-btn:not(:disabled):hover { box-shadow:0 6px 24px rgba(74,144,217,.45); }
.valider-btn:not(:disabled):active { transform:scale(.97); }

/* ‚îÄ‚îÄ CONGRATS BOX ‚Äî style observance ‚îÄ‚îÄ */
.congrats-box {
  background:linear-gradient(135deg, var(--green-light), #d4f0e5);
  border-radius:var(--radius);
  padding:20px; text-align:center; margin-top:12px;
  display:none;
}
.congrats-box .c-emoji { font-size:2.5rem; display:block; margin-bottom:8px; animation:popIn .4s cubic-bezier(.34,1.56,.64,1); }
.congrats-box h3 { font-family:'Nunito',sans-serif; font-weight:900; font-size:1.2rem; color:var(--green); margin-bottom:4px; }
.congrats-box p { color:var(--text-mid); font-size:.85rem; }

/* ‚îÄ‚îÄ CALENDRIER ‚îÄ‚îÄ */
.cal-hd { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:14px; }
.cal-title { font-family:'Nunito',sans-serif; font-weight:800; font-size:.95rem; }
.cal-month-label { font-size:.74rem; color:var(--text-mid); margin-top:2px; }
.cal-score-val { font-family:'Nunito',sans-serif; font-weight:900; font-size:1.5rem; color:var(--blue); line-height:1; text-align:right; }
.cal-score-label { font-size:.65rem; color:var(--text-mid); }
.cal-day-labels { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-bottom:4px; }
.cdl { text-align:center; font-family:'Nunito',sans-serif; font-size:.62rem; font-weight:700; color:var(--text-light); text-transform:uppercase; }
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; }
.cday {
  aspect-ratio:1; border-radius:10px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  font-family:'Nunito',sans-serif; font-size:.68rem; font-weight:700;
  transition:transform .15s; cursor:default;
}
.cday.empty { background:none; }
.cday.future { background:var(--bg); color:var(--text-light); }
.cday.ok { background:var(--green); color:white; }
.cday.partial { background:var(--orange); color:white; }
.cday.miss { background:var(--red-light); color:var(--red); border:1.5px solid #FECACA; }
.cday.today { background:var(--blue); color:white; box-shadow:0 4px 12px rgba(74,144,217,.35); }
.cday.ok:hover, .cday.partial:hover, .cday.today:hover { transform:scale(1.1); }
.cday-num { font-size:.65rem; line-height:1; }
.cday-h { font-size:.52rem; opacity:.85; line-height:1; margin-top:1px; }
.cal-legend { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
.cal-leg { display:flex; align-items:center; gap:6px; font-size:.7rem; color:var(--text-mid); }
.cal-leg-dot { width:10px; height:10px; border-radius:4px; flex-shrink:0; }

/* ‚îÄ‚îÄ COURBE VISION ‚îÄ‚îÄ */
.vision-hd { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
.vision-tabs { display:flex; gap:4px; }
.vtab {
  padding:4px 10px; border-radius:8px;
  font-family:'Nunito',sans-serif; font-size:.7rem; font-weight:700;
  border:1.5px solid var(--border); background:var(--bg);
  color:var(--text-mid); cursor:pointer; transition:all .15s;
}
.vtab.active { background:var(--blue); border-color:var(--blue); color:white; }
.vision-eyes { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px; }
.eye-stat { border-radius:14px; padding:12px; text-align:center; border:2px solid var(--border); }
.eye-od { border-color:var(--blue); background:var(--blue-light); }
.eye-og { border-color:var(--green); background:var(--green-light); }
.eye-label { font-size:.65rem; font-weight:700; color:var(--text-mid); text-transform:uppercase; letter-spacing:.4px; margin-bottom:4px; }
.eye-val { font-family:'Nunito',sans-serif; font-weight:900; font-size:1.6rem; line-height:1; }
.eye-od .eye-val { color:var(--blue); }
.eye-og .eye-val { color:var(--green-dark); }
.eye-prog { font-size:.7rem; font-weight:700; margin-top:4px; color:var(--green-dark); }
.chart-wrap { position:relative; height:150px; }
.chart-labels-y { position:absolute; left:0; top:0; bottom:20px; width:26px; display:flex; flex-direction:column; justify-content:space-between; align-items:flex-end; padding-right:4px; }
.chart-labels-y span { font-size:.56rem; color:var(--text-light); font-family:'Nunito',sans-serif; font-weight:700; }
.chart-svg { position:absolute; left:26px; right:0; top:0; bottom:0; }
.vision-legend { display:flex; gap:16px; margin-top:10px; }
.vleg { display:flex; align-items:center; gap:6px; font-size:.7rem; color:var(--text-mid); font-weight:600; }
.vleg-line { width:18px; height:3px; border-radius:2px; }

/* ‚îÄ‚îÄ RDV ‚îÄ‚îÄ */
.rdv-list { border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); margin:12px 16px 0; }
.rdv-item { background:var(--white); padding:14px 16px; display:flex; align-items:center; gap:14px; border-bottom:1px solid var(--border); cursor:pointer; transition:background .1s; }
.rdv-item:last-child { border-bottom:none; }
.rdv-item:active { background:var(--bg); }
.rdv-date { width:48px; height:52px; border-radius:14px; display:flex; flex-direction:column; align-items:center; justify-content:center; flex-shrink:0; }
.rdv-date.prochain { background:var(--blue); box-shadow:0 4px 12px rgba(74,144,217,.3); }
.rdv-date.futur { background:var(--bg); border:2px solid var(--border); }
.rdv-day { font-family:'Nunito',sans-serif; font-weight:900; font-size:1.15rem; line-height:1; color:white; }
.rdv-date.futur .rdv-day { color:var(--text); }
.rdv-mois { font-family:'Nunito',sans-serif; font-weight:700; font-size:.6rem; color:rgba(255,255,255,.85); text-transform:uppercase; }
.rdv-date.futur .rdv-mois { color:var(--text-mid); }
.rdv-info { flex:1; }
.rdv-type { font-family:'Nunito',sans-serif; font-weight:800; font-size:.88rem; }
.rdv-detail { font-size:.73rem; color:var(--text-mid); margin-top:3px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.rdv-badge { display:inline-flex; padding:3px 8px; border-radius:20px; font-size:.65rem; font-weight:700; font-family:'Nunito',sans-serif; }
.rdv-badge.prochain { background:var(--blue-light); color:var(--blue); }
.rdv-badge.ok { background:var(--green-light); color:var(--green-dark); }
.rdv-badge.attente { background:var(--orange-light); color:var(--orange-dark); }
.rdv-arrow { color:var(--text-light); font-size:1rem; }

/* ‚îÄ‚îÄ RAPPELS ‚îÄ‚îÄ */
.rappel-btn {
  width:100%; border:none; border-radius:14px;
  padding:18px 20px; margin-bottom:10px;
  font-family:'Nunito',sans-serif; font-weight:800; font-size:1rem;
  cursor:pointer; transition:transform .15s, box-shadow .15s;
  display:flex; align-items:center; gap:12px; text-align:left; color:white;
}
.rappel-btn:last-of-type { margin-bottom:0; }
.rappel-btn:active { transform:scale(.97); }
.rappel-btn .rb-icon { font-size:1.5rem; flex-shrink:0; }
.rappel-btn .rb-text { line-height:1.3; }
.rappel-btn .rb-sub { font-family:'Quicksand',sans-serif; font-size:.78rem; font-weight:500; opacity:.85; display:block; margin-top:2px; }
.rb-blue { background:var(--blue); box-shadow:0 4px 16px rgba(74,144,217,.35); }
.rb-blue:hover { box-shadow:0 6px 24px rgba(74,144,217,.45); }
.rb-green { background:var(--green); box-shadow:0 4px 16px rgba(91,191,142,.35); }
.rb-green:hover { box-shadow:0 6px 24px rgba(91,191,142,.45); }
.rb-orange { background:var(--orange); box-shadow:0 4px 16px rgba(249,168,37,.35); }
.rb-orange:hover { box-shadow:0 6px 24px rgba(249,168,37,.45); }
.status-badge {
  display:inline-flex; align-items:center; gap:6px;
  background:var(--blue-light); color:var(--blue);
  border-radius:30px; padding:6px 14px;
  font-family:'Nunito',sans-serif; font-size:.8rem; font-weight:700;
  margin-top:12px;
}

/* ‚îÄ‚îÄ NOTIFS HISTORIQUE ‚îÄ‚îÄ */
.notif-item { background:var(--white); border-radius:16px; padding:14px 16px; display:flex; align-items:flex-start; gap:12px; border:1px solid var(--border); box-shadow:var(--shadow); margin-bottom:8px; }
.notif-item.unread { background:var(--blue-light); border-color:var(--blue-mid); }
.notif-ico { width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; flex-shrink:0; }
.notif-ico.blue   { background:var(--blue-light); }
.notif-ico.green  { background:var(--green-light); }
.notif-ico.orange { background:var(--orange-light); }
.notif-msg { flex:1; }
.notif-text { font-size:.82rem; font-weight:700; line-height:1.4; color:var(--text); }
.notif-time { font-size:.68rem; color:var(--text-mid); margin-top:3px; }
.notif-unread-dot { width:8px; height:8px; background:var(--blue); border-radius:50%; margin-top:4px; flex-shrink:0; }

/* ‚îÄ‚îÄ BADGES / R√âCOMPENSES ‚îÄ‚îÄ */
.stars-row { display:flex; justify-content:center; gap:4px; flex-wrap:wrap; margin-bottom:12px; }
.star { font-size:1.4rem; transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
.star.filled { animation:popIn .3s ease-out both; }
.stars-sub { text-align:center; font-size:.75rem; color:var(--text-mid); margin-bottom:14px; }

.badges-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
.badge-item {
  display:flex; flex-direction:column; align-items:center; gap:6px;
  padding:12px 6px; border-radius:14px; border:2px solid var(--border);
  background:var(--bg); opacity:.45; cursor:default;
}
.badge-item.unlocked { background:var(--orange-light); border-color:var(--orange); opacity:1; }
.badge-item.unlocked:hover { transform:scale(1.06); transition:transform .15s cubic-bezier(.34,1.56,.64,1); }
.badge-icon { font-size:1.6rem; }
.badge-name { font-family:'Nunito',sans-serif; font-size:.6rem; font-weight:800; color:var(--text-mid); text-align:center; line-height:1.2; }
.badge-item.unlocked .badge-name { color:var(--orange-dark); }

.badge-row {
  background:var(--white); border-radius:16px; padding:14px 16px;
  display:flex; align-items:center; gap:14px;
  border:1.5px solid var(--border); box-shadow:var(--shadow); margin-bottom:8px;
}
.badge-row.unlocked { border-color:var(--orange); background:var(--orange-light); }
.badge-row-icon { width:50px; height:50px; border-radius:14px; background:var(--bg); border:2px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:1.7rem; flex-shrink:0; }
.badge-row.unlocked .badge-row-icon { background:var(--white); border-color:var(--orange); }
.badge-row-info { flex:1; }
.badge-row-name { font-family:'Nunito',sans-serif; font-weight:800; font-size:.88rem; }
.badge-row-desc { font-size:.73rem; color:var(--text-mid); margin-top:2px; }
.badge-row-status { font-size:.78rem; font-weight:700; }
.badge-row.unlocked .badge-row-status { color:var(--green-dark); }
.badge-row:not(.unlocked) .badge-row-status { color:var(--text-light); }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav {
  position:fixed; bottom:0; left:0; right:0;
  background:rgba(255,255,255,.94);
  backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
  border-top:1.5px solid var(--border);
  display:grid; grid-template-columns:repeat(4,1fr);
  padding:8px 0 16px; z-index:100;
}
.bnav {
  display:flex; flex-direction:column; align-items:center; gap:3px;
  cursor:pointer; padding:4px; border-radius:12px;
  border:none; background:none; font-family:'Quicksand',sans-serif;
  position:relative; transition:all .15s;
}
.bnav-icon { font-size:1.3rem; transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
.bnav-label { font-size:.6rem; font-weight:700; color:var(--text-mid); }
.bnav.active .bnav-icon { transform:scale(1.15); }
.bnav.active .bnav-label { color:var(--blue); font-weight:800; }
.bnav-badge { position:absolute; top:0; right:50%; margin-right:-18px; background:var(--red); color:white; font-size:.52rem; font-weight:800; padding:2px 5px; border-radius:10px; font-family:'Nunito',sans-serif; min-width:16px; text-align:center; }

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.confetti-wrap { position:fixed; inset:0; pointer-events:none; z-index:999; display:none; }
.confetti-wrap.show { display:block; }
.confetti { position:absolute; border-radius:2px; animation:confettiFall var(--dur) ease-in forwards; animation-delay:var(--delay); }
@keyframes confettiFall { 0%{transform:translateY(-20px) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(720deg);opacity:0} }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE ACCUEIL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-home">

  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" style="height:36px;object-fit:contain;">
    <button class="notif-btn" onclick="goPage('page-notifs')">üîî<div class="notif-dot" id="notif-dot"></div></button>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div class="hero-top">
      <div>
        <div class="hero-greeting">Bonjour üëã</div>
        <div class="hero-name" id="hero-name">Jules !</div>
      </div>
      <div class="hero-mascot" id="mascot">ü¶∏</div>
    </div>
    <div class="hero-stats">
      <div class="hstat"><div class="hstat-val">üî• 12</div><div class="hstat-label">Streak</div></div>
      <div class="hstat"><div class="hstat-val">84%</div><div class="hstat-label">Ce mois</div></div>
      <div class="hstat"><div class="hstat-val">‚≠ê 47</div><div class="hstat-label">√âtoiles</div></div>
    </div>
  </div>

  <!-- PERMISSION BANNER -->
  <div class="perm-banner" id="perm-banner">
    <p>üîî Active les notifications pour recevoir les rappels de Jules !</p>
    <button onclick="demanderPermission()">üîî Activer les notifications</button>
  </div>

  <!-- INSTRUCTION DU JOUR -->
  <div class="section-title">Instruction du jour</div>
  <div class="instruction-card">
    <div class="instr-icon">üè¥‚Äç‚ò†Ô∏è</div>
    <div class="instr-body">
      <div class="instr-title">Cache sur l'≈ìil droit</div>
      <div class="instr-detail">De <strong>8h00</strong> √† <strong>18h00</strong> ¬∑ ≈ìil droit (OD)</div>
    </div>
    <div class="instr-badge">
      <div class="instr-dur">4h</div>
      <div class="instr-dur-sub">objectif</div>
    </div>
  </div>

  <!-- JOURS EN ATTENTE -->
  <div class="pending-section" id="pending-section">
    <div class="pending-header">‚è≥ Jours non renseign√©s</div>
    <div id="pending-list"></div>
  </div>

  <!-- SAISIE DU SOIR -->
  <div class="section-title">Ce soir ‚Äî valider le port</div>
  <div class="card saisie-card" id="saisie-card">
    <div class="saisie-hd">
      <div class="saisie-icon">üåô</div>
      <div>
        <div class="saisie-title">Combien d'heures aujourd'hui ?</div>
        <div class="saisie-date" id="saisie-date"></div>
      </div>
    </div>

    <div id="saisie-form">
      <div class="obj-row">
        <span>Heures de port</span>
        <span class="obj-badge">üéØ Objectif : 4h</span>
      </div>
      <div class="hours-grid" id="hours-grid"></div>
      <button class="valider-btn" id="valider-btn" onclick="validerSaisie()" disabled>Valider</button>
    </div>

    <!-- Congrats ‚Äî style page observance de Jules -->
    <div class="congrats-box" id="congrats-box">
      <span class="c-emoji" id="c-emoji">üèÜ</span>
      <h3 id="c-title">Super !</h3>
      <p id="c-sub">Continue comme √ßa !</p>
    </div>
  </div>

  <!-- CALENDRIER -->
  <div class="section-title">Mon calendrier</div>
  <div class="card">
    <div class="cal-hd">
      <div><div class="cal-title">Observance cache</div><div class="cal-month-label">F√©vrier 2026</div></div>
      <div><div class="cal-score-val">84%</div><div class="cal-score-label">ce mois</div></div>
    </div>
    <div class="cal-day-labels"><div class="cdl">L</div><div class="cdl">M</div><div class="cdl">M</div><div class="cdl">J</div><div class="cdl">V</div><div class="cdl">S</div><div class="cdl">D</div></div>
    <div class="cal-grid" id="cal-grid"></div>
    <div class="cal-legend">
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--green)"></div>Objectif ‚úì</div>
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--orange)"></div>Partiel</div>
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--red-light);border:1.5px solid #FECACA"></div>Manqu√©</div>
    </div>
  </div>

  <!-- BADGES MINI -->
  <div class="section-title">Mes r√©compenses</div>
  <div class="card">
    <div class="card-title">‚≠ê √âtoiles gagn√©es</div>
    <div class="stars-row" id="stars-row"></div>
    <div class="stars-sub">Continue comme √ßa Jules ! üí™</div>
    <div class="badges-grid" id="badges-grid"></div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE MA VISION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-vision">
  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" style="height:32px;object-fit:contain;">
  </div>
  <div class="section-title">Acuit√© visuelle</div>
  <div class="card">
    <div class="vision-hd">
      <div class="cal-title">Progression</div>
      <div class="vision-tabs">
        <button class="vtab active" onclick="activateVtab(this)">3 mois</button>
        <button class="vtab" onclick="activateVtab(this)">6 mois</button>
        <button class="vtab" onclick="activateVtab(this)">Tout</button>
      </div>
    </div>
    <div class="vision-eyes">
      <div class="eye-stat eye-od">
        <div class="eye-label">≈íil droit (OD)</div>
        <div class="eye-val">5/10</div>
        <div class="eye-prog">‚Üë +2/10 depuis d√©c.</div>
      </div>
      <div class="eye-stat eye-og">
        <div class="eye-label">≈íil gauche (OG)</div>
        <div class="eye-val">9/10</div>
        <div class="eye-prog">‚Üë +1/10 depuis d√©c.</div>
      </div>
    </div>
    <div class="chart-wrap">
      <div class="chart-labels-y"><span>10</span><span>8</span><span>6</span><span>4</span><span>2</span></div>
      <div class="chart-svg">
        <svg viewBox="0 0 340 120" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%">
          <defs>
            <linearGradient id="gOD" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4A90D9" stop-opacity=".2"/><stop offset="100%" stop-color="#4A90D9" stop-opacity="0"/></linearGradient>
            <linearGradient id="gOG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#5BBF8E" stop-opacity=".2"/><stop offset="100%" stop-color="#5BBF8E" stop-opacity="0"/></linearGradient>
          </defs>
          <line x1="0" y1="0" x2="340" y2="0" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="24" x2="340" y2="24" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="48" x2="340" y2="48" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="72" x2="340" y2="72" stroke="#EAF4FF" stroke-width="1"/>
          <line x1="0" y1="96" x2="340" y2="96" stroke="#EAF4FF" stroke-width="1"/>
          <!-- OD -->
          <polygon points="0,67 56,67 113,58 170,58 226,48 340,48 340,100 0,100" fill="url(#gOD)"/>
          <polyline points="0,67 56,67 113,58 170,58 226,48 340,48" fill="none" stroke="#4A90D9" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="67" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/>
          <circle cx="113" cy="58" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/>
          <circle cx="226" cy="48" r="4" fill="#4A90D9" stroke="white" stroke-width="2"/>
          <circle cx="340" cy="48" r="5" fill="#4A90D9" stroke="white" stroke-width="2.5"/>
          <text x="328" y="41" font-size="9" fill="#2E6DB4" font-weight="800" font-family="Nunito">5/10</text>
          <!-- OG -->
          <polygon points="0,19 56,19 113,19 170,10 226,10 340,10 340,50 0,50" fill="url(#gOG)"/>
          <polyline points="0,19 56,19 113,19 170,10 226,10 340,10" fill="none" stroke="#5BBF8E" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
          <circle cx="0" cy="19" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/>
          <circle cx="113" cy="19" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/>
          <circle cx="226" cy="10" r="4" fill="#5BBF8E" stroke="white" stroke-width="2"/>
          <circle cx="340" cy="10" r="5" fill="#5BBF8E" stroke="white" stroke-width="2.5"/>
          <text x="328" y="6" font-size="9" fill="#3A8F68" font-weight="800" font-family="Nunito">9/10</text>
          <!-- Labels X -->
          <text x="0" y="115" font-size="8" fill="#C8E4FA" font-family="Nunito" font-weight="700" text-anchor="middle">Nov</text>
          <text x="113" y="115" font-size="8" fill="#C8E4FA" font-family="Nunito" font-weight="700" text-anchor="middle">Jan</text>
          <text x="226" y="115" font-size="8" fill="#C8E4FA" font-family="Nunito" font-weight="700" text-anchor="middle">Mar</text>
          <text x="340" y="115" font-size="8" fill="#7F8C8D" font-family="Nunito" font-weight="800" text-anchor="middle">Auj.</text>
        </svg>
      </div>
    </div>
    <div class="vision-legend">
      <div class="vleg"><div class="vleg-line" style="background:#4A90D9"></div>≈íil droit</div>
      <div class="vleg"><div class="vleg-line" style="background:#5BBF8E"></div>≈íil gauche</div>
    </div>
  </div>

  <div class="section-title">Mes rendez-vous</div>
  <div class="rdv-list">
    <div class="rdv-item">
      <div class="rdv-date prochain"><div class="rdv-day">03</div><div class="rdv-mois">Mar</div></div>
      <div class="rdv-info">
        <div class="rdv-type">Bilan orthoptique</div>
        <div class="rdv-detail">14h00 ¬∑ Mme Lecomte <span class="rdv-badge prochain">Dans 8 jours</span></div>
      </div>
      <div class="rdv-arrow">‚Ä∫</div>
    </div>
    <div class="rdv-item">
      <div class="rdv-date futur"><div class="rdv-day">07</div><div class="rdv-mois" style="color:var(--text-mid)">Avr</div></div>
      <div class="rdv-info">
        <div class="rdv-type">Contr√¥le vision</div>
        <div class="rdv-detail">10h30 ¬∑ Mme Lecomte <span class="rdv-badge ok">Confirm√© ‚úì</span></div>
      </div>
      <div class="rdv-arrow">‚Ä∫</div>
    </div>
    <div class="rdv-item">
      <div class="rdv-date futur" style="background:var(--orange-light);border:2px solid var(--orange)">
        <div class="rdv-day" style="color:var(--orange-dark)">?</div>
        <div class="rdv-mois" style="color:var(--orange-dark)">Jun</div>
      </div>
      <div class="rdv-info">
        <div class="rdv-type">Prochain suivi</div>
        <div class="rdv-detail"><span class="rdv-badge attente">√Ä planifier</span></div>
      </div>
      <div class="rdv-arrow">‚Ä∫</div>
    </div>
  </div>
  <div style="height:12px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE RAPPELS / NOTIFICATIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-notifs">
  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" style="height:32px;object-fit:contain;">
  </div>

  <div class="section-title">Envoyer un rappel</div>
  <div class="card">
    <button class="rappel-btn rb-blue" onclick="envoyerNotif('cache')">
      <span class="rb-icon">üè¥‚Äç‚ò†Ô∏è</span>
      <span class="rb-text">Rappel : mettre le cache
        <span class="rb-sub">Envoie une notif √† Jules</span>
      </span>
    </button>
    <div class="status-badge" id="status-cache">üí§ En attente</div>
  </div>

  <div class="card" style="margin-top:10px">
    <button class="rappel-btn rb-green" onclick="envoyerNotif('retirer')">
      <span class="rb-icon">üéâ</span>
      <span class="rb-text">Pr√™t √† remplir l'observance
        <span class="rb-sub">Notifie Jules de retirer son cache</span>
      </span>
    </button>
    <div class="status-badge" id="status-retirer">üí§ En attente</div>
  </div>

  <div class="card" style="margin-top:10px">
    <button class="rappel-btn rb-orange" onclick="envoyerNotif('rdv')">
      <span class="rb-icon">üìÖ</span>
      <span class="rb-text">Rappel rendez-vous
        <span class="rb-sub">RDV bilan dans 8 jours chez Mme Lecomte</span>
      </span>
    </button>
    <div class="status-badge" id="status-rdv">üí§ En attente</div>
  </div>

  <div class="section-title">Historique</div>
  <div style="margin:0 16px">
    <div class="notif-item unread">
      <div class="notif-ico blue">‚è∞</div>
      <div class="notif-msg"><div class="notif-text">N'oublie pas ton cache aujourd'hui ! Objectif : 4h üéØ</div><div class="notif-time">Aujourd'hui ¬∑ 8h00</div></div>
      <div class="notif-unread-dot"></div>
    </div>
    <div class="notif-item unread">
      <div class="notif-ico orange">üìÖ</div>
      <div class="notif-msg"><div class="notif-text">RDV bilan orthoptique dans 8 jours chez Mme Lecomte</div><div class="notif-time">Aujourd'hui ¬∑ 9h00</div></div>
      <div class="notif-unread-dot"></div>
    </div>
    <div class="notif-item">
      <div class="notif-ico green">‚≠ê</div>
      <div class="notif-msg"><div class="notif-text">Bravo ! 7 jours d'affil√©e ‚Äî badge Super H√©ros d√©bloqu√© ü¶∏</div><div class="notif-time">Hier ¬∑ 20h15</div></div>
    </div>
    <div class="notif-item">
      <div class="notif-ico blue">üìà</div>
      <div class="notif-msg"><div class="notif-text">Ton ≈ìil droit progresse ! OD passe de 4/10 √† 5/10 ‚ú®</div><div class="notif-time">Il y a 3 jours</div></div>
    </div>
    <div class="notif-item">
      <div class="notif-ico orange">üèÜ</div>
      <div class="notif-msg"><div class="notif-text">Streak de 10 jours ‚Äî badge Champion d√©bloqu√© ! üèÜ</div><div class="notif-time">Il y a 5 jours</div></div>
    </div>
  </div>
  <div style="height:12px"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PAGE BADGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-badges">
  <div class="app-header">
    <img src="amblyup-logo.png" alt="Amblyup" style="height:32px;object-fit:contain;">
  </div>

  <div class="section-title">‚≠ê √âtoiles ‚Äî 47 gagn√©es</div>
  <div class="card">
    <div class="stars-row" id="stars-row-big"></div>
    <div class="stars-sub">Tu gagnes une ‚≠ê chaque jour o√π tu atteins ton objectif !</div>
  </div>

  <div class="section-title">Badges d√©bloqu√©s</div>
  <div style="margin:0 16px" id="badges-list"></div>
  <div style="height:12px"></div>
</div>

<!-- ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ -->
<nav class="bottom-nav">
  <button class="bnav active" onclick="goPage('page-home')"><span class="bnav-icon">üè†</span><span class="bnav-label">Accueil</span></button>
  <button class="bnav" onclick="goPage('page-vision')"><span class="bnav-icon">üëÅ</span><span class="bnav-label">Ma vision</span></button>
  <button class="bnav" onclick="goPage('page-notifs')"><span class="bnav-icon">üîî</span><span class="bnav-label">Rappels</span><span class="bnav-badge" id="bnav-badge">2</span></button>
  <button class="bnav" onclick="goPage('page-badges')"><span class="bnav-icon">‚≠ê</span><span class="bnav-label">Badges</span></button>
</nav>

<!-- CONFETTI -->
<div class="confetti-wrap" id="confetti"></div>

<script>
'use strict';

let swReg = null;
let selectedH = null;
const OBJ = 4;

// ‚îÄ‚îÄ SERVICE WORKER ‚îÄ‚îÄ
window.addEventListener('load', async () => {
  if ('serviceWorker' in navigator) {
    try { swReg = await navigator.serviceWorker.register('sw.js'); }
    catch(e) { console.log('SW:', e); }
  }
  if ('Notification' in window && Notification.permission === 'default') {
    document.getElementById('perm-banner').style.display = 'block';
  }
  initDate();
  buildHoursGrid();
  buildCalendar();
  buildStars('stars-row', 47, 10);
  buildStars('stars-row-big', 47, 10);
  buildBadgesGrid();
  buildBadgesList();
  buildPending();

  if (window.location.hash === '#saisie') {
    setTimeout(() => document.getElementById('saisie-card').scrollIntoView({behavior:'smooth'}), 300);
  }
});

// ‚îÄ‚îÄ PERMISSION ‚îÄ‚îÄ
async function demanderPermission() {
  const perm = await Notification.requestPermission();
  if (perm === 'granted') {
    document.getElementById('perm-banner').style.display = 'none';
  }
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.bnav').forEach(b => b.classList.remove('active'));
  const map = {'page-home':0,'page-vision':1,'page-notifs':2,'page-badges':3};
  const idx = map[id];
  if (idx !== undefined) document.querySelectorAll('.bnav')[idx].classList.add('active');
  window.scrollTo(0,0);
  if (id === 'page-notifs') {
    document.getElementById('bnav-badge').style.display = 'none';
    document.getElementById('notif-dot').style.display = 'none';
  }
}

// ‚îÄ‚îÄ DATE ‚îÄ‚îÄ
function initDate() {
  const d = new Date();
  const J = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const M = ['janvier','f√©vrier','mars','avril','mai','juin','juillet','ao√ªt','septembre','octobre','novembre','d√©cembre'];
  document.getElementById('saisie-date').textContent = J[d.getDay()] + ' ' + d.getDate() + ' ' + M[d.getMonth()];
}

// ‚îÄ‚îÄ HEURES ‚Äî style observance ‚îÄ‚îÄ
function buildHoursGrid() {
  const grid = document.getElementById('hours-grid');
  // 0h √† 7h = 8 boutons, 4 colonnes √ó 2 lignes
  for (let h = 0; h <= 7; h++) {
    const btn = document.createElement('button');
    let cls = 'hbtn';
    if (h === 0) cls += ' zero';
    else if (h === OBJ) cls += ' target';
    else if (h > OBJ) cls += ' over';
    btn.className = cls;
    const sub = h === 0 ? 'üòî' : h === OBJ ? '‚≠ê objectif' : h > OBJ ? 'üèÜ super !' : (h === 1 ? 'heure' : 'heures');
    btn.innerHTML = h + 'h<span class="hbtn-sub">' + sub + '</span>';
    btn.onclick = () => selectHeure(btn, h);
    grid.appendChild(btn);
  }
}

function selectHeure(btn, h) {
  document.querySelectorAll('.hbtn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  selectedH = h;

  const vbtn = document.getElementById('valider-btn');
  vbtn.disabled = false;
  if (h >= OBJ) {
    vbtn.style.background = 'var(--green)';
    vbtn.style.boxShadow = '0 4px 16px rgba(91,191,142,.35)';
    vbtn.textContent = h > OBJ ? 'üèÜ Valider ‚Äî Super Jules !' : '‚≠ê Valider ‚Äî Objectif atteint !';
  } else if (h === 0) {
    vbtn.style.background = 'var(--red)';
    vbtn.style.boxShadow = 'none';
    vbtn.textContent = 'Valider üòî';
  } else {
    vbtn.style.background = 'var(--blue)';
    vbtn.style.boxShadow = '0 4px 16px rgba(74,144,217,.35)';
    vbtn.textContent = 'Valider ‚úì';
  }
}

function validerSaisie() {
  if (selectedH === null) return;
  const h = selectedH;
  const form = document.getElementById('saisie-form');
  const box = document.getElementById('congrats-box');
  const card = document.getElementById('saisie-card');

  form.style.display = 'none';
  box.style.display = 'block';

  if (h >= OBJ) {
    card.classList.add('done');
    document.getElementById('c-emoji').textContent = h > OBJ ? 'üèÜ' : 'üéâ';
    document.getElementById('c-title').textContent = h > OBJ ? 'üèÜ ' + h + 'h de port, incroyable !' : 'üéâ Bravo Jules !';
    document.getElementById('c-sub').textContent = h >= OBJ ? "C'est excellent ! Continue comme √ßa üí™" : '';
    lancerConfetti();
    document.getElementById('mascot').textContent = h > OBJ ? 'üëë' : 'üèÜ';
  } else if (h === 0) {
    document.getElementById('c-emoji').textContent = 'üòî';
    document.getElementById('c-title').textContent = 'Pas de cache aujourd\'hui...';
    document.getElementById('c-sub').textContent = "N'oublie pas demain ! Tu peux le faire üí™";
    document.getElementById('mascot').textContent = 'ü¶∏';
  } else {
    document.getElementById('c-emoji').textContent = 'üëç';
    document.getElementById('c-title').textContent = 'üëç ' + h + 'h enregistr√©es !';
    document.getElementById('c-sub').textContent = "Bonne journ√©e, on continue demain !";
    document.getElementById('mascot').textContent = 'üí™';
  }
}

// ‚îÄ‚îÄ CALENDRIER ‚îÄ‚îÄ
function buildCalendar() {
  const data = [
    null,null,null,null,null,null, // 1er f√©v = dimanche ‚Üí 6 cases vides (lun‚Äìsam)
    {d:1,s:'ok',h:'4h'},{d:2,s:'ok',h:'5h'},{d:3,s:'ok',h:'4h'},
    {d:4,s:'partial',h:'2h'},{d:5,s:'ok',h:'4h'},{d:6,s:'ok',h:'4h'},
    {d:7,s:'partial',h:'3h'},{d:8,s:'ok',h:'4h'},{d:9,s:'miss',h:'0h'},
    {d:10,s:'ok',h:'4h'},{d:11,s:'ok',h:'4h'},{d:12,s:'ok',h:'5h'},
    {d:13,s:'ok',h:'4h'},{d:14,s:'partial',h:'2h'},{d:15,s:'ok',h:'4h'},
    {d:16,s:'ok',h:'4h'},{d:17,s:'ok',h:'3h'},{d:18,s:'ok',h:'4h'},
    {d:19,s:'ok',h:'4h'},{d:20,s:'ok',h:'4h'},{d:21,s:'partial',h:'3h'},
    {d:22,s:'ok',h:'4h'},{d:23,s:'today',h:'?'},
    {d:24,s:'future'},{d:25,s:'future'},{d:26,s:'future'},
    {d:27,s:'future'},{d:28,s:'future'},
  ];
  const grid = document.getElementById('cal-grid');
  data.forEach(day => {
    const el = document.createElement('div');
    if (!day) { el.className = 'cday empty'; }
    else {
      el.className = 'cday ' + day.s;
      el.innerHTML = '<span class="cday-num">' + day.d + '</span>' + (day.h ? '<span class="cday-h">' + day.h + '</span>' : '');
    }
    grid.appendChild(el);
  });
}

// ‚îÄ‚îÄ √âTOILES ‚îÄ‚îÄ
function buildStars(id, total, max) {
  const row = document.getElementById(id);
  if (!row) return;
  row.innerHTML = '';
  const filled = Math.min(total % max || max, max);
  for (let i = 0; i < max; i++) {
    const s = document.createElement('span');
    s.className = 'star' + (i < filled ? ' filled' : '');
    s.textContent = i < filled ? '‚≠ê' : '‚òÜ';
    s.style.animationDelay = (i * 0.06) + 's';
    row.appendChild(s);
  }
}

// ‚îÄ‚îÄ BADGES DATA ‚îÄ‚îÄ
const BADGES = [
  {icon:'ü¶∏', name:'Super H√©ros',    desc:'7 jours d\'affil√©e',    unlocked:true},
  {icon:'üèÜ', name:'Champion',       desc:'10 jours streak',        unlocked:true},
  {icon:'üåü', name:'√âtoile filante', desc:'30 √©toiles',             unlocked:true},
  {icon:'üí™', name:'Pers√©v√©rant',    desc:'20 jours ce mois',       unlocked:true},
  {icon:'üëë', name:'Roi du cache',   desc:'Objectif 7j/7',          unlocked:false},
  {icon:'üöÄ', name:'D√©collage',      desc:'1er mois complet',       unlocked:false},
  {icon:'üåà', name:'Arc-en-ciel',    desc:'50 √©toiles',             unlocked:false},
  {icon:'üéØ', name:'Pr√©cision',      desc:'100% en 1 semaine',      unlocked:false},
];

function buildBadgesGrid() {
  const grid = document.getElementById('badges-grid');
  if (!grid) return;
  BADGES.forEach(b => {
    const el = document.createElement('div');
    el.className = 'badge-item' + (b.unlocked ? ' unlocked' : '');
    el.innerHTML = '<span class="badge-icon">' + b.icon + '</span><span class="badge-name">' + b.name + '</span>';
    grid.appendChild(el);
  });
}

function buildBadgesList() {
  const list = document.getElementById('badges-list');
  if (!list) return;
  BADGES.forEach(b => {
    const el = document.createElement('div');
    el.className = 'badge-row' + (b.unlocked ? ' unlocked' : '');
    el.innerHTML =
      '<div class="badge-row-icon">' + b.icon + '</div>' +
      '<div class="badge-row-info">' +
        '<div class="badge-row-name">' + b.name + '</div>' +
        '<div class="badge-row-desc">' + b.desc + '</div>' +
      '</div>' +
      '<div class="badge-row-status">' + (b.unlocked ? '‚úì Obtenu' : 'üîí') + '</div>';
    list.appendChild(el);
  });
}

// ‚îÄ‚îÄ JOURS EN ATTENTE ‚îÄ‚îÄ
const PENDING = [
  {d:19, label:'Jeudi 19 f√©v'},
  {d:21, label:'Samedi 21 f√©v'},
  {d:22, label:'Dim. 22 f√©v'},
];
let pendingDone = 0;

function buildPending() {
  const list = document.getElementById('pending-list');
  PENDING.forEach((day, i) => {
    const el = document.createElement('div');
    el.className = 'pending-item';
    el.id = 'pi-' + i;
    el.innerHTML =
      '<div class="pending-date-box"><div class="pending-day">' + day.d + '</div><div class="pending-month">F√©v</div></div>' +
      '<div class="pending-info"><div class="pending-name">' + day.label + '</div><div class="pending-sub">Cache OD ¬∑ objectif ' + OBJ + 'h</div></div>' +
      '<button class="pending-btn" onclick="togglePending(' + i + ')">Renseigner ‚Üí</button>' +
      '<div class="pending-hours-wrap" id="phw-' + i + '">' +
        '<div class="pending-hours-grid" id="phg-' + i + '"></div>' +
        '<button class="pending-valider" id="pval-' + i + '" onclick="resolvePending(' + i + ')" disabled>‚úì Valider ce jour</button>' +
      '</div>';
    list.appendChild(el);
    buildPendingGrid(i);
  });
}

function buildPendingGrid(i) {
  const grid = document.getElementById('phg-' + i);
  for (let h = 0; h <= 4; h++) {
    const btn = document.createElement('button');
    btn.className = 'phbtn';
    btn.textContent = h + 'h';
    btn.onclick = () => {
      grid.querySelectorAll('.phbtn').forEach(b => { b.className = 'phbtn'; });
      btn.className = 'phbtn ' + (h >= OBJ ? 'sel-green' : h > 0 ? 'sel' : 'sel');
      if (h === 0) { btn.style.background = 'var(--red)'; btn.style.color = 'white'; btn.style.borderColor = 'var(--red)'; }
      document.getElementById('pval-' + i).disabled = false;
    };
    grid.appendChild(btn);
  }
}

function togglePending(i) {
  const wrap = document.getElementById('phw-' + i);
  const isOpen = wrap.classList.contains('open');
  document.querySelectorAll('.pending-hours-wrap').forEach(w => w.classList.remove('open'));
  if (!isOpen) wrap.classList.add('open');
}

function resolvePending(i) {
  const el = document.getElementById('pi-' + i);
  el.style.opacity = '0'; el.style.transform = 'translateX(20px)';
  pendingDone++;
  setTimeout(() => {
    el.remove();
    if (pendingDone >= PENDING.length) document.getElementById('pending-section').style.display = 'none';
  }, 400);
}

// ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ
async function envoyerNotif(type) {
  const ids = {cache:'status-cache', retirer:'status-retirer', rdv:'status-rdv'};
  const statusEl = document.getElementById(ids[type]);
  if (!('Notification' in window)) { statusEl.innerHTML = '‚ö†Ô∏è Non support√©'; return; }
  if (Notification.permission === 'default') await demanderPermission();
  if (Notification.permission !== 'granted') {
    statusEl.innerHTML = '‚ö†Ô∏è Permission refus√©e';
    statusEl.style.background = 'var(--orange-light)'; statusEl.style.color = 'var(--orange-dark)';
    setTimeout(() => { statusEl.innerHTML = 'üí§ En attente'; statusEl.style = ''; }, 4000);
    return;
  }
  const notifs = {
    cache:   { title:'Cache-≈ìil de Jules üè¥‚Äç‚ò†Ô∏è', body:"Bonjour Jules, aujourd'hui mets le cache sur l'OD üëÅÔ∏è", url: window.location.href },
    retirer: { title:'Bravo Jules ! üéâ', body:"Tu peux retirer ton cache ! Viens nous dire le temps pass√© üåü", url: window.location.href + '#saisie' },
    rdv:     { title:'Rappel rendez-vous üìÖ', body:"RDV bilan orthoptique dans 8 jours chez Mme Lecomte. Le 3 mars √† 14h00.", url: window.location.href },
  };
  const n = notifs[type];
  try {
    if (swReg) {
      await swReg.showNotification(n.title, { body:n.body, icon:'icon-192.png', badge:'icon-192.png', vibrate:[200,100,200], tag:type, data:{url:n.url} });
    } else {
      new Notification(n.title, {body:n.body});
    }
    statusEl.innerHTML = '‚úÖ Notification envoy√©e !';
    statusEl.style.background = 'var(--green-light)'; statusEl.style.color = 'var(--green-dark)';
  } catch(e) { statusEl.innerHTML = '‚ùå ' + e.message; }
  setTimeout(() => { statusEl.innerHTML = 'üí§ En attente'; statusEl.style.background = ''; statusEl.style.color = ''; }, 4000);
}

// ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ
function lancerConfetti() {
  const wrap = document.getElementById('confetti');
  wrap.classList.add('show'); wrap.innerHTML = '';
  const colors = ['#4A90D9','#5BBF8E','#F9A825','#E74C3C','#C8E4FA','#2E6DB4'];
  for (let i = 0; i < 70; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.cssText = 'left:'+Math.random()*100+'%;top:'+(-Math.random()*30)+'px;background:'+colors[Math.floor(Math.random()*colors.length)]+';width:'+(6+Math.random()*8)+'px;height:'+(6+Math.random()*8)+'px;border-radius:'+(Math.random()>.5?'50%':'2px')+';--dur:'+(1+Math.random()*1.2)+'s;--delay:'+(Math.random()*.8)+'s';
    wrap.appendChild(el);
  }
  setTimeout(() => { wrap.classList.remove('show'); wrap.innerHTML = ''; }, 3000);
}

function activateVtab(el) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
</script>
</body>
</html>
