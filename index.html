<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#3ABFBF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Mon ≈íil">
<link rel="manifest" href="manifest.json">
<title>Jules üëÅ ‚Äî Mon Cache</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Nunito+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --teal:#3ABFBF;--teal-d:#2a9e9e;--teal-l:#E8FAFA;--teal-ll:#F0FCFC;
  --purple:#A78BFA;--purple-d:#6D28D9;--purple-l:#EDE9FE;
  --yellow:#FCD34D;--yellow-d:#D97706;--yellow-l:#FFFBEB;
  --green:#34D399;--green-d:#059669;--green-l:#ECFDF5;
  --orange:#FB923C;--orange-l:#FFF7ED;--orange-d:#C2410C;
  --red:#F87171;--red-l:#FEF2F2;
  --blue:#60A5FA;--blue-l:#EFF6FF;
  --text:#1E293B;--text-m:#64748B;--text-l:#CBD5E1;
  --bg:#F0F9FF;--white:#FFFFFF;--border:#E2F0F7;
  --shadow: 0 4px 24px rgba(58,191,191,.10), 0 1px 4px rgba(0,0,0,.04);
  --shadow-lg: 0 12px 40px rgba(58,191,191,.15), 0 2px 8px rgba(0,0,0,.06);
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{scroll-behavior:smooth;}
body{
  font-family:'Nunito Sans',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  min-height:100dvh;
  overflow-x:hidden;
  padding-bottom:90px;
}

/* Fond d√©grad√© anim√© */
body::before{
  content:'';
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 15% 15%, rgba(58,191,191,.13) 0%, transparent 50%),
    radial-gradient(circle at 85% 80%, rgba(167,139,250,.10) 0%, transparent 50%),
    radial-gradient(circle at 55% 5%,  rgba(252,211,77,.08)  0%, transparent 40%);
  pointer-events:none;z-index:0;
}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{display:none;position:relative;z-index:1;}
.page.active{display:block;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.app-header{
  padding:1.25rem 1.25rem 0;
  display:flex;align-items:center;justify-content:space-between;
  position:relative;z-index:1;
}
.logo{display:flex;align-items:center;gap:.4rem;font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;color:var(--text);}
.logo-eye{
  width:32px;height:32px;border-radius:50%;
  background:linear-gradient(135deg,var(--teal),var(--purple));
  display:flex;align-items:center;justify-content:center;font-size:.9rem;
  box-shadow:0 4px 12px rgba(58,191,191,.3);
}
.notif-btn{
  width:36px;height:36px;border-radius:11px;
  background:var(--white);border:1.5px solid var(--border);
  display:flex;align-items:center;justify-content:center;font-size:1rem;
  cursor:pointer;position:relative;box-shadow:var(--shadow);
}
.notif-dot{position:absolute;top:5px;right:5px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid var(--white);}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero{
  margin:1rem 1.25rem .875rem;
  background:linear-gradient(135deg,#3ABFBF 0%,#7C3AED 100%);
  border-radius:24px;padding:1.25rem;color:white;
  position:relative;overflow:hidden;
  box-shadow:0 8px 32px rgba(58,191,191,.28);
  animation:slideUp .4s ease-out .05s both;
}
.hero::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;background:rgba(255,255,255,.1);border-radius:50%;}
.hero::after{content:'';position:absolute;bottom:-20px;left:30px;width:80px;height:80px;background:rgba(255,255,255,.07);border-radius:50%;}
.hero-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:.875rem;position:relative;z-index:1;}
.hero-greeting{font-family:'Nunito',sans-serif;font-size:.72rem;font-weight:700;opacity:.8;text-transform:uppercase;letter-spacing:.5px;}
.hero-name{font-family:'Nunito',sans-serif;font-size:1.25rem;font-weight:900;margin-top:.1rem;}
.hero-mascot{font-size:2.4rem;animation:float 3s ease-in-out infinite;filter:drop-shadow(0 4px 8px rgba(0,0,0,.2));}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
.hero-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.5rem;position:relative;z-index:1;}
.hstat{background:rgba(255,255,255,.18);border-radius:14px;padding:.6rem .5rem;text-align:center;backdrop-filter:blur(4px);}
.hstat-val{font-family:'Nunito',sans-serif;font-size:1.25rem;font-weight:900;line-height:1;}
.hstat-label{font-size:.58rem;font-weight:600;opacity:.8;margin-top:.15rem;}

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.section-title{
  font-family:'Nunito',sans-serif;font-size:.65rem;font-weight:800;
  text-transform:uppercase;letter-spacing:.7px;color:var(--text-m);
  padding:.875rem 1.25rem .35rem;
}

/* ‚îÄ‚îÄ INSTRUCTION DU JOUR ‚îÄ‚îÄ */
.instruction-card{
  margin:0 1.25rem .75rem;
  background:linear-gradient(135deg,rgba(58,191,191,.07),rgba(167,139,250,.07));
  border-radius:20px;padding:1rem 1.1rem;border:1.5px solid var(--teal);
  display:flex;align-items:center;justify-content:space-between;gap:.75rem;
  box-shadow:var(--shadow);animation:slideUp .4s ease-out .08s both;
}
.instr-left{display:flex;align-items:center;gap:.75rem;flex:1;}
.instr-icon{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--teal-l),var(--purple-l));display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;box-shadow:0 4px 12px rgba(58,191,191,.18);}
.instr-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;color:var(--text);}
.instr-detail{font-size:.73rem;color:var(--text-m);margin-top:.15rem;}
.instr-detail strong{color:var(--teal-d);font-weight:800;}
.instr-badge{text-align:center;background:var(--teal);border-radius:12px;padding:.5rem .75rem;color:white;flex-shrink:0;}
.instr-dur{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.25rem;line-height:1;}
.instr-dur-sub{font-size:.58rem;font-weight:700;opacity:.85;}

/* ‚îÄ‚îÄ BANNER PERMISSION ‚îÄ‚îÄ */
.perm-banner{
  margin:0 1.25rem .75rem;
  background:var(--orange-l);border:1.5px solid var(--orange);
  border-radius:16px;padding:.875rem 1rem;
  display:none;animation:slideUp .4s ease-out;
}
.perm-banner p{font-size:.8rem;color:var(--text);font-weight:600;}
.perm-banner p span{font-size:.95rem;}
.perm-btn{
  margin-top:.6rem;background:var(--orange);color:white;border:none;
  border-radius:10px;padding:.5rem 1rem;font-family:'Nunito',sans-serif;
  font-weight:700;font-size:.8rem;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:.4rem;
}
.perm-btn:active{transform:scale(.96);}

/* ‚îÄ‚îÄ JOURS EN ATTENTE ‚îÄ‚îÄ */
.pending-section{margin:0 1.25rem .75rem;animation:slideUp .4s ease-out .09s both;}
.pending-title{font-size:.7rem;font-weight:800;color:var(--orange-d);margin-bottom:.4rem;text-transform:uppercase;letter-spacing:.4px;}
.pending-list{display:flex;flex-direction:column;gap:.4rem;}
.pending-item{
  background:var(--white);border-radius:16px;border:1.5px solid var(--orange-l);
  padding:.75rem 1rem;display:flex;align-items:center;gap:.75rem;
  box-shadow:var(--shadow);flex-wrap:wrap;
}
.pending-date{width:42px;height:46px;border-radius:12px;background:var(--orange-l);border:1.5px solid var(--orange);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;}
.pending-day{font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;color:var(--orange-d);line-height:1;}
.pending-month{font-family:'Nunito',sans-serif;font-weight:700;font-size:.58rem;color:var(--orange-d);text-transform:uppercase;}
.pending-info{flex:1;}
.pending-name{font-family:'Nunito',sans-serif;font-weight:800;font-size:.82rem;}
.pending-sub{font-size:.7rem;color:var(--text-m);margin-top:.05rem;}
.pbtn-expand{
  padding:.32rem .7rem;border-radius:10px;border:1.5px solid var(--teal);
  background:var(--teal-l);color:var(--teal-d);font-family:'Nunito',sans-serif;
  font-weight:700;font-size:.72rem;cursor:pointer;transition:all .15s;white-space:nowrap;
}
.pbtn-expand:active{transform:scale(.95);}
.pending-slider-wrap{width:100%;margin-top:.75rem;padding-top:.75rem;border-top:1px solid var(--border);display:none;}
.pending-slider-wrap.open{display:block;}
.pbtn-valider{
  width:100%;margin-top:.5rem;padding:.6rem;border-radius:12px;border:none;
  background:linear-gradient(135deg,var(--teal),var(--purple));color:white;
  font-family:'Nunito',sans-serif;font-weight:800;font-size:.82rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;gap:.4rem;
  box-shadow:0 4px 14px rgba(58,191,191,.3);
}
.pbtn-valider:active{transform:scale(.97);}

/* ‚îÄ‚îÄ SAISIE CARD ‚îÄ‚îÄ */
.saisie-card{
  margin:0 1.25rem .75rem;background:var(--white);border-radius:20px;
  padding:1.1rem;box-shadow:var(--shadow);border:1.5px solid var(--border);
  animation:slideUp .4s ease-out .1s both;
}
.saisie-card.done{border-color:var(--green);background:var(--green-l);}
.saisie-hd{display:flex;align-items:center;gap:.625rem;margin-bottom:.875rem;}
.saisie-icon{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--teal-l),var(--purple-l));display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
.saisie-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;}
.saisie-date{font-size:.7rem;color:var(--text-m);margin-top:.05rem;}

/* S√©lecteur heures ‚Äî boutons ronds kids-friendly */
.hours-grid{
  display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;margin-bottom:.875rem;
}
.hbtn{
  aspect-ratio:1;border-radius:16px;border:2px solid var(--border);
  background:var(--bg);font-family:'Nunito',sans-serif;font-weight:900;
  font-size:1.1rem;color:var(--text-m);cursor:pointer;
  transition:all .2s cubic-bezier(.34,1.56,.64,1);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.1rem;
}
.hbtn .hbtn-sub{font-size:.52rem;font-weight:600;opacity:.7;font-family:'Nunito Sans',sans-serif;}
.hbtn:active{transform:scale(.9);}
.hbtn.selected{
  background:var(--teal);border-color:var(--teal);color:white;
  box-shadow:0 6px 18px rgba(58,191,191,.4);transform:scale(1.08);
}
.hbtn.target{border-color:var(--yellow);background:var(--yellow-l);color:var(--yellow-d);}
.hbtn.target.selected{background:var(--yellow);border-color:var(--yellow);color:white;box-shadow:0 6px 18px rgba(252,211,77,.45);}
.hbtn.over{border-color:var(--green);background:var(--green-l);color:var(--green-d);}
.hbtn.over.selected{background:var(--green);border-color:var(--green);color:white;box-shadow:0 6px 18px rgba(52,211,153,.4);}
.hbtn.zero{border-color:var(--red-l);background:var(--red-l);color:var(--red);}
.hbtn.zero.selected{background:var(--red);border-color:var(--red);color:white;}

.obj-row{display:flex;align-items:center;justify-content:space-between;font-size:.72rem;color:var(--text-m);margin-bottom:.625rem;}
.obj-badge{display:inline-flex;align-items:center;gap:.25rem;background:var(--yellow-l);color:var(--yellow-d);padding:.18rem .5rem;border-radius:20px;font-weight:700;font-size:.68rem;}

.valider-btn{
  width:100%;padding:.8rem;border-radius:14px;border:none;
  background:linear-gradient(135deg,var(--teal),var(--purple));color:white;
  font-family:'Nunito',sans-serif;font-weight:900;font-size:.92rem;cursor:pointer;
  transition:all .2s;box-shadow:0 6px 20px rgba(58,191,191,.32);
  display:flex;align-items:center;justify-content:center;gap:.5rem;
}
.valider-btn:disabled{background:var(--border);color:var(--text-l);box-shadow:none;cursor:not-allowed;}
.valider-btn:not(:disabled):active{transform:scale(.97);}

.done-msg{display:none;text-align:center;padding:.5rem 0;}
.done-icon{font-size:2.5rem;display:block;margin-bottom:.35rem;animation:popIn .4s cubic-bezier(.34,1.56,.64,1);}
.done-text{font-family:'Nunito',sans-serif;font-weight:900;font-size:1rem;color:var(--green-d);}
.done-sub{font-size:.75rem;color:var(--text-m);margin-top:.2rem;}

/* ‚îÄ‚îÄ DUAL SLIDER ‚îÄ‚îÄ */
.slider-labels{display:flex;justify-content:space-between;margin-bottom:.5rem;}
.slabel{font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:800;}
.dual-slider-wrap{position:relative;height:50px;margin-bottom:.4rem;}
.track-bg{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;height:10px;background:var(--bg);border-radius:20px;border:1.5px solid var(--border);}
.track-obj{position:absolute;top:50%;transform:translateY(-50%);left:0;height:10px;background:var(--yellow);opacity:.5;border-radius:20px;transition:width .1s;}
.track-real{position:absolute;top:50%;transform:translateY(-50%);left:0;height:10px;background:var(--teal);border-radius:20px;transition:width .1s;}
.slider-marks{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;height:10px;pointer-events:none;}
.smark{position:absolute;top:13px;font-size:.55rem;font-weight:700;color:var(--text-l);transform:translateX(-50%);font-family:'Nunito',sans-serif;}
.slider-inp{position:absolute;top:50%;transform:translateY(-50%);left:0;right:0;width:100%;-webkit-appearance:none;appearance:none;height:10px;background:transparent;pointer-events:none;margin:0;}
.slider-inp::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:28px;height:28px;border-radius:50%;cursor:pointer;pointer-events:all;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,.15);transition:transform .15s cubic-bezier(.34,1.56,.64,1);}
.slider-inp::-webkit-slider-thumb:active{transform:scale(1.2);}
.slider-obj-inp::-webkit-slider-thumb{background:var(--yellow);box-shadow:0 2px 10px rgba(252,211,77,.4);}
.slider-real-inp::-webkit-slider-thumb{background:var(--teal);box-shadow:0 2px 10px rgba(58,191,191,.4);}
.slider-obj-inp{z-index:1;}
.slider-real-inp{z-index:2;}
.slider-legend{display:flex;gap:1rem;margin-top:.25rem;margin-bottom:.625rem;}
.sleg{display:flex;align-items:center;gap:.3rem;font-size:.68rem;color:var(--text-m);font-weight:600;}
.sleg-dot{width:10px;height:10px;border-radius:50%;}
.locked-msg{display:flex;align-items:center;justify-content:center;gap:.5rem;background:var(--bg);border:1.5px dashed var(--border);border-radius:14px;padding:.875rem;font-size:.78rem;color:var(--text-m);font-weight:600;margin-bottom:.875rem;}

/* ‚îÄ‚îÄ CALENDRIER ‚îÄ‚îÄ */
.cal-card{margin:0 1.25rem .75rem;background:var(--white);border-radius:20px;padding:1.1rem;box-shadow:var(--shadow);border:1.5px solid var(--border);animation:slideUp .4s ease-out .15s both;}
.cal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:.875rem;}
.cal-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.92rem;}
.cal-month{font-size:.7rem;color:var(--text-m);margin-top:.05rem;}
.cal-score{text-align:right;}
.cal-score-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.4rem;color:var(--teal-d);}
.cal-score-label{font-size:.63rem;color:var(--text-m);}
.cal-day-labels{display:grid;grid-template-columns:repeat(7,1fr);gap:.3rem;margin-bottom:.3rem;}
.cdl{text-align:center;font-size:.6rem;font-weight:700;color:var(--text-l);text-transform:uppercase;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.3rem;}
.cday{aspect-ratio:1;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:'Nunito',sans-serif;font-size:.66rem;font-weight:700;transition:transform .15s;cursor:default;}
.cday.empty{background:none;}
.cday.future{background:var(--bg);color:var(--text-l);}
.cday.ok{background:var(--green);color:white;box-shadow:0 2px 8px rgba(52,211,153,.3);}
.cday.ok:hover{transform:scale(1.1);}
.cday.partial{background:var(--yellow);color:white;box-shadow:0 2px 8px rgba(252,211,77,.3);}
.cday.partial:hover{transform:scale(1.1);}
.cday.miss{background:var(--red-l);color:var(--red);border:1.5px solid #FECACA;}
.cday.today{background:linear-gradient(135deg,var(--teal),var(--purple));color:white;box-shadow:0 4px 12px rgba(58,191,191,.35);}
.cday-num{font-size:.63rem;font-weight:700;line-height:1;}
.cday-h{font-size:.52rem;opacity:.85;line-height:1;margin-top:.08rem;}
.cal-legend{display:flex;gap:.75rem;margin-top:.75rem;flex-wrap:wrap;}
.cal-leg{display:flex;align-items:center;gap:.3rem;font-size:.66rem;color:var(--text-m);}
.cal-leg-dot{width:10px;height:10px;border-radius:4px;flex-shrink:0;}

/* ‚îÄ‚îÄ COURBE VISION ‚îÄ‚îÄ */
.vision-card{margin:0 1.25rem .75rem;background:var(--white);border-radius:20px;padding:1.1rem;box-shadow:var(--shadow);border:1.5px solid var(--border);animation:slideUp .4s ease-out .2s both;}
.vision-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem;}
.vision-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.92rem;}
.vision-eyes{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:.875rem;}
.eye-stat{border-radius:14px;padding:.75rem;text-align:center;border:1.5px solid var(--border);}
.eye-od{border-color:var(--teal);background:var(--teal-l);}
.eye-og{border-color:var(--purple);background:var(--purple-l);}
.eye-label{font-size:.63rem;font-weight:700;color:var(--text-m);text-transform:uppercase;letter-spacing:.4px;margin-bottom:.25rem;}
.eye-val{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.6rem;line-height:1;}
.eye-od .eye-val{color:var(--teal-d);}
.eye-og .eye-val{color:var(--purple-d);}
.eye-prog{font-size:.68rem;font-weight:700;margin-top:.2rem;color:var(--green-d);}
.chart-wrap{position:relative;height:140px;}
.chart-labels-y{position:absolute;left:0;top:0;bottom:20px;width:28px;display:flex;flex-direction:column;justify-content:space-between;align-items:flex-end;padding-right:4px;}
.chart-labels-y span{font-size:.56rem;color:var(--text-l);font-family:'Nunito',sans-serif;font-weight:700;}
.chart-svg{position:absolute;left:28px;right:0;top:0;bottom:0;}
.vision-legend{display:flex;gap:1rem;margin-top:.5rem;}
.vleg{display:flex;align-items:center;gap:.35rem;font-size:.68rem;color:var(--text-m);font-weight:600;}
.vleg-line{width:16px;height:3px;border-radius:2px;}

/* ‚îÄ‚îÄ RDV ‚îÄ‚îÄ */
.rdv-card{margin:0 1.25rem .75rem;border-radius:20px;overflow:hidden;box-shadow:var(--shadow);animation:slideUp .4s ease-out .25s both;}
.rdv-item{background:var(--white);padding:.875rem 1.1rem;display:flex;align-items:center;gap:.875rem;border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s;}
.rdv-item:last-child{border-bottom:none;}
.rdv-item:active{background:var(--bg);}
.rdv-date{width:46px;height:50px;border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;}
.rdv-date.next{background:linear-gradient(135deg,var(--teal),var(--purple));box-shadow:0 4px 12px rgba(58,191,191,.25);}
.rdv-date.future{background:var(--bg);border:1.5px solid var(--border);}
.rdv-day{font-family:'Nunito',sans-serif;font-weight:900;font-size:1.1rem;line-height:1;color:white;}
.rdv-date.future .rdv-day{color:var(--text);}
.rdv-mois{font-family:'Nunito',sans-serif;font-weight:700;font-size:.58rem;color:rgba(255,255,255,.85);text-transform:uppercase;}
.rdv-date.future .rdv-mois{color:var(--text-m);}
.rdv-info{flex:1;}
.rdv-type{font-family:'Nunito',sans-serif;font-weight:800;font-size:.85rem;}
.rdv-detail{font-size:.7rem;color:var(--text-m);margin-top:.1rem;display:flex;align-items:center;gap:.35rem;}
.rdv-badge{display:inline-flex;align-items:center;padding:.14rem .42rem;border-radius:20px;font-size:.63rem;font-weight:700;}
.rdv-badge.next{background:var(--teal-l);color:var(--teal-d);}
.rdv-badge.ok{background:var(--green-l);color:var(--green-d);}
.rdv-badge.pending{background:var(--orange-l);color:var(--orange-d);}
.rdv-arrow{color:var(--text-l);font-size:.9rem;}

/* ‚îÄ‚îÄ BADGES & R√âCOMPENSES ‚îÄ‚îÄ */
.badges-card{margin:0 1.25rem .75rem;background:var(--white);border-radius:20px;padding:1.1rem;box-shadow:var(--shadow);border:1.5px solid var(--border);animation:slideUp .4s ease-out .28s both;}
.badges-title{font-family:'Nunito',sans-serif;font-weight:800;font-size:.92rem;margin-bottom:.75rem;}
.badges-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;}
.badge-item{display:flex;flex-direction:column;align-items:center;gap:.3rem;padding:.625rem .3rem;border-radius:14px;border:1.5px solid var(--border);cursor:default;transition:transform .15s;}
.badge-item.unlocked{border-color:var(--yellow);background:var(--yellow-l);}
.badge-item.unlocked:hover{transform:scale(1.05);}
.badge-item.locked{background:var(--bg);opacity:.5;}
.badge-icon{font-size:1.5rem;}
.badge-name{font-size:.58rem;font-weight:700;color:var(--text-m);text-align:center;line-height:1.2;}
.badge-item.unlocked .badge-name{color:var(--yellow-d);}
.stars-row{display:flex;justify-content:center;gap:.25rem;margin-bottom:.75rem;}
.star{font-size:1.3rem;transition:transform .2s cubic-bezier(.34,1.56,.64,1);}
.star.filled{animation:starPop .3s ease-out both;}
@keyframes starPop{0%{transform:scale(0);}80%{transform:scale(1.3);}100%{transform:scale(1);}}

/* ‚îÄ‚îÄ NOTIFICATIONS (tab) ‚îÄ‚îÄ */
.notifs-list{margin:0 1.25rem;display:flex;flex-direction:column;gap:.4rem;animation:slideUp .4s ease-out .1s both;}
.notif-item{background:var(--white);border-radius:16px;padding:.875rem 1.1rem;display:flex;align-items:flex-start;gap:.75rem;border:1px solid var(--border);box-shadow:var(--shadow);}
.notif-item.unread{background:var(--teal-ll);border-color:var(--teal);}
.notif-ico{width:36px;height:36px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;}
.notif-ico.green{background:var(--green-l);}
.notif-ico.yellow{background:var(--yellow-l);}
.notif-ico.teal{background:var(--teal-l);}
.notif-ico.purple{background:var(--purple-l);}
.notif-ico.orange{background:var(--orange-l);}
.notif-msg{flex:1;}
.notif-text{font-size:.8rem;font-weight:700;line-height:1.35;}
.notif-time{font-size:.65rem;color:var(--text-m);margin-top:.2rem;}
.notif-unread-dot{width:8px;height:8px;background:var(--teal);border-radius:50%;margin-top:.3rem;flex-shrink:0;}

/* Boutons de rappel */
.rappel-card{
  margin:0 1.25rem .75rem;background:var(--white);border-radius:20px;
  padding:1.1rem;box-shadow:var(--shadow);border:1.5px solid var(--border);
  animation:slideUp .4s ease-out .12s both;
}
.rappel-btn{
  width:100%;border:none;border-radius:14px;padding:1rem 1.1rem;
  font-family:'Nunito',sans-serif;font-weight:800;font-size:.9rem;
  cursor:pointer;transition:transform .15s,box-shadow .15s;
  display:flex;align-items:center;gap:.875rem;text-align:left;
  margin-bottom:.5rem;color:white;
}
.rappel-btn:last-of-type{margin-bottom:0;}
.rappel-btn:active{transform:scale(.97);}
.rappel-btn .rb-icon{font-size:1.5rem;flex-shrink:0;}
.rappel-btn .rb-text{line-height:1.3;}
.rappel-btn .rb-sub{font-family:'Nunito Sans',sans-serif;font-size:.72rem;opacity:.85;font-weight:500;display:block;margin-top:.1rem;}
.rb-blue{background:var(--teal);box-shadow:0 4px 16px rgba(58,191,191,.35);}
.rb-blue:hover{box-shadow:0 6px 24px rgba(58,191,191,.45);}
.rb-green{background:var(--green);box-shadow:0 4px 16px rgba(52,211,153,.35);}
.rb-green:hover{box-shadow:0 6px 24px rgba(52,211,153,.45);}
.rb-purple{background:var(--purple);box-shadow:0 4px 16px rgba(167,139,250,.35);}
.status-badge{
  display:inline-flex;align-items:center;gap:.4rem;
  background:var(--teal-l);color:var(--teal-d);
  border-radius:30px;padding:.35rem .875rem;
  font-size:.75rem;font-weight:700;margin-top:.5rem;
  transition:all .3s;
}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav{
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:430px;
  background:rgba(255,255,255,.92);backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  display:grid;grid-template-columns:repeat(4,1fr);
  padding:.45rem 0 .75rem;z-index:100;
}
.bnav{display:flex;flex-direction:column;align-items:center;gap:.2rem;cursor:pointer;padding:.3rem;border-radius:12px;transition:all .15s;border:none;background:none;font-family:'Nunito Sans',sans-serif;position:relative;}
.bnav-icon{font-size:1.3rem;transition:transform .2s cubic-bezier(.34,1.56,.64,1);}
.bnav-label{font-size:.58rem;font-weight:700;color:var(--text-m);}
.bnav.active .bnav-icon{transform:scale(1.15);}
.bnav.active .bnav-label{color:var(--teal-d);font-weight:800;}
.bnav-badge{position:absolute;top:0;right:50%;margin-right:-18px;background:var(--red);color:white;font-size:.5rem;font-weight:800;padding:.1rem .3rem;border-radius:10px;font-family:'Nunito',sans-serif;min-width:16px;text-align:center;}

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.confetti-wrap{position:fixed;inset:0;pointer-events:none;z-index:999;display:none;}
.confetti-wrap.show{display:block;}
.confetti{position:absolute;border-radius:2px;animation:confettiFall var(--dur) ease-in forwards;animation-delay:var(--delay);}
@keyframes confettiFall{0%{transform:translateY(-20px) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(720deg);opacity:0;}}

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:none;}}
@keyframes popIn{from{transform:scale(0);}to{transform:scale(1);}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  PAGE ACCUEIL                        -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-home">

  <div class="app-header">
    <div class="logo"><div class="logo-eye">üëÅ</div>Ambly<span style="color:var(--teal)">up</span></div>
    <button class="notif-btn" onclick="goPage('page-notifs')">üîî<div class="notif-dot" id="notif-dot"></div></button>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div class="hero-top">
      <div>
        <div class="hero-greeting">Bonjour üëã</div>
        <div class="hero-name" id="hero-name">Jules, 8 ans</div>
      </div>
      <div class="hero-mascot" id="mascot">ü¶∏</div>
    </div>
    <div class="hero-stats">
      <div class="hstat"><div class="hstat-val">üî• 12</div><div class="hstat-label">Streak</div></div>
      <div class="hstat"><div class="hstat-val">84%</div><div class="hstat-label">Ce mois</div></div>
      <div class="hstat"><div class="hstat-val">‚≠ê 47</div><div class="hstat-label">√âtoiles</div></div>
    </div>
  </div>

  <!-- PERMISSION BANNER -->
  <div class="perm-banner" id="perm-banner">
    <p><span>üîî</span> Active les notifications pour recevoir les rappels de Jules !</p>
    <button class="perm-btn" onclick="demanderPermission()">üîî Activer les notifications</button>
  </div>

  <!-- INSTRUCTION DU JOUR -->
  <div class="section-title">Instruction du jour</div>
  <div class="instruction-card">
    <div class="instr-left">
      <div class="instr-icon">ü©π</div>
      <div>
        <div class="instr-title">Cache sur l'≈ìil droit</div>
        <div class="instr-detail">De <strong>8h00</strong> √† <strong>18h00</strong> ‚Äî OD</div>
      </div>
    </div>
    <div class="instr-badge">
      <div class="instr-dur">4h</div>
      <div class="instr-dur-sub">objectif</div>
    </div>
  </div>

  <!-- JOURS EN ATTENTE -->
  <div class="pending-section" id="pending-section">
    <div class="pending-title">‚è≥ Jours non renseign√©s</div>
    <div class="pending-list" id="pending-list"></div>
  </div>

  <!-- SAISIE DU SOIR -->
  <div class="section-title">Ce soir</div>
  <div class="saisie-card" id="saisie-card">
    <div class="saisie-hd">
      <div class="saisie-icon">üåô</div>
      <div>
        <div class="saisie-title">Valider le port d'aujourd'hui</div>
        <div class="saisie-date" id="saisie-date"></div>
      </div>
    </div>

    <div id="saisie-form">
      <div class="obj-row">
        <span>Combien d'heures port√©es ?</span>
        <span class="obj-badge">üéØ Objectif : 4h</span>
      </div>

      <!-- MODE BOUTONS (kids) -->
      <div class="hours-grid" id="hours-grid"></div>

      <!-- BOUTON VALIDER -->
      <button class="valider-btn" id="valider-btn" onclick="validerSaisie()" disabled>
        Valider ‚úì
      </button>
    </div>

    <div class="done-msg" id="done-msg">
      <span class="done-icon" id="done-icon">üéâ</span>
      <div class="done-text" id="done-text">Bravo Jules !</div>
      <div class="done-sub" id="done-sub">Continue comme √ßa !</div>
    </div>
  </div>

  <!-- CALENDRIER OBSERVANCE -->
  <div class="section-title">Mon calendrier</div>
  <div class="cal-card">
    <div class="cal-hd">
      <div><div class="cal-title">Observance cache</div><div class="cal-month">F√©vrier 2026</div></div>
      <div class="cal-score"><div class="cal-score-val">84%</div><div class="cal-score-label">ce mois</div></div>
    </div>
    <div class="cal-day-labels">
      <div class="cdl">L</div><div class="cdl">M</div><div class="cdl">M</div>
      <div class="cdl">J</div><div class="cdl">V</div><div class="cdl">S</div><div class="cdl">D</div>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
    <div class="cal-legend">
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--green)"></div>Objectif ‚úì</div>
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--yellow)"></div>Partiel</div>
      <div class="cal-leg"><div class="cal-leg-dot" style="background:var(--red-l);border:1.5px solid #FECACA"></div>Manqu√©</div>
    </div>
  </div>

  <!-- BADGES -->
  <div class="section-title">Mes r√©compenses</div>
  <div class="badges-card">
    <div class="badges-title">√âtoiles gagn√©es</div>
    <div class="stars-row" id="stars-row"></div>
    <div class="badges-grid" id="badges-grid"></div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  PAGE VISION                         -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-vision">
  <div class="app-header">
    <div class="logo"><div class="logo-eye">üëÅ</div>Ma vision</div>
  </div>
  <div style="padding:.5rem 0;">
    <div class="section-title">Acuit√© visuelle</div>
    <div class="vision-card">
      <div class="vision-hd">
        <div class="vision-title">Progression</div>
        <div style="display:flex;gap:.3rem;">
          <button class="vtab active" onclick="activateVtab(this)">3 mois</button>
          <button class="vtab" onclick="activateVtab(this)">6 mois</button>
          <button class="vtab" onclick="activateVtab(this)">Tout</button>
        </div>
      </div>
      <div class="vision-eyes">
        <div class="eye-stat eye-od">
          <div class="eye-label">≈íil droit (OD)</div>
          <div class="eye-val">5/10</div>
          <div class="eye-prog">‚Üë +2/10 depuis d√©c.</div>
        </div>
        <div class="eye-stat eye-og">
          <div class="eye-label">≈íil gauche (OG)</div>
          <div class="eye-val">9/10</div>
          <div class="eye-prog">‚Üë +1/10 depuis d√©c.</div>
        </div>
      </div>
      <div class="chart-wrap">
        <div class="chart-labels-y"><span>10</span><span>8</span><span>6</span><span>4</span><span>2</span></div>
        <div class="chart-svg">
          <svg viewBox="0 0 340 120" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%">
            <defs>
              <linearGradient id="gradOD" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#3ABFBF" stop-opacity=".2"/>
                <stop offset="100%" stop-color="#3ABFBF" stop-opacity="0"/>
              </linearGradient>
              <linearGradient id="gradOG" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#A78BFA" stop-opacity=".2"/>
                <stop offset="100%" stop-color="#A78BFA" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <line x1="0" y1="0" x2="340" y2="0" stroke="#F1F5F9" stroke-width="1"/>
            <line x1="0" y1="24" x2="340" y2="24" stroke="#F1F5F9" stroke-width="1"/>
            <line x1="0" y1="48" x2="340" y2="48" stroke="#F1F5F9" stroke-width="1"/>
            <line x1="0" y1="72" x2="340" y2="72" stroke="#F1F5F9" stroke-width="1"/>
            <line x1="0" y1="96" x2="340" y2="96" stroke="#F1F5F9" stroke-width="1"/>
            <polygon points="0,67 56,67 113,58 170,58 226,48 340,48 340,100 0,100" fill="url(#gradOD)"/>
            <polyline points="0,67 56,67 113,58 170,58 226,48 340,48" fill="none" stroke="#3ABFBF" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
            <circle cx="0" cy="67" r="4" fill="#3ABFBF" stroke="white" stroke-width="2"/>
            <circle cx="56" cy="67" r="4" fill="#3ABFBF" stroke="white" stroke-width="2"/>
            <circle cx="113" cy="58" r="4" fill="#3ABFBF" stroke="white" stroke-width="2"/>
            <circle cx="170" cy="58" r="4" fill="#3ABFBF" stroke="white" stroke-width="2"/>
            <circle cx="226" cy="48" r="4" fill="#3ABFBF" stroke="white" stroke-width="2"/>
            <circle cx="340" cy="48" r="5" fill="#3ABFBF" stroke="white" stroke-width="2.5"/>
            <text x="330" y="40" font-size="9" fill="#2a9e9e" font-weight="800" font-family="Nunito">5/10</text>
            <polygon points="0,19 56,19 113,19 170,10 226,10 340,10 340,50 0,50" fill="url(#gradOG)"/>
            <polyline points="0,19 56,19 113,19 170,10 226,10 340,10" fill="none" stroke="#A78BFA" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
            <circle cx="0" cy="19" r="4" fill="#A78BFA" stroke="white" stroke-width="2"/>
            <circle cx="56" cy="19" r="4" fill="#A78BFA" stroke="white" stroke-width="2"/>
            <circle cx="113" cy="19" r="4" fill="#A78BFA" stroke="white" stroke-width="2"/>
            <circle cx="170" cy="10" r="4" fill="#A78BFA" stroke="white" stroke-width="2"/>
            <circle cx="226" cy="10" r="4" fill="#A78BFA" stroke="white" stroke-width="2"/>
            <circle cx="340" cy="10" r="5" fill="#A78BFA" stroke="white" stroke-width="2.5"/>
            <text x="330" y="5" font-size="9" fill="#6D28D9" font-weight="800" font-family="Nunito">9/10</text>
            <text x="0" y="115" font-size="8" fill="#CBD5E1" font-family="Nunito" font-weight="700" text-anchor="middle">Nov</text>
            <text x="56" y="115" font-size="8" fill="#CBD5E1" font-family="Nunito" font-weight="700" text-anchor="middle">D√©c</text>
            <text x="113" y="115" font-size="8" fill="#CBD5E1" font-family="Nunito" font-weight="700" text-anchor="middle">Jan</text>
            <text x="170" y="115" font-size="8" fill="#CBD5E1" font-family="Nunito" font-weight="700" text-anchor="middle">F√©v</text>
            <text x="226" y="115" font-size="8" fill="#CBD5E1" font-family="Nunito" font-weight="700" text-anchor="middle">Mar</text>
            <text x="340" y="115" font-size="8" fill="#94A3B8" font-family="Nunito" font-weight="800" text-anchor="middle">Auj.</text>
          </svg>
        </div>
      </div>
      <div class="vision-legend">
        <div class="vleg"><div class="vleg-line" style="background:var(--teal)"></div>≈íil droit</div>
        <div class="vleg"><div class="vleg-line" style="background:var(--purple)"></div>≈íil gauche</div>
      </div>
    </div>

    <!-- RDV -->
    <div class="section-title">Mes rendez-vous</div>
    <div class="rdv-card">
      <div class="rdv-item">
        <div class="rdv-date next"><div class="rdv-day">03</div><div class="rdv-mois">Mar</div></div>
        <div class="rdv-info">
          <div class="rdv-type">Bilan orthoptique</div>
          <div class="rdv-detail">14h00 ¬∑ Mme Lecomte <span class="rdv-badge next">Dans 8 jours</span></div>
        </div>
        <div class="rdv-arrow">‚Ä∫</div>
      </div>
      <div class="rdv-item">
        <div class="rdv-date future"><div class="rdv-day">07</div><div class="rdv-mois" style="color:var(--text-m)">Avr</div></div>
        <div class="rdv-info">
          <div class="rdv-type">Contr√¥le vision</div>
          <div class="rdv-detail">10h30 ¬∑ Mme Lecomte <span class="rdv-badge ok">Confirm√© ‚úì</span></div>
        </div>
        <div class="rdv-arrow">‚Ä∫</div>
      </div>
      <div class="rdv-item">
        <div class="rdv-date future" style="background:var(--orange-l);border-color:var(--orange)">
          <div class="rdv-day" style="color:var(--orange-d)">?</div>
          <div class="rdv-mois" style="color:var(--orange-d)">Jun</div>
        </div>
        <div class="rdv-info">
          <div class="rdv-type">Prochain suivi</div>
          <div class="rdv-detail"><span class="rdv-badge pending">√Ä planifier</span></div>
        </div>
        <div class="rdv-arrow">‚Ä∫</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  PAGE RAPPELS (notifs)               -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-notifs">
  <div class="app-header">
    <div class="logo"><div class="logo-eye">üëÅ</div>Notifications</div>
  </div>
  <div style="padding:.5rem 0;">
    <div class="section-title">Envoyer un rappel</div>
    <div class="rappel-card">
      <button class="rappel-btn rb-blue" onclick="envoyerNotif('cache')">
        <span class="rb-icon">üè¥‚Äç‚ò†Ô∏è</span>
        <span class="rb-text">Rappel : mettre le cache
          <span class="rb-sub">Notifie Jules de mettre son cache</span>
        </span>
      </button>
      <button class="rappel-btn rb-green" onclick="envoyerNotif('retirer')">
        <span class="rb-icon">üéâ</span>
        <span class="rb-text">Cache retir√© ‚Äî remplir l'observance
          <span class="rb-sub">Redirige vers la saisie des heures</span>
        </span>
      </button>
      <button class="rappel-btn rb-purple" onclick="envoyerNotif('rdv')">
        <span class="rb-icon">üìÖ</span>
        <span class="rb-text">Rappel rendez-vous
          <span class="rb-sub">RDV bilan orthoptique dans 8 jours</span>
        </span>
      </button>
      <div class="status-badge" id="notif-status">üí§ En attente</div>
    </div>

    <div class="section-title">Historique</div>
    <div class="notifs-list">
      <div class="notif-item unread">
        <div class="notif-ico teal">‚è∞</div>
        <div class="notif-msg">
          <div class="notif-text">N'oublie pas ton cache aujourd'hui ! Objectif : 4h üéØ</div>
          <div class="notif-time">Aujourd'hui ¬∑ 8h00</div>
        </div>
        <div class="notif-unread-dot"></div>
      </div>
      <div class="notif-item unread">
        <div class="notif-ico purple">üìÖ</div>
        <div class="notif-msg">
          <div class="notif-text">RDV bilan orthoptique dans 8 jours chez Mme Lecomte</div>
          <div class="notif-time">Aujourd'hui ¬∑ 9h00</div>
        </div>
        <div class="notif-unread-dot"></div>
      </div>
      <div class="notif-item">
        <div class="notif-ico green">‚≠ê</div>
        <div class="notif-msg">
          <div class="notif-text">Bravo ! 7 jours d'affil√©e ‚Äî badge Super H√©ros d√©bloqu√© ü¶∏</div>
          <div class="notif-time">Hier ¬∑ 20h15</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-ico yellow">üìà</div>
        <div class="notif-msg">
          <div class="notif-text">Ton ≈ìil droit progresse ! OD passe de 4/10 √† 5/10 ‚ú®</div>
          <div class="notif-time">Il y a 3 jours</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-ico orange">üèÜ</div>
        <div class="notif-msg">
          <div class="notif-text">Streak de 10 jours ‚Äî badge Champion d√©bloqu√© ! üèÜ</div>
          <div class="notif-time">Il y a 5 jours</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  PAGE BADGES                         -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-badges">
  <div class="app-header">
    <div class="logo"><div class="logo-eye">üëÅ</div>Mes r√©compenses</div>
  </div>
  <div style="padding:.5rem 0;">
    <div class="section-title">√âtoiles ¬∑ 47 gagn√©es</div>
    <div class="badges-card" style="margin:0 1.25rem .75rem">
      <div class="stars-row" id="stars-row-big"></div>
      <div style="text-align:center;font-size:.75rem;color:var(--text-m);margin-top:.25rem;">Tu gagnes une ‚≠ê chaque jour o√π tu atteins ton objectif !</div>
    </div>
    <div class="section-title">Badges</div>
    <div style="margin:0 1.25rem;display:flex;flex-direction:column;gap:.5rem;">
      <div id="badges-list"></div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ -->
<nav class="bottom-nav">
  <button class="bnav active" onclick="goPage('page-home')">
    <span class="bnav-icon">üè†</span><span class="bnav-label">Accueil</span>
  </button>
  <button class="bnav" onclick="goPage('page-vision')">
    <span class="bnav-icon">üëÅ</span><span class="bnav-label">Ma vision</span>
  </button>
  <button class="bnav" onclick="goPage('page-notifs')">
    <span class="bnav-icon">üîî</span><span class="bnav-label">Rappels</span>
    <span class="bnav-badge" id="bnav-notif-badge">2</span>
  </button>
  <button class="bnav" onclick="goPage('page-badges')">
    <span class="bnav-icon">‚≠ê</span><span class="bnav-label">Badges</span>
  </button>
</nav>

<!-- CONFETTI -->
<div class="confetti-wrap" id="confetti"></div>

<!-- vtab style (inline to avoid separate stylesheet) -->
<style>
.vtab{padding:.22rem .6rem;border-radius:8px;font-family:'Nunito',sans-serif;font-size:.68rem;font-weight:700;border:1.5px solid var(--border);background:var(--bg);color:var(--text-m);cursor:pointer;transition:all .15s;}
.vtab.active{background:var(--teal);border-color:var(--teal);color:white;}
</style>

<script>
'use strict';

// ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ
const CONFIG = {
  nomPatient: 'Jules',
  agePatient: 8,
  objectifH: 4,
  oeilCache: 'OD',
  heureDebut: '8h00',
  heureFin: '18h00',
};

let swReg = null;
let selectedH = null;
let currentPage = 'page-home';

// ‚îÄ‚îÄ SERVICE WORKER ‚îÄ‚îÄ
window.addEventListener('load', async () => {
  if ('serviceWorker' in navigator) {
    try {
      swReg = await navigator.serviceWorker.register('sw.js');
      console.log('SW registered');
    } catch(e) { console.log('SW error:', e); }
  }

  // Banner permission
  if ('Notification' in window && Notification.permission === 'default') {
    document.getElementById('perm-banner').style.display = 'block';
  }

  // Init
  initDate();
  buildHoursGrid();
  buildCalendar();
  buildStars('stars-row', 47, 8);
  buildStars('stars-row-big', 47, 12);
  buildBadges();
  buildBadgesList();
  buildPending();

  // Hash routing
  if (window.location.hash === '#saisie') {
    goPage('page-home');
    setTimeout(() => document.getElementById('saisie-card').scrollIntoView({behavior:'smooth'}), 300);
  }
});

// ‚îÄ‚îÄ PERMISSION ‚îÄ‚îÄ
async function demanderPermission() {
  const perm = await Notification.requestPermission();
  if (perm === 'granted') {
    document.getElementById('perm-banner').style.display = 'none';
    showToast('üîî Notifications activ√©es !', 'green');
  }
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.bnav').forEach(b => b.classList.remove('active'));
  const map = {'page-home':0,'page-vision':1,'page-notifs':2,'page-badges':3};
  const idx = map[id];
  if (idx !== undefined) document.querySelectorAll('.bnav')[idx].classList.add('active');
  window.scrollTo(0,0);
  currentPage = id;

  // Effacer badge notif
  if (id === 'page-notifs') {
    document.getElementById('bnav-notif-badge').style.display = 'none';
    document.getElementById('notif-dot').style.display = 'none';
  }
}

// ‚îÄ‚îÄ DATE ‚îÄ‚îÄ
function initDate() {
  const d = new Date();
  const jours = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const mois = ['janvier','f√©vrier','mars','avril','mai','juin','juillet','ao√ªt','septembre','octobre','novembre','d√©cembre'];
  document.getElementById('saisie-date').textContent =
    jours[d.getDay()] + ' ' + d.getDate() + ' ' + mois[d.getMonth()] + ' ' + d.getFullYear();
}

// ‚îÄ‚îÄ HEURES GRID (kids buttons) ‚îÄ‚îÄ
function buildHoursGrid() {
  const grid = document.getElementById('hours-grid');
  const obj = CONFIG.objectifH;
  // 0h √† 7h + un bouton 8h+ = 8 boutons en 4√ó2
  const vals = [0,1,2,3,4,5,6,7];
  vals.forEach(h => {
    const btn = document.createElement('button');
    let cls = 'hbtn';
    if (h === 0) cls += ' zero';
    else if (h === obj) cls += ' target';
    else if (h > obj) cls += ' over';
    btn.className = cls;
    const label = h === 0 ? '0h' : h + 'h';
    const sub = h === obj ? '‚≠ê objectif' : h > obj ? 'üèÜ super !' : h === 0 ? 'üòî' : '';
    btn.innerHTML = label + (sub ? `<span class="hbtn-sub">${sub}</span>` : `<span class="hbtn-sub">${h === 1 ? 'heure' : 'heures'}</span>`);
    btn.onclick = () => selectHeure(btn, h);
    grid.appendChild(btn);
  });
}

function selectHeure(btn, h) {
  document.querySelectorAll('.hbtn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  selectedH = h;
  const vbtn = document.getElementById('valider-btn');
  vbtn.disabled = false;
  if (h >= CONFIG.objectifH) {
    vbtn.style.background = 'linear-gradient(135deg, var(--green), var(--teal))';
    vbtn.textContent = 'Valider ‚≠ê';
  } else if (h === 0) {
    vbtn.style.background = 'linear-gradient(135deg, var(--red), #EF4444)';
    vbtn.textContent = 'Valider üòî';
  } else {
    vbtn.style.background = 'linear-gradient(135deg, var(--teal), var(--purple))';
    vbtn.textContent = 'Valider ‚úì';
  }
}

function validerSaisie() {
  if (selectedH === null) return;
  const form = document.getElementById('saisie-form');
  const done = document.getElementById('done-msg');
  const card = document.getElementById('saisie-card');

  form.style.display = 'none';
  done.style.display = 'block';

  const h = selectedH;
  const obj = CONFIG.objectifH;

  if (h >= obj) {
    card.classList.add('done');
    document.getElementById('done-icon').textContent = h > obj ? 'üèÜ' : 'üéâ';
    document.getElementById('done-text').textContent = h > obj ? 'Incroyable ' + CONFIG.nomPatient + ' !' : 'Bravo ' + CONFIG.nomPatient + ' !';
    document.getElementById('done-sub').textContent = h + 'h de cache aujourd\'hui ‚Äî tu gagnes une ‚≠ê √©toile !';
    lancerConfetti();
  } else if (h === 0) {
    document.getElementById('done-icon').textContent = 'üòî';
    document.getElementById('done-text').textContent = 'Pas de cache aujourd\'hui...';
    document.getElementById('done-sub').textContent = 'N\'oublie pas demain ! Tu peux le faire üí™';
  } else {
    document.getElementById('done-icon').textContent = 'üëç';
    document.getElementById('done-text').textContent = 'Bien jou√© ' + CONFIG.nomPatient + ' !';
    document.getElementById('done-sub').textContent = h + 'h sur ' + obj + 'h ‚Äî essaie d\'atteindre l\'objectif demain !';
  }
  const mascots = ['üò¥','üôÅ','üëç','üí™','ü¶∏','üèÜ','üëë','üåü'];
  document.getElementById('mascot').textContent = mascots[Math.min(h, 7)];
}

// ‚îÄ‚îÄ CALENDRIER ‚îÄ‚îÄ
function buildCalendar() {
  const data = [
    null,null,null,null,null,null, // padding Lun‚ÜíSam avant le 1er (1er f√©v = Dimanche)
    {d:1,s:'ok',h:'4h'},{d:2,s:'ok',h:'5h'},{d:3,s:'ok',h:'4h'},
    {d:4,s:'partial',h:'2h'},{d:5,s:'ok',h:'4h'},{d:6,s:'ok',h:'4h'},
    {d:7,s:'ok',h:'3h'},{d:8,s:'ok',h:'4h'},{d:9,s:'miss',h:'0h'},
    {d:10,s:'ok',h:'4h'},{d:11,s:'ok',h:'4h'},{d:12,s:'ok',h:'5h'},
    {d:13,s:'ok',h:'4h'},{d:14,s:'partial',h:'2h'},{d:15,s:'ok',h:'4h'},
    {d:16,s:'ok',h:'4h'},{d:17,s:'ok',h:'3h'},{d:18,s:'ok',h:'4h'},
    {d:19,s:'ok',h:'4h'},{d:20,s:'ok',h:'4h'},{d:21,s:'partial',h:'3h'},
    {d:22,s:'ok',h:'4h'},{d:23,s:'today',h:'?'},
    {d:24,s:'future',h:''},{d:25,s:'future',h:''},{d:26,s:'future',h:''},
    {d:27,s:'future',h:''},{d:28,s:'future',h:''},
  ];
  const grid = document.getElementById('cal-grid');
  data.forEach(day => {
    const el = document.createElement('div');
    if (!day) { el.className = 'cday empty'; }
    else {
      el.className = 'cday ' + day.s;
      el.innerHTML = `<span class="cday-num">${day.d}</span>${day.h?`<span class="cday-h">${day.h}</span>`:''}`;
    }
    grid.appendChild(el);
  });
}

// ‚îÄ‚îÄ √âTOILES ‚îÄ‚îÄ
function buildStars(id, count, max) {
  const row = document.getElementById(id);
  if (!row) return;
  row.innerHTML = '';
  for (let i = 0; i < max; i++) {
    const s = document.createElement('span');
    s.className = 'star' + (i < count % max || count >= max ? ' filled' : '');
    s.textContent = i < (count % max || max) ? '‚≠ê' : '‚òÜ';
    s.style.animationDelay = (i * 0.05) + 's';
    row.appendChild(s);
  }
}

// ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ
const BADGES_DATA = [
  {icon:'ü¶∏',name:'Super H√©ros',desc:'7 jours d\'affil√©e',unlocked:true},
  {icon:'üèÜ',name:'Champion',desc:'10 jours streak',unlocked:true},
  {icon:'üåü',name:'√âtoile filante',desc:'30 √©toiles',unlocked:true},
  {icon:'üí™',name:'Pers√©v√©rant',desc:'20 jours ce mois',unlocked:true},
  {icon:'üëë',name:'Roi du cache',desc:'Objectif 7j/7',unlocked:false},
  {icon:'üöÄ',name:'D√©collage',desc:'1er mois complet',unlocked:false},
  {icon:'üåà',name:'Arc-en-ciel',desc:'50 √©toiles',unlocked:false},
  {icon:'üéØ',name:'Pr√©cision',desc:'100% en 1 semaine',unlocked:false},
];

function buildBadges() {
  const grid = document.getElementById('badges-grid');
  if (!grid) return;
  BADGES_DATA.slice(0,8).forEach(b => {
    const el = document.createElement('div');
    el.className = 'badge-item ' + (b.unlocked ? 'unlocked' : 'locked');
    el.innerHTML = `<span class="badge-icon">${b.icon}</span><span class="badge-name">${b.name}</span>`;
    if (b.unlocked) el.title = b.desc;
    grid.appendChild(el);
  });
}

function buildBadgesList() {
  const list = document.getElementById('badges-list');
  if (!list) return;
  BADGES_DATA.forEach(b => {
    const el = document.createElement('div');
    el.style.cssText = 'background:var(--white);border-radius:16px;padding:.875rem 1.1rem;display:flex;align-items:center;gap:.875rem;border:1.5px solid var(--border);box-shadow:var(--shadow);margin-bottom:.5rem;opacity:' + (b.unlocked?'1':'.45') + ';';
    el.innerHTML = `
      <div style="width:48px;height:48px;border-radius:14px;background:${b.unlocked?'var(--yellow-l)':'var(--bg)'};display:flex;align-items:center;justify-content:center;font-size:1.6rem;border:1.5px solid ${b.unlocked?'var(--yellow)':'var(--border)'};">${b.icon}</div>
      <div style="flex:1;">
        <div style="font-family:'Nunito',sans-serif;font-weight:800;font-size:.85rem;color:${b.unlocked?'var(--text)':'var(--text-m)'};">${b.name}</div>
        <div style="font-size:.72rem;color:var(--text-m);margin-top:.1rem;">${b.desc}</div>
      </div>
      <div style="font-size:.75rem;font-weight:700;color:${b.unlocked?'var(--green-d)':'var(--text-l)'};">${b.unlocked?'‚úì Obtenu':'üîí'}</div>
    `;
    list.appendChild(el);
  });
}

// ‚îÄ‚îÄ JOURS EN ATTENTE ‚îÄ‚îÄ
const PENDING_DAYS = [
  {d:19, label:'Jeudi 19 f√©v', obj:4},
  {d:21, label:'Samedi 21 f√©v', obj:4},
  {d:22, label:'Dim. 22 f√©v', obj:4},
];
let pendingResolved = 0;

function buildPending() {
  const list = document.getElementById('pending-list');
  PENDING_DAYS.forEach((day, i) => {
    const el = document.createElement('div');
    el.className = 'pending-item';
    el.id = 'pending-' + i;
    el.innerHTML = `
      <div class="pending-date"><div class="pending-day">${day.d}</div><div class="pending-month">F√©v</div></div>
      <div class="pending-info"><div class="pending-name">${day.label}</div><div class="pending-sub">Cache OD ¬∑ objectif ${day.obj}h</div></div>
      <button class="pbtn-expand" onclick="togglePending(${i})">Renseigner ‚Üí</button>
      <div class="pending-slider-wrap" id="pslider-${i}">
        <div style="display:flex;justify-content:space-between;margin-bottom:.5rem;">
          <span id="p${i}-rlabel" style="font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:800;color:var(--teal-d);">0h port√©es</span>
          <span style="font-family:'Nunito',sans-serif;font-size:.78rem;font-weight:800;color:var(--yellow-d);">Objectif ${day.obj}h</span>
        </div>
        <!-- Boutons heures compacts -->
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:.35rem;margin-bottom:.625rem;" id="phours-${i}"></div>
        <button class="pbtn-valider" id="pval-${i}" onclick="resolvePending(${i})" disabled>‚úì Valider ce jour</button>
      </div>
    `;
    list.appendChild(el);
    buildPendingHours(i, day.obj);
  });
}

function buildPendingHours(i, obj) {
  const grid = document.getElementById('phours-' + i);
  [0,1,2,3,4,5].forEach(h => {
    const btn = document.createElement('button');
    btn.style.cssText = 'aspect-ratio:1;border-radius:12px;border:2px solid var(--border);background:var(--bg);font-family:"Nunito",sans-serif;font-weight:900;font-size:.88rem;cursor:pointer;transition:all .2s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;justify-content:center;';
    if (h === obj) btn.style.borderColor = 'var(--yellow)';
    btn.textContent = h + 'h';
    btn.onclick = () => {
      grid.querySelectorAll('button').forEach(b => {
        b.style.background = 'var(--bg)';
        b.style.color = 'var(--text-m)';
        b.style.borderColor = b.dataset.isTarget ? 'var(--yellow)' : 'var(--border)';
        b.style.transform = '';
        b.style.boxShadow = '';
      });
      btn.style.background = h >= obj ? 'var(--green)' : h > 0 ? 'var(--teal)' : 'var(--red)';
      btn.style.color = 'white';
      btn.style.transform = 'scale(1.08)';
      btn.style.boxShadow = '0 4px 14px rgba(0,0,0,.15)';
      document.getElementById('p' + i + '-rlabel').textContent = h + 'h port√©es';
      document.getElementById('pval-' + i).disabled = false;
      btn._val = h;
    };
    if (h === obj) { btn.dataset.isTarget = '1'; }
    grid.appendChild(btn);
  });
}

function togglePending(i) {
  const wrap = document.getElementById('pslider-' + i);
  const isOpen = wrap.classList.contains('open');
  document.querySelectorAll('.pending-slider-wrap').forEach(w => w.classList.remove('open'));
  if (!isOpen) wrap.classList.add('open');
}

function resolvePending(i) {
  const item = document.getElementById('pending-' + i);
  item.style.transition = 'all .4s ease';
  item.style.opacity = '0';
  item.style.transform = 'translateX(20px)';
  pendingResolved++;
  setTimeout(() => {
    item.remove();
    if (pendingResolved >= PENDING_DAYS.length) {
      document.getElementById('pending-section').style.display = 'none';
    }
  }, 400);
}

// ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ
async function envoyerNotif(type) {
  const statusEl = document.getElementById('notif-status');

  if (!('Notification' in window)) {
    statusEl.innerHTML = '‚ö†Ô∏è Notifications non support√©es';
    return;
  }

  if (Notification.permission === 'default') await demanderPermission();
  if (Notification.permission !== 'granted') {
    statusEl.innerHTML = '‚ö†Ô∏è Permission refus√©e';
    statusEl.style.background = '#FFF3E0';
    statusEl.style.color = '#E65100';
    setTimeout(() => { statusEl.innerHTML = 'üí§ En attente'; statusEl.style = ''; }, 4000);
    return;
  }

  const notifs = {
    cache: {
      title: 'Cache-≈ìil de ' + CONFIG.nomPatient + ' üè¥‚Äç‚ò†Ô∏è',
      body: 'Bonjour ' + CONFIG.nomPatient + ', mets ton cache sur l\'OD aujourd\'hui ! Objectif : ' + CONFIG.objectifH + 'h üéØ',
      url: window.location.href
    },
    retirer: {
      title: 'Bravo ' + CONFIG.nomPatient + ' ! üéâ',
      body: 'Tu peux retirer ton cache ! Dis-nous combien d\'heures tu l\'as port√© üåü',
      url: window.location.href + '#saisie'
    },
    rdv: {
      title: 'Rappel rendez-vous üìÖ',
      body: 'RDV bilan orthoptique dans 8 jours chez Mme Lecomte. Le 3 mars √† 14h00.',
      url: window.location.href
    }
  };

  const n = notifs[type];

  try {
    if (swReg) {
      await swReg.showNotification(n.title, {
        body: n.body,
        icon: 'icon-192.png',
        badge: 'icon-192.png',
        vibrate: [200, 100, 200],
        tag: type,
        data: { url: n.url }
      });
    } else {
      new Notification(n.title, { body: n.body });
    }
    statusEl.innerHTML = '‚úÖ Notification envoy√©e !';
    statusEl.style.background = 'var(--green-l)';
    statusEl.style.color = 'var(--green-d)';
  } catch(e) {
    statusEl.innerHTML = '‚ùå ' + e.message;
  }
  setTimeout(() => { statusEl.innerHTML = 'üí§ En attente'; statusEl.style.background = ''; statusEl.style.color = ''; }, 4000);
}

// ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ
function lancerConfetti() {
  const wrap = document.getElementById('confetti');
  wrap.classList.add('show');
  wrap.innerHTML = '';
  const colors = ['#3ABFBF','#A78BFA','#FCD34D','#34D399','#F87171','#FB923C'];
  for (let i = 0; i < 70; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.cssText = `
      left:${Math.random()*100}%;top:${Math.random()*-30}px;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;
      border-radius:${Math.random()>.5?'50%':'2px'};
      --dur:${1+Math.random()*1.2}s;--delay:${Math.random()*.8}s;
    `;
    wrap.appendChild(el);
  }
  setTimeout(() => { wrap.classList.remove('show'); wrap.innerHTML = ''; }, 3000);
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg, color) {
  const t = document.createElement('div');
  t.style.cssText = `position:fixed;bottom:90px;left:50%;transform:translateX(-50%);
    background:var(--${color});color:white;padding:.65rem 1.1rem;border-radius:12px;
    font-size:.8rem;font-weight:700;z-index:999;box-shadow:0 6px 20px rgba(0,0,0,.15);
    font-family:'Nunito',sans-serif;white-space:nowrap;animation:slideUp .3s ease-out;`;
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2500);
}

// vtab
function activateVtab(el) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
</script>
</body>
</html>
